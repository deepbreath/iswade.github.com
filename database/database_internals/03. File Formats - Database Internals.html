<!DOCTYPE html>
<!-- saved from url=(0084)https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/database-internals/9781492040330/ch14.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="6145663" data-user-uuid="78724200-da8c-4410-821c-6ec73f6340d0" data-username="iswade" data-account-type="Trial" data-activated-trial-date="12/14/2019" data-archive="9781492040330" data-publishers="O&#39;Reilly Media, Inc." data-htmlfile-name="ch14.html" data-epub-title="Database Internals" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781492040330"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/cool-2.1.15.min.js"></script><script type="text/javascript" src="./03. File Formats - Database Internals_files/510f1a6865"></script><script id="twitter-wjs" src="./03. File Formats - Database Internals_files/widgets.js"></script><script src="./03. File Formats - Database Internals_files/nr-1153.min.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/ec.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/2508.js"></script><script src="./03. File Formats - Database Internals_files/443792972845831" async=""></script><script src="./03. File Formats - Database Internals_files/1732687426968531" async=""></script><script async="" src="./03. File Formats - Database Internals_files/fbevents.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/analytics.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/bat.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/insight.min.js"></script><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/f.txt"></script><script async="" src="./03. File Formats - Database Internals_files/gtm.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={licenseKey:"510f1a6865",applicationID:"172641827"};window.NREUM||(NREUM={}),__nr_require=function(n,e,t){function r(t){if(!e[t]){var i=e[t]={exports:{}};n[t][0].call(i.exports,function(e){var i=n[t][1][e];return r(i||e)},i,i.exports)}return e[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<t.length;i++)r(t[i]);return r}({1:[function(n,e,t){function r(){}function i(n,e,t){return function(){return o(n,[u.now()].concat(f(arguments)),e?null:this,t),e?void 0:this}}var o=n("handle"),a=n(4),f=n(5),c=n("ee").get("tracer"),u=n("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(n,e){s[e]=i(d+e,!0,"api")}),s.addPageAction=i(d+"addPageAction",!0),s.setCurrentRouteName=i(d+"routeName",!0),e.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(n,e){var t={},r=this,i="function"==typeof e;return o(l+"tracer",[u.now(),n,t],r),function(){if(c.emit((i?"":"no-")+"fn-start",[u.now(),r,i],t),i)try{return e.apply(this,arguments)}catch(n){throw c.emit("fn-err",[arguments,this,n],t),n}finally{c.emit("fn-end",[u.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(n,e){m[e]=i(l+e)}),newrelic.noticeError=function(n,e){"string"==typeof n&&(n=new Error(n)),o("err",[n,u.now(),!1,e])}},{}],2:[function(n,e,t){function r(n,e){var t=n.getEntries();t.forEach(function(n){"first-paint"===n.name?a("timing",["fp",Math.floor(n.startTime)]):"first-contentful-paint"===n.name&&a("timing",["fcp",Math.floor(n.startTime)])})}function i(n){if(n instanceof c&&!s){var e,t=Math.round(n.timeStamp);e=t>1e12?Date.now()-t:f.now()-t,s=!0,a("timing",["fi",t,{type:n.type,fid:e}])}}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var o,a=n("handle"),f=n("loader"),c=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){o=new PerformanceObserver(r);try{o.observe({entryTypes:["paint"]})}catch(u){}}if("addEventListener"in document){var s=!1,p=["click","keydown","mousedown","pointerdown","touchstart"];p.forEach(function(n){document.addEventListener(n,i,!1)})}}},{}],3:[function(n,e,t){function r(n,e){if(!i)return!1;if(n!==i)return!1;if(!e)return!0;if(!o)return!1;for(var t=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var f=navigator.userAgent,c=f.match(a);c&&f.indexOf("Chrome")===-1&&f.indexOf("Chromium")===-1&&(i="Safari",o=c[1])}e.exports={agent:i,version:o,match:r}},{}],4:[function(n,e,t){function r(n,e){var t=[],r="",o=0;for(r in n)i.call(n,r)&&(t[o]=e(r,n[r]),o+=1);return t}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],5:[function(n,e,t){function r(n,e,t){e||(e=0),"undefined"==typeof t&&(t=n?n.length:0);for(var r=-1,i=t-e||0,o=Array(i<0?0:i);++r<i;)o[r]=n[e+r];return o}e.exports=r},{}],6:[function(n,e,t){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(n,e,t){function r(){}function i(n){function e(n){return n&&n instanceof r?n:n?c(n,f,o):o()}function t(t,r,i,o){if(!d.aborted||o){n&&n(t,r,i);for(var a=e(i),f=v(t),c=f.length,u=0;u<c;u++)f[u].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(n,e){h[n]=v(n).concat(e)}function m(n,e){var t=h[n];if(t)for(var r=0;r<t.length;r++)t[r]===e&&t.splice(r,1)}function v(n){return h[n]||[]}function g(n){return p[n]=p[n]||i(t)}function w(n,e){u(n,function(n,t){e=e||"feature",y[t]=e,e in s||(s[e]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:e,buffer:w,abort:a,aborted:!1};return b}function o(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var f="nr@context",c=n("gos"),u=n(4),s={},p={},d=e.exports=i();d.backlog=s},{}],gos:[function(n,e,t){function r(n,e,t){if(i.call(n,e))return n[e];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(n,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return n[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(n,e,t){function r(n,e,t,r){i.buffer([n],r),i.emit(n,e,t)}var i=n("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(n,e,t){function r(n){var e=typeof n;return!n||"object"!==e&&"function"!==e?-1:n===window?0:a(n,o,function(){return i++})}var i=1,o="nr@id",a=n("gos");e.exports=r},{}],loader:[function(n,e,t){function r(){if(!x++){var n=E.info=NREUM.info,e=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(n&&n.licenseKey&&n.applicationID&&e))return s.abort();u(y,function(e,t){n[e]||(n[e]=t)}),c("mark",["onload",a()+E.offset],null,"api");var t=l.createElement("script");t.src="https://"+n.agent,e.parentNode.insertBefore(t,e)}}function i(){"complete"===l.readyState&&o()}function o(){c("mark",["domContent",a()+E.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(f=Math.max((new Date).getTime(),f))-E.offset}var f=(new Date).getTime(),c=n("handle"),u=n(4),s=n("ee"),p=n(3),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1153.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),E=e.exports={offset:f,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};n(1),n(2),l[m]?(l[m]("DOMContentLoaded",o,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",i),d[v]("onload",r)),c("mark",["firstbyte",f],null,"api");var x=0,O=n(6)},{}],"wrap-function":[function(n,e,t){function r(n){return!(n&&n instanceof Function&&n.apply&&!n[a])}var i=n("ee"),o=n(5),a="nr@original",f=Object.prototype.hasOwnProperty,c=!1;e.exports=function(n,e){function t(n,e,t,i){function nrWrapper(){var r,a,f,c;try{a=this,r=o(arguments),f="function"==typeof t?t(r,a):t||{}}catch(u){d([u,"",[r,a,i],f])}s(e+"start",[r,a,i],f);try{return c=n.apply(a,r)}catch(p){throw s(e+"err",[r,a,p],f),p}finally{s(e+"end",[r,a,c],f)}}return r(n)?n:(e||(e=""),nrWrapper[a]=n,p(n,nrWrapper),nrWrapper)}function u(n,e,i,o){i||(i="");var a,f,c,u="-"===i.charAt(0);for(c=0;c<e.length;c++)f=e[c],a=n[f],r(a)||(n[f]=t(a,u?f+i:i,o,f))}function s(t,r,i){if(!c||e){var o=c;c=!0;try{n.emit(t,r,i,e)}catch(a){d([a,t,r,i])}c=o}}function p(n,e){if(Object.defineProperty&&Object.keys)try{var t=Object.keys(n);return t.forEach(function(t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){return n[t]=e,e}})}),e}catch(r){d([r])}for(var i in n)f.call(n,i)&&(e[i]=n[i]);return e}function d(e){try{n.emit("internal-error",e)}catch(t){}}return n||(n=i),t.inPlace=u,t.flag=a,t}},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="./03. File Formats - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./03. File Formats - Database Internals_files/css" rel="stylesheet" type="text/css"><title>3. File Formats - Database Internals</title><link rel="stylesheet" href="./03. File Formats - Database Internals_files/output.8054605313ed.css" type="text/css"><link rel="stylesheet" type="text/css" href="./03. File Formats - Database Internals_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./03. File Formats - Database Internals_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}#sbo-rt-content p[data-type="footnote"] sup{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important}#sbo-rt-content p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}#sbo-rt-content p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}#sbo-rt-content a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content table.border tbody>tr:last-child>td{border-bottom:transparent}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .width-10{width:10vw !important}#sbo-rt-content .width-20{width:20vw !important}#sbo-rt-content .width-30{width:30vw !important}#sbo-rt-content .width-40{width:40vw !important}#sbo-rt-content .width-50{width:50vw !important}#sbo-rt-content .width-60{width:60vw !important}#sbo-rt-content .width-70{width:70vw !important}#sbo-rt-content .width-80{width:80vw !important}#sbo-rt-content .width-90{width:90vw !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100vw !important}#sbo-rt-content .width-10{width:10% !important}#sbo-rt-content .width-20{width:20% !important}#sbo-rt-content .width-30{width:30% !important}#sbo-rt-content .width-40{width:40% !important}#sbo-rt-content .width-50{width:50% !important}#sbo-rt-content .width-60{width:60% !important}#sbo-rt-content .width-70{width:70% !important}#sbo-rt-content .width-75{width:75% !important}#sbo-rt-content .width-80{width:80% !important}#sbo-rt-content .width-90{width:90% !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100% !important}</style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781492040330/chapter/ch14.html",
          "book_id": "9781492040330",
          "chapter_uri": "ch14.html",
          "position": 0,
          "user_uuid": "78724200-da8c-4410-821c-6ec73f6340d0",
          "next_chapter_uri": "/library/view/database-internals/9781492040330/afterword02.html"
        
      },
      title: "Database Internals",
      author_list: "Alex Petrov",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./03. File Formats - Database Internals_files/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta name="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta property="og:title" content="14. Consensus"><meta itemprop="isPartOf" content="/library/view/database-internals/9781492040330/"><meta itemprop="name" content="14. Consensus"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781492040330/"><meta property="og:description" itemprop="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O&#39;Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781492040347"><meta property="og:book:author" itemprop="author" content="Alex Petrov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '78724200-da8c-4410-821c-6ec73f6340d0';
      dataLayer.push({userIdentifier: '78724200-da8c-4410-821c-6ec73f6340d0'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '274b3493-4443-4dee-a486-ec0579099f2c';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./03. File Formats - Database Internals_files/vendor.b72079115638.js"></script><script defer="" src="./03. File Formats - Database Internals_files/reader.25f0dd727df4.js"></script><script src="./03. File Formats - Database Internals_files/f(1).txt"></script><script src="./03. File Formats - Database Internals_files/f(2).txt"></script><script src="./03. File Formats - Database Internals_files/f(3).txt"></script><script async="" src="./03. File Formats - Database Internals_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 2147483020;
}
.annotator-filter {
  z-index: 2147483010;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/78724200-da8c-4410-821c-6ec73f6340d0/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=collection&amp;sort=date_added&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Expert Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Practice</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/" class="l2 nav-icn"><span>Katacoda Scenarios</span></a></li><li><a href="https://learning.oreilly.com/interactive/#notebooks" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M10.0440191,12.1582649 C10.177209,12.3351976 10.2476998,12.552011 10.2434767,12.7742985 L10.2434767,13.9482829 L1.96869684,13.9482829 L1.96869684,12.7742985 C1.96418597,12.536863 2.04491894,12.3056731 2.19625329,12.1226596 L2.20142503,12.1226596 C3.18373453,10.9898864 4.60930376,10.339179 6.10867266,10.339179 C7.30793519,10.339179 8.45998426,10.7554703 9.37576632,11.5017585 L14.3434936,11.5017585 L14.3434936,3.65650645 L1.65650645,3.65650645 L1.65650645,11.5017585 L2.06682298,11.5017585 L1.82063306,12.1582649 L1.32825322,12.1582649 C1.14771395,12.1582649 1,12.010551 1,11.8300117 L1,3.32825322 C1,3.14771395 1.14771395,3 1.32825322,3 L14.6717468,3 C14.852286,3 15,3.14771395 15,3.32825322 L15,11.8300117 C15,12.010551 14.852286,12.1582649 14.6717468,12.1582649 L10.0440191,12.1582649 Z M12.5483683,7.16419284 C12.6159362,7.20929881 12.6563112,7.2853432 12.6558247,7.36658194 C12.6553382,7.44782068 12.6140555,7.5233761 12.5459522,7.56766966 L10.4270949,8.91581376 C10.3903366,8.94010203 10.3431312,8.9419685 10.3045699,8.9206583 C10.2660086,8.89934811 10.2424712,8.85838696 10.2434767,8.81434055 L10.2434767,5.91510593 C10.2420711,5.86982855 10.2666257,5.82771857 10.3067229,5.80664182 C10.3468202,5.78556507 10.3954292,5.7892172 10.431927,5.81604875 L12.5483683,7.16419284 Z M6.10608679,9.81089299 C4.9635781,9.81089299 4.03739181,8.8847067 4.03739181,7.74219802 C4.03739181,6.59968933 4.9635781,5.67350304 6.10608679,5.67350304 C7.24859547,5.67350304 8.17478176,6.59968933 8.17478176,7.74219802 C8.17478176,8.8847067 7.24859547,9.81089299 6.10608679,9.81089299 Z"></path></svg><span>Sandboxes</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/kubernetes-sandbox/9781492062820/" class="l2 nav-icn"><span>Kubernetes</span></a></li><li><a href="https://learning.oreilly.com/scenarios/python-sandbox/9781492062844/" class="l2 nav-icn"><span>Python</span></a></li><li><a href="https://learning.oreilly.com/scenarios/tensorflow-sandbox/9781492062851/" class="l2 nav-icn"><span>TensorFlow</span></a></li><li><a href="https://learning.oreilly.com/scenarios/ubuntu-sandbox/9781492062837/" class="l2 nav-icn"><span>Ubuntu</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/r/" class="l2 nav-icn"><span>Recommendations</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Release</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M13.4 9.8a.6.6 0 0 1 .6.6v1.2h-1.2l-.6 2.4H3.8l-.6-2.4H2v-1.2a.6.6 0 0 1 .6-.6h10.8zM8 5.6a1.8 1.8 0 1 1-.001-3.599A1.8 1.8 0 0 1 8 5.6zm3.6 2.35v.95H4.4v-.95c0-.167.066-.33.19-.443A5.08 5.08 0 0 1 8 6.2a5.08 5.08 0 0 1 3.41 1.307c.124.113.19.276.19.444z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Training</span></a></li><li><a href="https://www.oreilly.com/conferences/?discount=learn" class="l2 nav-icn" target="&quot;_blank&quot;"><span>Conferences</span></a></li></ul></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Database Internals
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781492040330/chapter/ch14.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./03. File Formats - Database Internals_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html&amp;text=Database%20Internals&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2014.%20Consensus&amp;body=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html%0D%0Afrom%20Database%20Internals%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. B-Tree Basics</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Implementing B-Trees</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. File Formats"><div class="chapter" id="file_formats">
<h1><span class="label">Chapter 3. </span>File Formats</h1>


<p>With<a data-type="indexterm" data-primary="data" data-secondary="file formats" id="Dfileform03"></a><a data-type="indexterm" data-primary="file formats" data-secondary="on-disk structures" id="FFchallenge03"></a> the basic semantics of B-Trees covered, we are now ready to explore how exactly B-Trees and other structures are implemented on disk. We access the disk in a way that is different from how we access main memory: from an application developer’s perspective, memory accesses are mostly transparent. Because of virtual memory <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BHATTACHARJEE17">[BHATTACHARJEE17]</a>, we do not have to manage offsets manually. Disks are accessed using system calls (see <a href="https://databass.dev/links/54"><em class="hyperlink">https://databass.dev/links/54</em></a>). We usually have to specify the offset inside the target file, and then interpret on-disk representation into a form suitable for main memory.</p>

<p>This means that efficient<a data-type="indexterm" data-primary="on-disk data structures" id="idm46104533307096"></a> on-disk structures have to be designed with this distinction in mind. To do that, we have to come up with a file format that’s easy to construct, modify, and interpret. In this chapter, we’ll discuss general principles and practices that help us to design all sorts of on-disk structures, not only B-Trees.</p>

<p>There are numerous possibilities for B-Tree implementations, and here we discuss several useful techniques. Details may vary between implementations, but the general principles remain the same. Understanding the basic mechanics of B-Trees, such as splits and merges, is necessary, but they are insufficient for the actual implementation. There are many things that have to play together for the final result to be useful.</p>

<p>The semantics of pointer management in on-disk structures are somewhat different from in-memory ones. It is useful to think of on-disk B-Trees as a page management mechanism: algorithms have to compose and<a data-type="indexterm" data-primary="pages" id="idm46104533305192"></a> navigate <em>pages</em>. Pages and pointers to them have to be calculated and placed accordingly.</p>

<p class="pagebreak-before">Since most of the complexity in B-Trees comes from mutability, we discuss details of page layouts, splitting, relocations, and other concepts applicable to mutable data structures. Later, when talking about LSM Trees (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch07.html#lsm_trees">“LSM Trees”</a>), we focus on sorting and maintenance, since that’s where most LSM complexity comes from.</p>






<section data-type="sect1" data-pdf-bookmark="Motivation"><div class="sect1" id="idm46104533301400">
<h1>Motivation</h1>

<p>Creating a file format is in many ways similar to how we create data structures in languages with an unmanaged memory model. We allocate a block of data and slice it any way we like, using fixed-size primitives and structures. If we want to reference a larger chunk of memory or a structure with variable size, we use pointers.</p>

<p>Languages with an unmanaged memory model allow us to allocate more memory any time we need (within reasonable bounds) without us having to think or worry about whether or not there’s a contiguous memory segment available, whether or not it is fragmented, or what happens after we free it. On disk, we have to take care of garbage collection and fragmentation ourselves.</p>

<p>Data layout is much less important in memory than on disk. For a disk-resident data structure to be efficient, we need to lay out data on disk in ways that allow quick access to it, and consider the specifics of a persistent storage medium, come up with binary data formats, and find a means to serialize and deserialize data efficiently.</p>

<p>Anyone who has ever used a low-level language such as C without additional libraries knows the constraints. Structures have a predefined size and are allocated and freed explicitly. Manually implementing memory allocation and tracking is even more challenging, since it is only possible to operate with memory segments of predefined size, and it is necessary to track which segments are already released and which ones are still in use.</p>

<p>When storing data in main memory, most of the problems with memory layout do not exist, are easier to solve, or can be solved using third-party libraries. For example, handling variable-length fields and oversize data is much more straightforward, since we can use memory allocation and pointers, and do not need to lay them out in any special way. There still are cases when developers design specialized main memory data layouts to take advantage of CPU cache lines, prefetching, and other hardware-related specifics, but this is mainly done for optimization purposes <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#FOWLER11">[FOWLER11]</a>.</p>

<p>Even though the operating system and filesystem take over some of the responsibilities, implementing on-disk structures requires attention to more details and has more pitfalls.<a data-type="indexterm" data-primary="" data-startref="FFchallenge03" id="idm46104533308040"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Binary Encoding"><div class="sect1" id="idm46104533291688">
<h1>Binary Encoding</h1>

<p>To<a data-type="indexterm" data-primary="binary encoding" data-secondary="page layouts" id="idm46104533294888"></a><a data-type="indexterm" data-primary="file formats" data-secondary="binary encoding" id="FFbinary03"></a> store data on disk efficiently, it needs to be encoded using a format that is compact and easy to serialize and deserialize. When talking about binary formats, you hear the word <em>layout</em> quite often. Since we do not have primitives such as <code>malloc</code> and <code>free</code>, but only <code>read</code> and <code>write</code>, we have to think of accesses differently and prepare data accordingly.</p>

<p>Here, we discuss the main principles used to create efficient page layouts. These principles apply to any binary format: you can use similar guidelines to create file and serialization formats or communication protocols.</p>

<p>Before we can organize records into pages, we need to understand how to represent keys and data records in binary form, how to combine multiple values into more complex structures, and how to implement variable-size types and arrays.</p>








<section data-type="sect2" data-pdf-bookmark="Primitive Types"><div class="sect2" id="idm46104533288984">
<h2>Primitive Types</h2>

<p>Keys and values<a data-type="indexterm" data-primary="binary encoding" data-secondary="primitive types" id="idm46104533296424"></a><a data-type="indexterm" data-primary="primitive types" id="idm46104533284824"></a><a data-type="indexterm" data-primary="types" id="idm46104533284120"></a> have a <em>type</em>, such as <code>integer</code>, <code>date</code>, or <code>string</code>, and can be represented (serialized to and deserialized from) in their raw binary forms.</p>

<p>Most numeric data types are represented as fixed-size values. When working with multibyte numeric values, it is important to use the<a data-type="indexterm" data-primary="byte-order" id="idm46104533278616"></a> same <em>byte-order</em> (<em>endianness</em>) for both encoding and decoding. Endianness determines the sequential order of bytes:</p>
<dl>
<dt>Big-endian</dt>
<dd>
<p>The<a data-type="indexterm" data-primary="big-endian byte order" id="idm46104533276664"></a> order starts from the<a data-type="indexterm" data-primary="most-significant byte (MSB)" id="idm46104533275864"></a> most-significant byte (MSB), followed by the bytes in <em>decreasing</em> significance order. In other words, MSB has the <em>lowest</em> address.</p>
</dd>
<dt>Little-endian</dt>
<dd>
<p>The<a data-type="indexterm" data-primary="little-endian byte order" id="idm46104533272552"></a><a data-type="indexterm" data-primary="least-significant byte (LSB)" id="idm46104533272056"></a> order starts from the least-significant byte (LSB), followed by the bytes in <em>increasing</em> significance order.</p>
</dd>
</dl>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#endianness_1">Figure&nbsp;3-1</a> illustrates this. The hexadecimal 32-bit integer <code>0xAABBCCDD</code>, where <code>AA</code> is the MSB, is shown using both big- and little-endian byte order.</p>

<figure><div id="endianness_1" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0301.png" alt="dbin 0301" width="1441" height="182" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0301.png">
<h6><span class="label">Figure 3-1. </span>Big- and little-endian byte order. The most significant byte is shown in gray. Addresses, denoted by <code>a</code>, grow from left to right.</h6>
</div></figure>

<p class="pagebreak-before">For example, to reconstruct<a data-type="indexterm" data-primary="platform byte order" id="idm46104533266104"></a> a 64-bit integer with a corresponding byte order, RocksDB has platform-specific definitions that help to identify target <a href="https://databass.dev/links/55">platform byte order</a>.<sup><a data-type="noteref" id="idm46104533263640-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#idm46104533263640" class="totri-footnote">1</a></sup> If the target platform endianness does not match value endianness (<a href="https://databass.dev/links/56"><code>EncodeFixed64WithEndian</code></a> looks up <code>kLittleEndian</code> value and compares it with value endianness), it reverses the bytes using <a href="https://databass.dev/links/57"><code>EndianTransform</code></a>, which reads values byte-wise in reverse order and appends them to the result.</p>

<p>Records consist of primitives like numbers, strings, booleans, and their combinations. However, when transferring data over the network or storing it on disk, we can only use byte sequences. This means that, in order to send or write the record, we<a data-type="indexterm" data-primary="serialization" id="idm46104533258664"></a><a data-type="indexterm" data-primary="data" data-secondary="serialization of" id="idm46104533258296"></a> have to <em>serialize</em> it (convert it to an interpretable sequence of bytes) and, before we can use it after receiving or reading, we have<a data-type="indexterm" data-primary="deserialization" id="idm46104533256856"></a><a data-type="indexterm" data-primary="data" data-secondary="deserialization of" id="idm46104533256472"></a> to <em>deserialize</em> it (translate the sequence of bytes back to the original record).</p>

<p>In binary data formats, we always start with primitives that serve as building blocks for more complex structures. Different numeric types may vary in size. <code>byte</code> value is 8 bits, <code>short</code> is 2 bytes (16 bits), <code>int</code> is 4 bytes (32 bits), and <code>long</code> is 8 bytes (64 bits).</p>

<p>Floating-point numbers<a data-type="indexterm" data-primary="floating-point numbers" id="idm46104533252040"></a><a data-type="indexterm" data-primary="sign" id="idm46104533250776"></a><a data-type="indexterm" data-primary="fraction" id="idm46104533250168"></a><a data-type="indexterm" data-primary="exponent" id="idm46104533249432"></a><a data-type="indexterm" data-primary="IEEE Standard for Floating-Point Arithmetic" id="idm46104533248600"></a> (such as <code>float</code> and <code>double</code>) are represented by their <em>sign</em>, <em>fraction</em>, and <em>exponent</em>. The <a href="https://ieeexplore.ieee.org/document/30711">IEEE Standard for Binary Floating-Point Arithmetic</a> (IEEE 754) standard describes widely accepted floating-point number representation. A 32-bit <code>float</code> represents a single-precision value. For example, a floating-point number <code>0.15652</code> has a binary representation, as shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#single_precision_float">Figure&nbsp;3-2</a>. The first 23 bits represent a fraction, the following 8 bits represent an exponent, and 1 bit represents a sign (whether or not the number is negative).</p>

<figure><div id="single_precision_float" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0302.png" alt="dbin 0302" width="1440" height="150" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0302.png">
<h6><span class="label">Figure 3-2. </span>Binary representation of single-precision float number</h6>
</div></figure>

<p>Since a floating-point value is calculated using fractions, the number this representation yields is just an approximation. Discussing a complete conversion algorithm is out of the scope of this book, and we only cover representation basics.</p>

<p>The <code>double</code> represents a double-precision floating-point value <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#SAVARD05">[SAVARD05]</a>. Most programming languages have means for encoding and decoding floating-point values to and from their binary representation in their standard libaries.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Strings and Variable-Size Data"><div class="sect2" id="idm46104533282840">
<h2>Strings and Variable-Size Data</h2>

<p>All<a data-type="indexterm" data-primary="binary encoding" data-secondary="strings and variable-size data" id="idm46104533237640"></a><a data-type="indexterm" data-primary="strings" id="idm46104533236792"></a><a data-type="indexterm" data-primary="data" data-secondary="variable-size data" id="idm46104533234936"></a> primitive numeric types have a fixed size. Composing more complex values together is much like <code>struct</code><sup><a data-type="noteref" id="idm46104533231416-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#idm46104533231416" class="totri-footnote">2</a></sup> in C. You can combine primitive values into structures and use fixed-size arrays or pointers to other memory regions.</p>

<p>Strings and other variable-size data types (such as arrays of fixed-size data) can be serialized as a number, representing the length of the array or string, followed by <code>size</code> bytes: the actual data. For strings, this representation is often called <em>UCSD String</em> or <a href="https://databass.dev/links/59"><em>Pascal String</em></a>, named after the popular implementation of the Pascal programming language. We can express it in pseudocode as follows:</p>

<pre data-type="programlisting">String
{
    size    uint_16
    data    byte[size]
}</pre>

<p>An<a data-type="indexterm" data-primary="null-terminated strings" id="idm46104533233464"></a> alternative to Pascal strings is <em>null-terminated strings</em>, where the reader consumes the string byte-wise until the end-of-string symbol is reached. The Pascal string approach has several advantages: it allows finding out a length of a string in constant time, instead of iterating through string contents, and a language-specific string can be composed by slicing <code>size</code> bytes from memory and passing the byte array to a string constructor.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Bit-Packed Data: Booleans, Enums, and Flags"><div class="sect2" id="idm46104533225560">
<h2>Bit-Packed Data: Booleans, Enums, and Flags</h2>

<p>Booleans<a data-type="indexterm" data-primary="binary encoding" data-secondary="Booleans, enums, and flags" id="idm46104533224152"></a><a data-type="indexterm" data-primary="Booleans" id="idm46104533222488"></a> can be represented either by using a single byte, or encoding <code>true</code> and <code>false</code> as <code>1</code> and <code>0</code> values. Since a boolean has only two values, using an entire byte for its representation is wasteful, and developers often batch boolean values together in groups of eight, each boolean occupying just one bit. We say that every <code>1</code> bit is <em>set</em> and every <code>0</code> bit is <em>unset</em> or <em>empty</em>.</p>

<p><a href="https://databass.dev/links/60">Enums</a>, short<a data-type="indexterm" data-primary="enumerated types (enums)" id="idm46104533216936"></a> for <em>enumerated types</em>, can be represented as integers and are often used in binary formats and communication protocols. Enums are used to represent often-repeated low-cardinality values. For example, we can encode a B-Tree node type using an enum:</p>

<pre data-type="programlisting">enum NodeType {
   ROOT,     // 0x00h
   INTERNAL, // 0x01h
   LEAF      // 0x02h
};</pre>

<p>Another<a data-type="indexterm" data-primary="flags" id="idm46104533214440"></a> closely related concept is <em>flags</em>, kind of a combination of packed booleans and enums. Flags can represent nonmutually exclusive named boolean parameters. For example, we can use flags to denote whether or not the page holds value cells, whether the values are fixed-size or variable-size, and whether or not there are overflow pages associated with this node. Since every bit represents a flag value, we can only use power-of-two values for masks (since powers of two in binary always have a single set bit; for example, <code>2<sup>3</sup> == 8 == 1000b</code>, <code>2<sup>4</sup> == 16 == 0001 0000b</code>, etc.):</p>

<pre data-type="programlisting">int IS_LEAF_MASK         = 0x01h; // bit #1
int VARIABLE_SIZE_VALUES = 0x02h; // bit #2
int HAS_OVERFLOW_PAGES   = 0x04h; // bit #3</pre>

<p>Just<a data-type="indexterm" data-primary="" data-startref="FFbinary03" id="idm46104533211992"></a> like packed booleans, flag values can be read and written from the packed value<a data-type="indexterm" data-primary="bitmasks" id="idm46104533207144"></a> using <em>bitmasks</em> and bitwise operators. For example, in order to set a bit responsible for one of the flags, we can use bitwise <code>OR</code> (<code>|</code>) and a bitmask. Instead of a bitmask, we can use <em>bitshift</em> (<code>&lt;&lt;</code>) and a bit index. To unset the bit, we can use bitwise <code>AND</code> (<code>&amp;</code>) and the bitwise negation operator (<code>~</code>). To test whether or not the bit <code>n</code> is set, we can compare the result of a bitwise <code>AND</code> with <code>0</code>:</p>

<pre data-type="programlisting">// Set the bit
flags |= HAS_OVERFLOW_PAGES;
flags |= (1 &lt;&lt; 2);

// Unset the bit
flags &amp;= ~HAS_OVERFLOW_PAGES;
flags &amp;= ~(1 &lt;&lt; 2);

// Test whether or not the bit is set
is_set = (flags &amp; HAS_OVERFLOW_PAGES) != 0;
is_set = (flags &amp; (1 &lt;&lt; 2)) != 0;</pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="General Principles"><div class="sect1" id="idm46104533200968">
<h1>General Principles</h1>

<p>Usually, you<a data-type="indexterm" data-primary="file formats" data-secondary="general principles" id="idm46104533199304"></a> start designing a file format by deciding how the addressing is going to be done: whether the file is going to be split into same-sized pages, which are represented by a single block or multiple contiguous blocks. Most in-place update storage structures use pages of the same size, since it significantly simplifies read and write access. Append-only storage structures often write data page-wise, too: records are appended one after the other and, as soon as the page fills up in memory, it is flushed on disk.</p>

<p>The<a data-type="indexterm" data-primary="headers" id="idm46104533197880"></a><a data-type="indexterm" data-primary="trailers" id="idm46104533197144"></a> file usually starts with a fixed-size <em>header</em> and may end with a fixed-size <em>trailer</em>, which hold auxiliary information that should be accessed quickly or is required for decoding the rest of the file. The rest of the file is split into pages. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#file_organization_image">Figure&nbsp;3-3</a> shows this file organization schematically.</p>

<figure class="width-75"><div id="file_organization_image" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0303.png" alt="dbin 0303" width="1439" height="385" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0303.png">
<h6><span class="label">Figure 3-3. </span>File organization</h6>
</div></figure>

<p>Many data stores have a fixed schema, specifying the number, order, and type of fields the table can hold. Having a fixed schema helps to reduce the amount of data stored on disk: instead of repeatedly writing field names, we can use their positional <span class="keep-together">identifiers.</span></p>

<p>If we wanted to design a format for the company directory, storing names, birth dates, tax numbers, and genders for each employee, we could use several approaches. We could store the fixed-size fields (such as birth date and tax number) in the head of the structure, followed by the variable-size ones:</p>

<pre data-type="programlisting">Fixed-size fields:
| (4 bytes) employee_id                |
| (4 bytes) tax_number                 |
| (3 bytes) date                       |
| (1 byte)  gender                     |
| (2 bytes) first_name_length          |
| (2 bytes) last_name_length           |

Variable-size fields:
| (first_name_length bytes) first_name |
| (last_name_length bytes) last_name   |</pre>

<p>Now, to access <code>first_name</code>, we can slice <code>first_name_length</code> bytes after the fixed-size area. To access <code>last_name</code>, we can locate its starting position by checking the sizes of the variable-size fields that precede it. To avoid calculations involving multiple fields, we can<a data-type="indexterm" data-primary="offsets" id="idm46104533186936"></a> encode both <em>offset</em> and <em>length</em> to the fixed-size area. In this case, we can locate any variable-size field separately.</p>

<p>Building more complex structures usually involves building hierarchies: fields composed out of primitives, cells composed of fields, pages composed of cells, sections composed of pages, regions composed of sections, and so on. There are no strict rules you have to follow here, and it all depends on what kind of data you need to create a format for.</p>

<p>Database files often consist of multiple parts, with a lookup table aiding navigation and pointing to the start offsets of these parts written either in the file header, trailer, or in the separate file.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Page Structure"><div class="sect1" id="page_structure">
<h1>Page Structure</h1>

<p>Database systems <a data-type="indexterm" data-primary="file formats" data-secondary="page structure" id="idm46104533178728"></a><a data-type="indexterm" data-primary="pages" id="idm46104533182376"></a>store data records in data and index files. These files are partitioned into fixed-size units called <em>pages</em>, which often have a size of multiple filesystem blocks. Page sizes usually range from 4 to 16 Kb.</p>

<p>Let’s take a look<a data-type="indexterm" data-primary="leaf nodes" id="idm46104533181352"></a><a data-type="indexterm" data-primary="nonleaf nodes" id="idm46104533180360"></a><a data-type="indexterm" data-primary="nodes" id="idm46104533176552"></a><a data-type="indexterm" data-primary="blocks" id="idm46104533175944"></a> at the example of an on-disk B-Tree node. From a structure perspective, in B-Trees, we distinguish between the <em>leaf nodes</em> that hold keys and data records pairs, and <em>nonleaf nodes</em> that hold keys and pointers to other nodes. Each B-Tree node occupies one page or multiple pages linked together, so in the context of B-Trees the terms <em>node</em> and <em>page</em> (and even <em>block</em>) are often used interchangeably.</p>

<p>The original B-Tree paper <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BAYER72">[BAYER72]</a> describes a simple page organization for fixed-size data records, where each page is just a concatenation of triplets, as shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#organisation_of_b_tree_page">Figure&nbsp;3-4</a>: keys are denoted by <code>k</code>, associated values are denoted by <code>v</code>, and pointers to child pages are denoted by <code>p</code>.</p>

<figure><div id="organisation_of_b_tree_page" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0304.png" alt="dbin 0304" width="1439" height="126" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0304.png">
<h6><span class="label">Figure 3-4. </span>Page organization for fixed-size records</h6>
</div></figure>

<p>This approach is easy to follow, but has some downsides:</p>

<ul>
<li>
<p>Appending a key anywhere but the right side requires relocating elements.</p>
</li>
<li>
<p>It doesn’t allow managing or accessing variable-size records efficiently and works only for fixed-size data.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Slotted Pages"><div class="sect1" id="slotted_pages">
<h1>Slotted Pages</h1>

<p>When<a data-type="indexterm" data-primary="file formats" data-secondary="slotted pages" id="idm46104533162248"></a><a data-type="indexterm" data-primary="slotted pages" id="idm46104533161048"></a> storing variable-size records, the main problem is free space management: reclaiming the space occupied by removed records. If we attempt to put a record of size <code>n</code> into the space previously occupied by the record of size <code>m</code>, unless <code>m == n</code> or we can find another record that has a size exactly <code>m – n</code>, this space will remain unused. Similarly, a segment of size <code>m</code> cannot be used to store a record of size <code>k</code> if <code>k</code> is larger than <code>m</code>, so it will be inserted without reclaiming the unused space.</p>

<p>To simplify space management for variable-size records, we can split the page into fixed-size segments. However, we end up wasting space if we do that, too. For example, if we use a segment size of 64 bytes, unless the record size is a multiple of 64, we waste <code>64 - (n modulo 64)</code> bytes, where <code>n</code> is the size of the inserted record. In other words, unless the record is a multiple of 64, one of the blocks will be only partially filled.</p>

<p>Space reclamation can be done by simply rewriting the page and moving the records around, but we need to preserve record offsets, since out-of-page pointers might be using these offsets. It is desirable to do that while minimizing space waste, too.</p>

<p>To summarize, we need a page format that allows us to:</p>

<ul>
<li>
<p>Store variable-size records with a minimal overhead.</p>
</li>
<li>
<p>Reclaim space occupied by the removed records.</p>
</li>
<li>
<p>Reference records in the page without regard to their exact locations.</p>
</li>
</ul>

<p>To<a data-type="indexterm" data-primary="binary large objects (BLOBs)" id="idm46104533152888"></a><a data-type="indexterm" data-primary="strings" id="idm46104533148696"></a> efficiently store variable-size records such as strings, binary large objects (BLOBs), etc., we can use an organization technique called <em>slotted page</em> (i.e., a page with slots) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#SILBERSCHATZ10">[SILBERSCHATZ10]</a> or<a data-type="indexterm" data-primary="slot directory" id="idm46104533146904"></a> <em>slot directory</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAMAKRISHNAN03">[RAMAKRISHNAN03]</a>. This approach is used by many databases, for example, <a href="https://databass.dev/links/61">PostgreSQL</a>.</p>

<p>We organize the page into a collection of <em>slots</em> or <em>cells</em> and split out pointers and cells in two independent memory regions residing on different sides of the page. This means that we only need to reorganize pointers addressing the cells to preserve the order, and deleting a record can be done either by nullifying its pointer or removing it.</p>

<p>A slotted page has a fixed-size header that holds important information about the page and cells (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#page_header">“Page Header”</a>). Cells may differ in size and can hold arbitrary data: keys, pointers, data records, etc. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#slotted_page_1">Figure&nbsp;3-5</a> shows a slotted page organization, where every page has a maintenance region (header), cells, and pointers to them.</p>

<figure class="width-50"><div id="slotted_page_1" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0305.png" alt="dbin 0305" width="906" height="704" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0305.png">
<h6><span class="label">Figure 3-5. </span>Slotted page</h6>
</div></figure>

<p class="pagebreak-before">Let’s see how this approach fixes the problems we stated in the beginning of this <span class="keep-together">section:</span></p>

<ul>
<li>
<p>Minimal overhead: the only overhead incurred by slotted pages is a pointer array holding offsets to the exact positions where the records are stored.</p>
</li>
<li>
<p>Space reclamation: space can be reclaimed by defragmenting and rewriting the page.</p>
</li>
<li>
<p>Dynamic layout: from outside the page, slots are referenced only by their IDs, so the exact location is internal to the page.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Cell Layout"><div class="sect1" id="idm46104533163752">
<h1>Cell Layout</h1>

<p>Using<a data-type="indexterm" data-primary="file formats" data-secondary="cell layout" id="idm46104533131672"></a><a data-type="indexterm" data-primary="cells" data-secondary="cell layout" id="idm46104533130488"></a> flags, enums, and primitive values, we can start designing the cell layout, then combine cells into pages, and compose a tree out of the pages. On a cell level, we have a distinction between key and key-value cells. Key cells hold a separator key and a pointer to the page <em>between</em> two neighboring pointers. Key-value cells hold keys and data records associated with them.</p>

<p>We assume that all cells within the page are uniform (for example, all cells can hold either just keys or both keys and values; similarly, all cells hold either fixed-size or variable-size data, but not a mix of both). This means we can store metadata describing cells once on the page level, instead of duplicating it in every cell.</p>

<p>To compose a key cell, we need to know:</p>

<ul>
<li>
<p>Cell type (can be inferred from the page metadata)</p>
</li>
<li>
<p>Key size</p>
</li>
<li>
<p>ID of the child page this cell is pointing to</p>
</li>
<li>
<p>Key bytes</p>
</li>
</ul>

<p>A variable-size key cell layout might look something like this (a fixed-size one would have no size specifier on the cell level):</p>

<pre data-type="programlisting">0                4               8
+----------------+---------------+-------------+
| [int] key_size | [int] page_id | [bytes] key |
+----------------+---------------+-------------+</pre>

<p>We have grouped fixed-size data fields together, followed by <code>key_size</code> bytes. This is not strictly necessary but can simplify offset calculation, since all fixed-size fields can be accessed by using static, precomputed offsets, and we need to calculate the offsets only for the variable-size data.</p>

<p class="pagebreak-before">The key-value cells hold data records instead of the child page IDs. Otherwise, their structure is similar:</p>

<ul>
<li>
<p>Cell type (can be inferred from page metadata)</p>
</li>
<li>
<p>Key size</p>
</li>
<li>
<p>Value size</p>
</li>
<li>
<p>Key bytes</p>
</li>
<li>
<p>Data record bytes</p>
</li>
</ul>

<pre data-type="programlisting">0              1                5 ...
+--------------+----------------+
| [byte] flags | [int] key_size |
+--------------+----------------+

5                  9                    .. + key_size
+------------------+--------------------+----------------------+
| [int] value_size |     [bytes] key    | [bytes] data_record  |
+------------------+--------------------+----------------------+</pre>

<p>You might have noticed the distinction<a data-type="indexterm" data-primary="offsets" id="idm46104533113384"></a><a data-type="indexterm" data-primary="page ID" id="idm46104533112424"></a> between the <em>offset</em> and <em>page ID</em> here. Since pages have a fixed size and are managed by the page cache (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#buffer_pool">“Buffer Management”</a>), we only need to store the page ID, which is later translated to the actual offset in the file using the lookup table. <em>Cell offsets</em> are<a data-type="indexterm" data-primary="cell offsets" id="idm46104533110248"></a> page-local and are relative to the page start offset: this way we can use a smaller cardinality integer to keep the representation more compact.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104533108808">
<h5>Variable-Size Data</h5>
<p>It<a data-type="indexterm" data-primary="data" data-secondary="variable-size data" id="idm46104533107224"></a> is not necessary for the key and value in the cell to have a fixed size. Both the key and value can have a variable size. Their locations can be calculated from the fixed-size cell header using offsets.</p>

<p>To locate the key, we skip the header and read <code>key_size</code> bytes. Similarly, to locate the value, we can skip the header plus <code>key_size</code> more bytes and read <code>value_size</code> bytes.</p>

<p>There are different ways to do the same; for example, by storing a total size and calculating the value size by subtraction. It all boils down to having enough information to slice the cell into subparts and reconstruct the encoded data.</p>
</div></aside>
</div></section>













<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Combining Cells into Slotted Pages"><div class="sect1" id="idm46104533132456">
<h1>Combining Cells into Slotted Pages</h1>

<p>To<a data-type="indexterm" data-primary="slotted pages" id="idm46104533101496"></a><a data-type="indexterm" data-primary="cells" data-secondary="organizing into pages" id="idm46104533100888"></a> organize cells into pages, we can use the <em>slotted page</em> technique that we discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#page_structure">“Page Structure”</a>. We append cells to the right side of the page (toward its end) and keep cell offsets/pointers in the left side of the page, as  shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#offset_and_cell_growth_direction">Figure&nbsp;3-6</a>.</p>

<figure><div id="offset_and_cell_growth_direction" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0306.png" alt="dbin 0306" width="1440" height="312" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0306.png">
<h6><span class="label">Figure 3-6. </span>Offset and cell growth direction</h6>
</div></figure>

<p>Keys can be inserted out of order and their logical sorted order is kept by sorting cell offset pointers in key order. This design allows appending cells to the page with minimal effort, since cells don’t have to be relocated during insert, update, or delete <span class="keep-together">operations.</span></p>

<p>Let’s consider an example of a page that holds names. Two names are added to the page, and their insertion order is: <em>Tom</em> and <em>Leslie</em>. As you can see in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#sorting_offsets_1">Figure&nbsp;3-7</a>, their <em>logical</em> order (in this case, alphabetical), does <em>not</em> match <em>insertion</em> order (order in which they were appended to the page). Cells are laid out in insertion order, but offsets are re-sorted to allow using binary search.</p>

<figure><div id="sorting_offsets_1" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0307.png" alt="dbin 0307" width="1439" height="298" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0307.png">
<h6><span class="label">Figure 3-7. </span>Records appended in random order: Tom, Leslie</h6>
</div></figure>

<p>Now, we’d like to add one more name to this page: <em>Ron</em>. New data is appended at the upper boundary of the free space of the page, but cell offsets have to preserve the lexicographical key order: <em>Leslie</em>, <em>Ron</em>, <em>Tom</em>. To do that, we have to reorder cell offsets: pointers after the <em>insertion point</em> are shifted to the right to make space for the new pointer to the Ron cell, as you can see in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#sorting_offsets_2">Figure&nbsp;3-8</a>.</p>

<figure><div id="sorting_offsets_2" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0308.png" alt="dbin 0308" width="1439" height="298" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0308.png">
<h6><span class="label">Figure 3-8. </span>Appending one more record: Ron</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Managing Variable-Size Data"><div class="sect1" id="idm46104533081832">
<h1>Managing Variable-Size Data</h1>

<p>Removing<a data-type="indexterm" data-primary="data" data-secondary="variable-size data" id="idm46104533080232"></a><a data-type="indexterm" data-primary="file formats" data-secondary="variable-size data" id="idm46104533079384"></a><a data-type="indexterm" data-primary="availability lists" id="idm46104533078536"></a> an item from the page does not have to remove the actual cell and shift other cells to reoccupy the freed space. Instead, the cell can be marked as deleted and an in-memory <em>availability list</em> can be updated with the amount of freed memory and a pointer to the freed value. The availability list stores offsets of freed segments and their sizes. When inserting a new cell, we first check the availability list to find if there’s a segment where it may fit. You can see an example of the fragmented page with available segments in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#page_fragmentation">Figure&nbsp;3-9</a>.</p>

<figure><div id="page_fragmentation" class="figure">
<img src="./03. File Formats - Database Internals_files/dbin_0309.png" alt="dbin 0309" width="1441" height="435" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0309.png">
<h6><span class="label">Figure 3-9. </span>Fragmented page and availability list. Occupied pages are shown in gray. Dotted lines represent pointers to unoccupied memory regions from the availability list.</h6>
</div></figure>

<p>SQLite calls unoccupied<a data-type="indexterm" data-primary="SQLite" data-secondary="unoccupied segments (freeblocks)" id="idm46104533070504"></a><a data-type="indexterm" data-primary="freeblocks" id="idm46104533073592"></a> segments <em>freeblocks</em> and stores a pointer to the first <a href="https://databass.dev/links/62">freeblock in the page header</a>. Additionally, it stores a total number of available bytes within the page to quickly check whether or not we can fit a new element into the page after defragmenting it.</p>

<p>Fit<a data-type="indexterm" data-primary="strategy" id="idm46104533069800"></a><a data-type="indexterm" data-primary="fit strategy" id="idm46104533069192"></a> is calculated based on the <em>strategy</em>:</p>
<dl>
<dt>First fit</dt>
<dd>
<p>This<a data-type="indexterm" data-primary="first fit strategy" id="idm46104533065864"></a><a data-type="indexterm" data-primary="best fit strategy" id="idm46104533065256"></a> might cause a larger overhead, since the space remaining after reusing the first suitable segment might be too small to fit any other cell, so it will be effectively wasted.</p>
</dd>
<dt>Best fit</dt>
<dd>
<p>For best fit, we try to find a segment for which insertion leaves the smallest remainder.</p>
</dd>
</dl>

<p>If we cannot find enough consecutive bytes to fit the new cell but there are enough fragmented bytes available, live cells are read and rewritten, defragmenting the page and reclaiming space for new writes. If there’s not enough free space even after defragmentation, we have to create an overflow page (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#overflow_pages">“Overflow Pages”</a>).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>To improve locality (especially when keys are small in size), some implementations store keys and values separately on the leaf level. Keeping keys together can improve the locality during the search. After the searched key is located, its value can be found in a value cell with a corresponding index. With variable-size keys, this requires us to calculate and store an additional value cell pointer.</p>
</div>

<p>In summary, to simplify B-Tree layout, we assume that each node occupies a single page. A page consists of a fixed-size header, cell pointer block, and cells. Cells hold keys and pointers to the pages representing child nodes or associated data records. B-Trees use simple pointer hierarchies: page identifiers to locate the child nodes in the tree file, and cell offsets to locate cells within the page.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Versioning"><div class="sect1" id="idm46104533052456">
<h1>Versioning</h1>

<p>Database systems<a data-type="indexterm" data-primary="binary encoding" data-secondary="versioning" id="idm46104533060104"></a><a data-type="indexterm" data-primary="file formats" data-secondary="versioning" id="idm46104533059256"></a><a data-type="indexterm" data-primary="versioning" id="idm46104533058344"></a> constantly evolve, and developers work to add features, and to fix bugs and performance issues. As a result of that, the binary file format can change. Most of the time, any storage engine version has to support more than one serialization format (e.g., current and one or more legacy formats for backward compatibility). To support that, we have to be able to find out which version of the file we’re up against.</p>

<p>This can be done in several ways. For example, Apache Cassandra is using version prefixes in filenames. This way, you can tell which version the file has without even opening it. As of version 4.0, a data file name has the <code>na</code> prefix, such as <em>na-1-big-Data.db</em>. Older files have different prefixes: files written in version 3.0 have the <code>ma</code> prefix.</p>

<p>Alternatively, the version can be stored in a separate file. For<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="versioning in" id="idm46104533054808"></a> example, <a href="https://databass.dev/links/63">PostgreSQL</a> stores the version in the <em>PG_VERSION</em> file.</p>

<p>The version can also be stored directly in the index file header. In this case, a part of the header (or an entire header) has to be encoded in a format that does not change between versions. After finding out which version the file is encoded with, we can create a version-specific reader to interpret the contents. Some file formats identify the version using magic numbers, which we discuss in more detail in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#magic_numbers">“Magic Numbers”</a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Checksumming"><div class="sect1" id="idm46104533049944">
<h1>Checksumming</h1>

<p>Files<a data-type="indexterm" data-primary="data" data-secondary="preventing loss of" id="idm46104533046040"></a><a data-type="indexterm" data-primary="file formats" data-secondary="checksumming" id="idm46104533045192"></a><a data-type="indexterm" data-primary="checksumming" id="idm46104533044280"></a><a data-type="indexterm" data-primary="cyclic redundancy checks (CRCs)" id="idm46104533043576"></a> on disk may get damaged or corrupted by software bugs and hardware failures. To identify these problems preemptively and avoid propagating corrupt data to other subsystems or even nodes, we can use checksums and cyclic redundancy checks (CRCs).</p>

<p>Some sources make no distinction between cryptographic and noncryptographic hash functions, CRCs, and checksums. What they all have in common is that they reduce a large chunk of data to a small number, but their use cases, purposes, and guarantees are different.</p>

<p>Checksums provide the weakest form of guarantee and aren’t able to detect corruption in multiple bits. They’re usually computed by using <code>XOR</code> with parity checks or summation <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#KOOPMAN15">[KOOPMAN15]</a>.</p>

<p>CRCs can help detect burst errors (e.g., when multiple consecutive bits got corrupted) and their implementations usually use lookup tables and polynomial division <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#STONE98">[STONE98]</a>. Multibit errors are crucial to detect, since a significant percentage of failures in communication networks and storage devices manifest this way.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Noncryptographic hashes and CRCs should not be used to verify whether or not the data has been tampered with. For this, you should always use strong cryptographic hashes designed for security. The main goal of CRC is to make sure that there were no unintended and accidental changes in data. These algorithms are not designed to resist attacks and intentional changes in data.</p>
</div>

<p>Before writing the data on disk, we compute its checksum and write it together with the data. When reading it back, we compute the checksum again and compare it with the written one. If there’s a checksum mismatch, we know that corruption has occurred and we should not use the data that was read.</p>

<p>Since computing a checksum over the whole file is often impractical and it is unlikely we’re going to read the entire content every time we access it, page checksums are usually computed on pages and placed in the page header. This way, checksums can be more robust (since they are performed on a small subset of the data), and the whole file doesn’t have to be discarded if corruption is contained in a single page.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm46104533039032">
<h1>Summary</h1>

<p>In this chapter, we learned about binary data organization: how to serialize primitive data types, combine them into cells, build slotted pages out of cells, and navigate these structures.</p>

<p>We learned how to handle variable-size data types such as strings, byte sequences, and arrays, and compose special cells that hold a size of values contained in them.</p>

<p>We discussed the slotted page format, which allows us to reference individual cells from outside the page by cell ID, store records in the insertion order, and preserve the key order by sorting cell offsets.</p>

<p>These principles can be used to compose binary formats for on-disk structures and network protocols.<a data-type="indexterm" data-primary="" data-startref="Dfileform03" id="idm46104533033992"></a></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104533029048">
<h5>Further Reading</h5>
<p>If you’d like to learn more about the concepts mentioned in this chapter, you can refer to the following sources:</p>
<dl>
<dt>File organization techniques</dt>
<dd>
<p>Folk, Michael J., Greg Riccardi, and Bill Zoellick. 1997. <em>File Structures: An Object-Oriented Approach with C++ (3rd Ed.)</em>. Boston: Addison-Wesley Longman.</p>

<p>Giampaolo, Dominic. 1998. <em>Practical File System Design with the Be File System (1st Ed.)</em>. San Francisco: Morgan Kaufmann.</p>

<p>Vitter, Jeffrey Scott. 2008. “Algorithms and data structures for external memory.” <em>Foundations and Trends in Theoretical Computer Science</em> 2, no. 4 (January): 305-474. <a href="https://doi.org/10.1561/0400000014"><em class="hyperlink">https://doi.org/10.1561/0400000014</em></a>.</p>
</dd>
</dl>
</div></aside>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm46104533263640"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#idm46104533263640-marker" class="totri-footnote">1</a></sup> Depending on the platform (macOS, Solaris, Aix, or one of the BSD flavors, or Windows), the <code>kLittleEndian</code> variable is set to whether or not the platform supports little-endian.</p><p data-type="footnote" id="idm46104533231416"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#idm46104533231416-marker" class="totri-footnote">2</a></sup> It’s worth noting that compilers can add padding to structures, which is also architecture dependent. This may break the assumptions about the exact byte offsets and locations. You can read more about structure packing here: <a href="https://databass.dev/links/58"><em class="hyperlink">https://databass.dev/links/58</em></a>.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-13" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. B-Tree Basics</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Implementing B-Trees</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  function decodeHtml(html) {
    var txt = document.createElement("textarea");
    txt.innerHTML = html;
    return txt.value;
  }

  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Database Internals',
      type: 'book',
      identifier: '9781492040330',
      topic: 'Data Warehousing, '
    },
    content: {
      title: 'Database Internals',
      formatType: 'book',
      identifier: '9781492040330',
      author: 'Alex Petrov',
      publisher: decodeHtml('O&#39;Reilly Media, Inc.'),
      releaseDate: '2019-10-08',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          

          
            <p>You have 6 days left in your trial, Iswade. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      
        


<footer class="pagefoot t-pagefoot" style="padding-bottom: 75px;">
  <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" class="icon-up" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2019 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"queueTime":3,"applicationTime":407,"errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","agent":"","licenseKey":"510f1a6865","applicationID":"172641827,79672898,93931619"}</script>

      
    
    <script src="./03. File Formats - Database Internals_files/saved_resource" charset="utf-8"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./03. File Formats - Database Internals_files/embed.js"></script>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("set","agent","tmgoogletagmanager","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>

<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>
<script type="text/javascript" id="">window._pp=window._pp||[];if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/register/")_pp.targetUrl="/confirm/trial";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/subscribe/")_pp.targetUrl="/confirm/paid";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/signup/")_pp.targetUrl="/confirm/paid";_pp.siteId="2508";
_pp.siteUId="78724200-da8c-4410-821c-6ec73f6340d0";_pp.orderValue="undefined";_pp.orderId="undefined";(function(){var ppjs=document.createElement("script");ppjs.type="text/javascript";ppjs.async=true;ppjs.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.pbbl.co/r/"+_pp.siteId+".js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ppjs,s)})();</script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.8761141995538091"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.039377343765153894" width="0" height="0" alt="" src="./03. File Formats - Database Internals_files/0"></div>
    <script src="./03. File Formats - Database Internals_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice">Sorry we could not read the annotations from the store</div><div class="font-flyout" style="top: 201.001px; left: 1557.4px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./03. File Formats - Database Internals_files/generic1576598380235.js" charset="UTF-8"></script><div style="display: none; visibility: hidden;"><script>(function(){if(null!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')&&void 0!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')){var a=!1;window.addEventListener("blur",function(){a&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"facebook",eventVal:0,nonInteraction:0})});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseover",function(){window.focus();
a=!0});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseout",function(){a=!1})}try{window.twttr=function(b,a,d){var c,e=b.getElementsByTagName(a)[0];if(!b.getElementById(d))return b=b.createElement(a),b.id=d,b.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(b,e),window.twttr||(c={_e:[],ready:function(a){c._e.push(a)}})}(document,"script","twitter-wjs"),twttr.ready(function(a){a.events.bind("tweet",trackTwitter)})}catch(b){}})();
null!==document.querySelector(".IN-widget")&&void 0!==document.querySelector(".IN-widget")&&document.querySelector(".IN-widget").addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"linkedin",eventVal:0,nonInteraction:0})});
function trackTwitter(a){a&&(a.target&&"IFRAME"==a.target.nodeName&&(opt_target=extractParamFromUri(a.target.src,"url")),dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0}))}function extractParamFromUri(a,b){if(a){var c=new RegExp("[\\?\x26#]"+b+"\x3d([^\x26#]*)");c=c.exec(a);if(null!=c)return unescape(c[1])}};</script></div><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./03. File Formats - Database Internals_files/widget_iframe.69e02060c7c44baddf1b5629549acc0c.html" title="Twitter settings iframe" style="display: none;"></iframe></body><div class="fika-reader-mode" id="fika-reader" style="display: none;"><div id="fika" class="fika-app theme-vanilla"><!--drawer--><div class="fika-tool"><!--open--><button class="fika-btn fika-btn-icon mr-1" id="fika-tool-btn" data-whats-new="menu"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg></button><!--toc--><button class="fika-btn fika-btn-icon" id="fika-toc-btn"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M4 13c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1zm-3 5c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1z"></path></svg><div class="fika-tooltip">TOC</div></button><button class="fika-btn fika-btn-icon" id="fika-settings" data-whats-new="settings"><svg class="fika-icon" width="20px" height="20px" viewBox="0 0 20 20"><path d="M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"></path></svg><div class="fika-tooltip">Settings</div></button><!--appearance settings--><div class="fika-menu"><div class="fika-menu-nav d-flex flex-column"><div class="fika-menu-nav-item active">Text</div><div class="fika-menu-nav-item">Theme</div><div class="fika-menu-nav-item fika-pro">Autopilot</div><div class="flex-fill"></div><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="fb" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://www.facebook.com/dialog/feed?app_id=393950891439557&amp;display=popup&amp;link=https://chrome.google.com/webstore/detail/fika-reader-mode/fbcdnjeoghampomjjaahjgjghdjdbbcj" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Share to Facebook</a><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="tw" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://twitter.com/intent/retweet?tweet_id=1117715831540965376" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Share to Twitter</a><a class="fika-menu-nav-item small mb-1" href="http://fika.io/updatelog" target="_blank">What's new</a><div class="fika-menu-nav-item static small" style="font-size: 12px;line-height: 16px;" id="fika-beta-info"><div class="fika-pro" style=" margin-left: -4px;"></div>Login and share Fika to gain BETA access.</div><!--<a class="fika-menu-nav-item small" href="http://fika.io/pro" target="_blank">Upgrade to Pro</a>--><div class="fika-menu-login"><div id="fika-login" class="px-2"><div class="mb-1">Log in</div><div>with Google account</div></div><div class="fika-loading" id="fika-loading-login" style="display: none;position: absolute;right: 16px;bottom: 24px;"></div></div></div><div class="fika-menu-view-cont"><!--text--><div class="fika-menu-view" style="display: block"><div class="fika-menu-label">Text</div><div class="fika-tab"><div class="fika-tab-item active" style="font-size:12px" data-sel="size-small">small</div><div class="fika-tab-item" style="font-size:14px" data-sel="size-medium">medium</div><div class="fika-tab-item" style="font-size:16px" data-sel="size-large">large</div></div><div class="fika-menu-label mt-3">Alignment</div><div class="fika-tab"><div class="fika-tab-item active" data-sel="align-normal">normal</div><div class="fika-tab-item" data-sel="align-justify">justify</div></div><div class="fika-menu-label mt-3">Font</div><div class="fika-select fika-select-fonts"><div class="fika-select-item font-arial" data-sel="font-arial">Arial</div><div class="fika-select-item font-courier" data-sel="font-courier">Courier</div><div class="fika-select-item font-georgia" data-sel="font-georgia">Georgia</div><div class="fika-select-item font-merriweather active" data-sel="font-merriweather">Merriweather</div><div class="fika-select-item font-openSans" data-sel="font-openSans">Open Sans</div><div class="fika-select-item font-palatino" data-sel="font-palatino">Palatino</div></div></div><!--theme--><div class="fika-menu-view" data-tab="theme"><div class="fika-menu-label">Theme Color</div><div class="fika-select-themes"><div class="fika-select-theme theme-vanilla active" data-sel="theme-vanilla"></div><div class="fika-select-theme theme-latte" data-sel="theme-latte"></div><div class="fika-select-theme theme-blabar" data-sel="theme-blabar"></div><div class="fika-select-theme theme-licorice" data-sel="theme-licorice"></div></div><div class="fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="mt-3 fika-menu-label fika-pro">Background</div><div class="my-2 d-flex fika-justify-space-between"><div class="fika-menu-label"><span class="fika-menu-label-sec">Photo Rotation</span><div class="fika-menu-label-desc">Rotate photo backgrounds everyday</div></div><input type="checkbox" id="fika-photo-bg" disabled=""><label class="fika-toggle" for="fika-photo-bg"></label></div><div class="d-flex fika-align-center mb-1 mt-2"><div class="fika-photo-grid-tab active" data-tab="photo">PHOTO</div><div class="ml-2 fika-photo-grid-tab" data-tab="color">COLOR</div></div><div class="fika-photo-grid" data-tab="photo"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div></div><div class="fika-photo-grid" data-tab="color" style="display: none;"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div><div class="fika-photo-grid-item" data-type="color" data-index="0" data-id="1"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#C3ACEA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="1" data-id="2"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FFC5CC"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="2" data-id="3"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F6D863"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="3" data-id="4"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FCF3CA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="4" data-id="5"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#B9E4C9"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="5" data-id="6"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#90F3E8"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="6" data-id="7"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#8FCAF2"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="7" data-id="8"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#293990"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="8" data-id="9"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#191D2D"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="9" data-id="10"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#111111"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="10" data-id="11"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F5F5F5"></div></div></div></div></div><!--autopilot--><div class="fika-menu-view fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="fika-menu-label mt-1"><div class="fika-pro">Autopilot</div><div class="fika-menu-label-desc">Automatically open Fika reader mode on whitelisted websites</div></div><div class="fika-menu-label d-flex fika-align-center"><svg width="24" height="24" class="fika-icon" style="opacity: 0.7;min-width:24px;" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><div class="ml-1 fika-menu-label-desc" style="margin-top: 0px;">Tip: whitelist current website</div></div><div class="fika-menu-label mt-3">Whitelist</div><div class="fika-select"><input class="fika-input" disabled="" id="fika-autopilot-input" type="url" placeholder="Add new website URL"><div class="fika-autopilot-whitelist"></div></div></div></div></div><!--print--><!--<button class="fika-btn fika-btn-icon" id="fika-print">--><!--<svg class="fika-icon" viewBox="0 0 24 24">--><!--<path d="M19,8H5c-1.7,0-3,1.3-3,3v6h4v4h12v-4h4v-6C22,9.3,20.7,8,19,8z M16,19H8v-5h8V19z M19,12c-0.5,0-1-0.4-1-1s0.5-1,1-1--><!--s1,0.4,1,1S19.5,12,19,12z M18,3H6v4h12V3z"/>--><!--</svg>--><!--</button>--><!--fullscreen--><button class="fika-btn fika-btn-icon" id="fika-fullscreen"><!--exit--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg><!--fs--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg><div class="fika-tooltip">Fullscreen</div></button><!--autopilot--><button class="fika-btn fika-btn-icon fika-pro-item fika-disabled" id="fika-autopilot-local" data-whats-new="autopilot-local"><!--on  .on--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><!--off--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M18 6l-2.91 6.26 5.25 5.25C21.39 15.93 22 14.04 22 12c0-5.52-4.48-10-10-10-2.04 0-3.93.61-5.51 1.66l5.25 5.25L18 6zM2.81 5.64l.85.85c-1.37 2.07-2 4.68-1.48 7.45.75 3.95 3.92 7.13 7.88 7.88 2.77.52 5.38-.1 7.45-1.48l.85.85c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.22 4.22c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.03 0 1.42zm6.1 6.1l3.35 3.35L6 18l2.91-6.26z"></path></svg><div class="fika-tooltip">Autopilot</div></button></div><div class="fika-drawer"><div class="my-2 d-flex fika-align-center fika-justify-space-between"><div class="fika-select-label" style="margin: 8px">Table of content</div><button class="fika-btn fika-btn-icon ml-1 fika-drawer-close"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><div class="fika-drawer-content"><div class="fika-drawer-content-wrap"><!-- ** toc--><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div></div></div><!--overlay--><div class="fika-overlay"></div><!--paper--><div class="fika-main-body"><div class="fika-toc-static fika-toc-static-active"><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div><div class="fika-paper"><div class="fika-article size-small font-merriweather align-normal"><div class="fika-article-domain"><img src="./03. File Formats - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><span>learning.oreilly.com</span></div><div class="fika-article-title" id="237.8510044098481">14. Consensus - Database Internals</div><div class="fika-article-divider"></div><div class="fika-content"><div><h2 id="6615.593398842472">Egalitarian Paxos</h2><p>Using a distinguished proposer as a leader makes a system prone to failures: as soon as the leader fails, the system has to elect a new one before it can proceed with further steps. Another problem is that having a leader can put a disproportionate load on it, impairing system performance.</p><div><h6 id="508.40453387557494">Note</h6><p>One of the ways to avoid putting an entire system load on the leader is <em>partitioning</em>. Many systems split the range of possible values into smaller segments and allow a part of the system to be responsible for a specific range without having to worry about the other parts. This helps with availability (by isolating failures to a single partition and preventing propagation to other parts of the system), performance (since segments serving different values are nonoverlapping), and scalability (since we can scale the system by increasing the number of partitions). It is important to keep in mind that performing an operation against <em>multiple</em> partitions will require an atomic commitment.</p></div><p>Instead of using a leader and proposal numbers for sequencing commands, we can use a leader responsible for the commit of the <em>specific</em> command, and establish the order by looking up and setting dependencies. This approach is commonly called Egalitarian Paxos, or EPaxos <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU11" target="_blank">[MORARU11]</a>. The idea of allowing nonconflicting writes to be committed to the replicated state machine independently was first introduced in <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT05" target="_blank">[LAMPORT05]</a> and called Generalized Paxos. EPaxos is a first implementation of Generalized Paxos.</p><p>EPaxos attempts to offer benefits of both the classic Paxos algorithm and Multi-Paxos. Classic Paxos offers high availability, since a leader is established during each round, but has a higher message complexity. Multi-Paxos offers high throughput and requires fewer messages, but a leader may become a bottleneck.</p><p>EPaxos starts with a <em>Pre-Accept</em> phase, during which a process becomes a leader for the specific proposal. Every proposal has to include:</p><dl><dt>Dependencies</dt><dd><p>All commands that potentially interfere with a current proposal, but are not necessarily already committed.</p></dd><dt>A sequence number</dt><dd><p>This breaks cycles between the dependencies. Set it with a value larger than any sequence number of the known dependencies.</p></dd></dl><p>After collecting this information, it forwards a <code>Pre-Accept</code> message to a <em>fast quorum</em> of replicas. A fast quorum is <code>⌈3f/4⌉</code> replicas, where <code>f</code> is the number of tolerated <span>failures.</span></p><p>Replicas check their local command logs, update the proposal dependencies based on their view of potentially conflicting proposals, and send this information back to the leader. If the leader receives responses from a fast quorum of replicas, and their dependency lists are in agreement with each other and the leader itself, it can commit the command.</p><p>If the leader does not receive enough responses or if the command lists received from the replicas differ and contain interfering commands, it updates its proposal with a new dependency list and a sequence number. The new dependency list is based on previous replica responses and combines <em>all</em> collected dependencies. The new sequence number has to be larger than the highest sequence number seen by the replicas. After that, the leader sends the new, updated command to <code>⌊f/2⌋ + 1</code> replicas. After this is done, the leader can finally commit the proposal.</p><p>Effectively, we have two possible scenarios:</p><dl><dt>Fast path</dt><dd><p>When dependencies match and the leader can safely proceed with the commit phase with only a <em>fast quorum</em> of replicas.</p></dd><dt>Slow path</dt><dd><p>When there’s a disagreement between the replicas, and their command lists have to be updated before the leader can proceed with a commit.</p></dd></dl><p><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#epaxos_1" target="_blank">Figure&nbsp;14-8</a> shows these scenarios—<code>P<sub>1</sub></code> initiating a fast path run, and <code>P<sub>5</sub></code> initiating a slow path run:</p><ul><li><p><code>P<sub>1</sub></code> starts with proposal number <code>1</code> and no dependencies, and sends a <code>PreAccept(1, ∅)</code> message. Since the command logs of <code>P<sub>2</sub></code> and <code>P<sub>3</sub></code> are empty, <code>P<sub>1</sub></code> can proceed with a commit.</p></li><li><p><code>P<sub>5</sub></code> creates a proposal with sequence number <code>2</code>. Since its command log is empty by that point, it also declares no dependencies and sends a <code>PreAccept(2, ∅)</code> message. <code>P<sub>4</sub></code> is not aware of the committed proposal <code>1</code>, but <code>P<sub>3</sub></code> notifies <code>P<sub>5</sub></code> about the conflict and sends its command log: <code>{1}</code>.</p></li><li><p><code>P<sub>5</sub></code> updates its local dependency list and sends a message to make sure replicas have the same dependencies: <code>Accept(2,{1})</code>. As soon as the replicas respond, it can commit the value.</p></li></ul><figure><div><img src="./03. File Formats - Database Internals_files/dbin_1408.png" alt="dbin 1408" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1408.png" style="display: block; margin: 32px auto;"><h6 id="247.8583250215993"><span>Figure 14-8. </span>EPaxos algorithm run</h6></div></figure><p>Two commands, <code>A</code> and <code>B</code>, interfere only if their execution order matters; in other words, if executing <code>A</code> before <code>B</code> and executing <code>B</code> before <code>A</code> produce different results.</p><p>Commit is done by responding to the client and asynchronously notifying replicas with a <code>Commit</code> message. Commands are executed <em>after</em> they’re committed.</p><p>Since dependencies are collected during the Pre-Accept phase, by the time requests are executed, the command order is already established and no command can suddenly appear somewhere in-between: it can only get appended <em>after</em> the command with the largest sequence number.</p><p>To execute a command, replicas build a dependency graph and execute all commands in a reverse dependency order. In other words, before a command can be executed, all its dependencies (and, subsequently, all their dependencies) have to be executed. Since only interfering commands have to depend on each other, this situation should be relatively rare for most workloads <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU13" target="_blank">[MORARU13]</a>.</p><p>Similar to Paxos, EPaxos uses proposal numbers, which prevent stale messages from being propagated. Sequence numbers consist of an <em>epoch</em> (identifier of the current cluster configuration that changes when nodes leave and join the cluster), a monotonically incremented node-local counter, and a replica ID. If a replica receives a proposal with a sequence number lower than one it has already seen, it negatively acknowledges the proposal, and sends the highest sequence number and an updated command list known to it in response.</p></div></div></div><div class="fika-share"><div class="fika-share-divider"></div><div class="fika-share-buttons"><button id="fika-twitter-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg></button><button id="fika-facebook-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg></button></div></div><div class="fika-feedback my-6"><p id="fika-feedback-msg">Is Fika working properly on this site?</p><div class="my-3"><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress fika-feedback-button" data-match="1"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4.41-6.11c-.35-.22-.82-.11-1.03.24-.74 1.17-2 1.87-3.38 1.87s-2.64-.7-3.38-1.88c-.22-.35-.68-.46-1.03-.24-.35.22-.46.68-.24 1.03C8.37 16.54 10.1 17.5 12 17.5s3.63-.97 4.65-2.58c.22-.35.11-.81-.24-1.03z"></path></svg></button><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress ml-2 fika-feedback-button" data-match="0"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-1.9 0-3.63.97-4.65 2.58-.22.35-.11.81.24 1.03.35.22.81.11 1.03-.24.74-1.18 2-1.88 3.38-1.88s2.64.7 3.38 1.88c.14.23.39.35.64.35.14 0 .27-.04.4-.11.35-.22.46-.68.24-1.03C15.63 14.96 13.9 14 12 14z"></path></svg></button></div></div></div><div class="fika-footer"><a class="fika-footer-logo" href="http://fika.io/" target="_blank"><img style="" src="chrome-extension://fbcdnjeoghampomjjaahjgjghdjdbbcj/images/logo64.png">Made with love by Fika</a><div class="d-flex fika-align-center"><b>Alt+R (Option+R)</b>: to open Fika  <b class="ml-2">Esc</b>: to close reader mode</div></div></div><!--message toast--><div class="fika-toast"><span id="fika-toast-msg"></span><a class="ml-5" id="fika-toast-close">close</a></div><!--background photo--><div class="fika-bg"></div><div class="fika-loading" id="fika-loading-bg" style="display: none;position: fixed;right: 24px;bottom: 24px;"></div><a class="fika-bg-credit" target="_blank"></a></div></div></html>