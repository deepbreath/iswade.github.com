<!DOCTYPE html>
<!-- saved from url=(0084)https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/database-internals/9781492040330/ch14.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="6145663" data-user-uuid="78724200-da8c-4410-821c-6ec73f6340d0" data-username="iswade" data-account-type="Trial" data-activated-trial-date="12/14/2019" data-archive="9781492040330" data-publishers="O&#39;Reilly Media, Inc." data-htmlfile-name="ch14.html" data-epub-title="Database Internals" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781492040330"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/cool-2.1.15.min.js"></script><script type="text/javascript" src="./04. Implementing B-Trees - Database Internals_files/510f1a6865"></script><script id="twitter-wjs" src="./04. Implementing B-Trees - Database Internals_files/widgets.js"></script><script src="./04. Implementing B-Trees - Database Internals_files/nr-1153.min.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/ec.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/2508.js"></script><script src="./04. Implementing B-Trees - Database Internals_files/443792972845831" async=""></script><script src="./04. Implementing B-Trees - Database Internals_files/1732687426968531" async=""></script><script async="" src="./04. Implementing B-Trees - Database Internals_files/fbevents.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/analytics.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/bat.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/insight.min.js"></script><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/f.txt"></script><script async="" src="./04. Implementing B-Trees - Database Internals_files/gtm.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={licenseKey:"510f1a6865",applicationID:"172641827"};window.NREUM||(NREUM={}),__nr_require=function(n,e,t){function r(t){if(!e[t]){var i=e[t]={exports:{}};n[t][0].call(i.exports,function(e){var i=n[t][1][e];return r(i||e)},i,i.exports)}return e[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<t.length;i++)r(t[i]);return r}({1:[function(n,e,t){function r(){}function i(n,e,t){return function(){return o(n,[u.now()].concat(f(arguments)),e?null:this,t),e?void 0:this}}var o=n("handle"),a=n(4),f=n(5),c=n("ee").get("tracer"),u=n("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(n,e){s[e]=i(d+e,!0,"api")}),s.addPageAction=i(d+"addPageAction",!0),s.setCurrentRouteName=i(d+"routeName",!0),e.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(n,e){var t={},r=this,i="function"==typeof e;return o(l+"tracer",[u.now(),n,t],r),function(){if(c.emit((i?"":"no-")+"fn-start",[u.now(),r,i],t),i)try{return e.apply(this,arguments)}catch(n){throw c.emit("fn-err",[arguments,this,n],t),n}finally{c.emit("fn-end",[u.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(n,e){m[e]=i(l+e)}),newrelic.noticeError=function(n,e){"string"==typeof n&&(n=new Error(n)),o("err",[n,u.now(),!1,e])}},{}],2:[function(n,e,t){function r(n,e){var t=n.getEntries();t.forEach(function(n){"first-paint"===n.name?a("timing",["fp",Math.floor(n.startTime)]):"first-contentful-paint"===n.name&&a("timing",["fcp",Math.floor(n.startTime)])})}function i(n){if(n instanceof c&&!s){var e,t=Math.round(n.timeStamp);e=t>1e12?Date.now()-t:f.now()-t,s=!0,a("timing",["fi",t,{type:n.type,fid:e}])}}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var o,a=n("handle"),f=n("loader"),c=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){o=new PerformanceObserver(r);try{o.observe({entryTypes:["paint"]})}catch(u){}}if("addEventListener"in document){var s=!1,p=["click","keydown","mousedown","pointerdown","touchstart"];p.forEach(function(n){document.addEventListener(n,i,!1)})}}},{}],3:[function(n,e,t){function r(n,e){if(!i)return!1;if(n!==i)return!1;if(!e)return!0;if(!o)return!1;for(var t=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var f=navigator.userAgent,c=f.match(a);c&&f.indexOf("Chrome")===-1&&f.indexOf("Chromium")===-1&&(i="Safari",o=c[1])}e.exports={agent:i,version:o,match:r}},{}],4:[function(n,e,t){function r(n,e){var t=[],r="",o=0;for(r in n)i.call(n,r)&&(t[o]=e(r,n[r]),o+=1);return t}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],5:[function(n,e,t){function r(n,e,t){e||(e=0),"undefined"==typeof t&&(t=n?n.length:0);for(var r=-1,i=t-e||0,o=Array(i<0?0:i);++r<i;)o[r]=n[e+r];return o}e.exports=r},{}],6:[function(n,e,t){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(n,e,t){function r(){}function i(n){function e(n){return n&&n instanceof r?n:n?c(n,f,o):o()}function t(t,r,i,o){if(!d.aborted||o){n&&n(t,r,i);for(var a=e(i),f=v(t),c=f.length,u=0;u<c;u++)f[u].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(n,e){h[n]=v(n).concat(e)}function m(n,e){var t=h[n];if(t)for(var r=0;r<t.length;r++)t[r]===e&&t.splice(r,1)}function v(n){return h[n]||[]}function g(n){return p[n]=p[n]||i(t)}function w(n,e){u(n,function(n,t){e=e||"feature",y[t]=e,e in s||(s[e]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:e,buffer:w,abort:a,aborted:!1};return b}function o(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var f="nr@context",c=n("gos"),u=n(4),s={},p={},d=e.exports=i();d.backlog=s},{}],gos:[function(n,e,t){function r(n,e,t){if(i.call(n,e))return n[e];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(n,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return n[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(n,e,t){function r(n,e,t,r){i.buffer([n],r),i.emit(n,e,t)}var i=n("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(n,e,t){function r(n){var e=typeof n;return!n||"object"!==e&&"function"!==e?-1:n===window?0:a(n,o,function(){return i++})}var i=1,o="nr@id",a=n("gos");e.exports=r},{}],loader:[function(n,e,t){function r(){if(!x++){var n=E.info=NREUM.info,e=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(n&&n.licenseKey&&n.applicationID&&e))return s.abort();u(y,function(e,t){n[e]||(n[e]=t)}),c("mark",["onload",a()+E.offset],null,"api");var t=l.createElement("script");t.src="https://"+n.agent,e.parentNode.insertBefore(t,e)}}function i(){"complete"===l.readyState&&o()}function o(){c("mark",["domContent",a()+E.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(f=Math.max((new Date).getTime(),f))-E.offset}var f=(new Date).getTime(),c=n("handle"),u=n(4),s=n("ee"),p=n(3),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1153.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),E=e.exports={offset:f,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};n(1),n(2),l[m]?(l[m]("DOMContentLoaded",o,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",i),d[v]("onload",r)),c("mark",["firstbyte",f],null,"api");var x=0,O=n(6)},{}],"wrap-function":[function(n,e,t){function r(n){return!(n&&n instanceof Function&&n.apply&&!n[a])}var i=n("ee"),o=n(5),a="nr@original",f=Object.prototype.hasOwnProperty,c=!1;e.exports=function(n,e){function t(n,e,t,i){function nrWrapper(){var r,a,f,c;try{a=this,r=o(arguments),f="function"==typeof t?t(r,a):t||{}}catch(u){d([u,"",[r,a,i],f])}s(e+"start",[r,a,i],f);try{return c=n.apply(a,r)}catch(p){throw s(e+"err",[r,a,p],f),p}finally{s(e+"end",[r,a,c],f)}}return r(n)?n:(e||(e=""),nrWrapper[a]=n,p(n,nrWrapper),nrWrapper)}function u(n,e,i,o){i||(i="");var a,f,c,u="-"===i.charAt(0);for(c=0;c<e.length;c++)f=e[c],a=n[f],r(a)||(n[f]=t(a,u?f+i:i,o,f))}function s(t,r,i){if(!c||e){var o=c;c=!0;try{n.emit(t,r,i,e)}catch(a){d([a,t,r,i])}c=o}}function p(n,e){if(Object.defineProperty&&Object.keys)try{var t=Object.keys(n);return t.forEach(function(t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){return n[t]=e,e}})}),e}catch(r){d([r])}for(var i in n)f.call(n,i)&&(e[i]=n[i]);return e}function d(e){try{n.emit("internal-error",e)}catch(t){}}return n||(n=i),t.inPlace=u,t.flag=a,t}},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="./04. Implementing B-Trees - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./04. Implementing B-Trees - Database Internals_files/css" rel="stylesheet" type="text/css"><title>4. Implementing B-Trees - Database Internals</title><link rel="stylesheet" href="./04. Implementing B-Trees - Database Internals_files/output.8054605313ed.css" type="text/css"><link rel="stylesheet" type="text/css" href="./04. Implementing B-Trees - Database Internals_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./04. Implementing B-Trees - Database Internals_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}#sbo-rt-content p[data-type="footnote"] sup{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important}#sbo-rt-content p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}#sbo-rt-content p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}#sbo-rt-content a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content table.border tbody>tr:last-child>td{border-bottom:transparent}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .width-10{width:10vw !important}#sbo-rt-content .width-20{width:20vw !important}#sbo-rt-content .width-30{width:30vw !important}#sbo-rt-content .width-40{width:40vw !important}#sbo-rt-content .width-50{width:50vw !important}#sbo-rt-content .width-60{width:60vw !important}#sbo-rt-content .width-70{width:70vw !important}#sbo-rt-content .width-80{width:80vw !important}#sbo-rt-content .width-90{width:90vw !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100vw !important}#sbo-rt-content .width-10{width:10% !important}#sbo-rt-content .width-20{width:20% !important}#sbo-rt-content .width-30{width:30% !important}#sbo-rt-content .width-40{width:40% !important}#sbo-rt-content .width-50{width:50% !important}#sbo-rt-content .width-60{width:60% !important}#sbo-rt-content .width-70{width:70% !important}#sbo-rt-content .width-75{width:75% !important}#sbo-rt-content .width-80{width:80% !important}#sbo-rt-content .width-90{width:90% !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100% !important}</style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781492040330/chapter/ch14.html",
          "book_id": "9781492040330",
          "chapter_uri": "ch14.html",
          "position": 0,
          "user_uuid": "78724200-da8c-4410-821c-6ec73f6340d0",
          "next_chapter_uri": "/library/view/database-internals/9781492040330/afterword02.html"
        
      },
      title: "Database Internals",
      author_list: "Alex Petrov",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./04. Implementing B-Trees - Database Internals_files/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta name="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta property="og:title" content="14. Consensus"><meta itemprop="isPartOf" content="/library/view/database-internals/9781492040330/"><meta itemprop="name" content="14. Consensus"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781492040330/"><meta property="og:description" itemprop="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O&#39;Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781492040347"><meta property="og:book:author" itemprop="author" content="Alex Petrov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '78724200-da8c-4410-821c-6ec73f6340d0';
      dataLayer.push({userIdentifier: '78724200-da8c-4410-821c-6ec73f6340d0'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '274b3493-4443-4dee-a486-ec0579099f2c';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./04. Implementing B-Trees - Database Internals_files/vendor.b72079115638.js"></script><script defer="" src="./04. Implementing B-Trees - Database Internals_files/reader.25f0dd727df4.js"></script><script src="./04. Implementing B-Trees - Database Internals_files/f(1).txt"></script><script src="./04. Implementing B-Trees - Database Internals_files/f(2).txt"></script><script src="./04. Implementing B-Trees - Database Internals_files/f(3).txt"></script><script async="" src="./04. Implementing B-Trees - Database Internals_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 2147483020;
}
.annotator-filter {
  z-index: 2147483010;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/78724200-da8c-4410-821c-6ec73f6340d0/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=collection&amp;sort=date_added&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Expert Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Practice</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/" class="l2 nav-icn"><span>Katacoda Scenarios</span></a></li><li><a href="https://learning.oreilly.com/interactive/#notebooks" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M10.0440191,12.1582649 C10.177209,12.3351976 10.2476998,12.552011 10.2434767,12.7742985 L10.2434767,13.9482829 L1.96869684,13.9482829 L1.96869684,12.7742985 C1.96418597,12.536863 2.04491894,12.3056731 2.19625329,12.1226596 L2.20142503,12.1226596 C3.18373453,10.9898864 4.60930376,10.339179 6.10867266,10.339179 C7.30793519,10.339179 8.45998426,10.7554703 9.37576632,11.5017585 L14.3434936,11.5017585 L14.3434936,3.65650645 L1.65650645,3.65650645 L1.65650645,11.5017585 L2.06682298,11.5017585 L1.82063306,12.1582649 L1.32825322,12.1582649 C1.14771395,12.1582649 1,12.010551 1,11.8300117 L1,3.32825322 C1,3.14771395 1.14771395,3 1.32825322,3 L14.6717468,3 C14.852286,3 15,3.14771395 15,3.32825322 L15,11.8300117 C15,12.010551 14.852286,12.1582649 14.6717468,12.1582649 L10.0440191,12.1582649 Z M12.5483683,7.16419284 C12.6159362,7.20929881 12.6563112,7.2853432 12.6558247,7.36658194 C12.6553382,7.44782068 12.6140555,7.5233761 12.5459522,7.56766966 L10.4270949,8.91581376 C10.3903366,8.94010203 10.3431312,8.9419685 10.3045699,8.9206583 C10.2660086,8.89934811 10.2424712,8.85838696 10.2434767,8.81434055 L10.2434767,5.91510593 C10.2420711,5.86982855 10.2666257,5.82771857 10.3067229,5.80664182 C10.3468202,5.78556507 10.3954292,5.7892172 10.431927,5.81604875 L12.5483683,7.16419284 Z M6.10608679,9.81089299 C4.9635781,9.81089299 4.03739181,8.8847067 4.03739181,7.74219802 C4.03739181,6.59968933 4.9635781,5.67350304 6.10608679,5.67350304 C7.24859547,5.67350304 8.17478176,6.59968933 8.17478176,7.74219802 C8.17478176,8.8847067 7.24859547,9.81089299 6.10608679,9.81089299 Z"></path></svg><span>Sandboxes</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/kubernetes-sandbox/9781492062820/" class="l2 nav-icn"><span>Kubernetes</span></a></li><li><a href="https://learning.oreilly.com/scenarios/python-sandbox/9781492062844/" class="l2 nav-icn"><span>Python</span></a></li><li><a href="https://learning.oreilly.com/scenarios/tensorflow-sandbox/9781492062851/" class="l2 nav-icn"><span>TensorFlow</span></a></li><li><a href="https://learning.oreilly.com/scenarios/ubuntu-sandbox/9781492062837/" class="l2 nav-icn"><span>Ubuntu</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/r/" class="l2 nav-icn"><span>Recommendations</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Release</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M13.4 9.8a.6.6 0 0 1 .6.6v1.2h-1.2l-.6 2.4H3.8l-.6-2.4H2v-1.2a.6.6 0 0 1 .6-.6h10.8zM8 5.6a1.8 1.8 0 1 1-.001-3.599A1.8 1.8 0 0 1 8 5.6zm3.6 2.35v.95H4.4v-.95c0-.167.066-.33.19-.443A5.08 5.08 0 0 1 8 6.2a5.08 5.08 0 0 1 3.41 1.307c.124.113.19.276.19.444z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Training</span></a></li><li><a href="https://www.oreilly.com/conferences/?discount=learn" class="l2 nav-icn" target="&quot;_blank&quot;"><span>Conferences</span></a></li></ul></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Database Internals
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781492040330/chapter/ch14.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./04. Implementing B-Trees - Database Internals_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><img class="is-fetching-gif" src="./04. Implementing B-Trees - Database Internals_files/ajax-transp.gif" alt="presentation"><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html&amp;text=Database%20Internals&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2014.%20Consensus&amp;body=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html%0D%0Afrom%20Database%20Internals%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. File Formats</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">5. Transaction Processing and Recovery</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Implementing B-Trees"><div class="chapter" id="idm46104533315032">
<h1><span class="label">Chapter 4. </span>Implementing B-Trees</h1>


<p>In the previous chapter, we talked about general principles of binary format composition, and learned how to create cells, build hierarchies, and connect them to pages using pointers. These concepts are applicable for both in-place update and append-only storage structures. In this chapter, we discuss some concepts specific to B-Trees.</p>

<p>The sections in this chapter are split into three logical groups. First, we discuss organization: how to establish relationships between keys and pointers, and how to implement headers and links between pages.</p>

<p>Next, we discuss processes that occur during root-to-leaf descends, namely how to perform binary search and how to collect breadcrumbs and keep track of parent nodes in case we later have to split or merge nodes.</p>

<p>Lastly, we discuss optimization techniques (rebalancing, right-only appends, and bulk loading), maintenance processes, and garbage collection.</p>






<section data-type="sect1" data-pdf-bookmark="Page Header"><div class="sect1" id="page_header">
<h1>Page Header</h1>

<p>The<a data-type="indexterm" data-primary="page headers" data-secondary="contents of" id="idm46104533016264"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="page headers" id="BTIphead04"></a> page header holds information about the page that can be used for navigation, maintenance, and optimizations. It usually contains flags that describe page contents and layout, number of cells in the page, lower and upper offsets marking the empty space (used to append cell offsets and data), and other useful metadata.</p>

<p>For<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="page header content" id="idm46104533014728"></a><a data-type="indexterm" data-primary="MySQL" data-secondary="page header content" id="idm46104533013496"></a><a data-type="indexterm" data-primary="SQLite" data-secondary="page header content" id="idm46104533012616"></a> example, <a href="https://databass.dev/links/12">PostgreSQL</a> stores the page size and layout version in the header. In <a href="https://databass.dev/links/13">MySQL InnoDB</a>, page header holds the number of heap records, level, and some other implementation-specific values. In <a href="https://databass.dev/links/14">SQLite</a>, page header stores the number of cells and a rightmost pointer.</p>








<section data-type="sect2" data-pdf-bookmark="Magic Numbers"><div class="sect2" id="magic_numbers">
<h2>Magic Numbers</h2>

<p>One<a data-type="indexterm" data-primary="page headers" data-secondary="magic numbers" id="idm46104533007096"></a><a data-type="indexterm" data-primary="magic numbers" id="idm46104533006248"></a> of the values often placed in the file or page header is a magic number. Usually, it’s a multibyte block, containing a constant value that can be used to signal that the block represents a page, specify its kind, or identify its version.</p>

<p>Magic numbers are often used for<a data-type="indexterm" data-primary="validation" id="idm46104533001544"></a><a data-type="indexterm" data-primary="sanity checks" id="idm46104533005176"></a> validation and sanity checks <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#GIAMPAOLO98">[GIAMPAOLO98]</a>. It’s very improbable that the byte sequence at a random offset would exactly match the magic number. If it did match, there’s a good chance the offset is correct. For example, to verify that the page is loaded and aligned correctly, during write we can place the magic number <code>50 41 47 45</code> (hex for <code>PAGE</code>) into the header. During the read, we validate the page by comparing the four bytes from the read header with the expected byte sequence.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sibling Links"><div class="sect2" id="sibling_links">
<h2>Sibling Links</h2>

<p>Some<a data-type="indexterm" data-primary="page headers" data-secondary="sibling links" id="idm46104533002776"></a><a data-type="indexterm" data-primary="sibling links" id="idm46104532999352"></a><a data-type="indexterm" data-primary="forward links" id="idm46104532998744"></a><a data-type="indexterm" data-primary="backward links" id="idm46104532996520"></a> implementations store forward and backward links, pointing to the left and right sibling pages. These links help to locate neighboring nodes without having to ascend back to the parent. This approach adds some complexity to split and merge operations, as the sibling offsets have to be updated as well. For example, when a non-rightmost node is split, its right sibling’s backward pointer (previously pointing to the node that was split) has to be re-bound to point to the newly created node.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#sibling_links_1">Figure&nbsp;4-1</a> you can see that to locate a sibling node, unless the siblings are linked, we have to refer to the parent node. This operation might ascend all the way up to the root, since the direct parent can only help to address <em>its</em> own children. If we store sibling links directly in the header, we can simply follow them to locate the previous or next node on the same level.</p>

<figure><div id="sibling_links_1" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0401.png" alt="dbin 0401" width="3663" height="1212" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0401.png">
<h6><span class="label">Figure 4-1. </span>Locating a sibling by following parent links (a) versus sibling links (b)</h6>
</div></figure>

<p class="pagebreak-before">One of the downsides of storing sibling links is that they have to be updated during splits and merges. Since updates have to happen in a sibling node, not in a splitting/merging node, it may require additional locking. We discuss how sibling links can be useful in a concurrent B-Tree implementation in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#b_link_trees">“Blink-Trees”</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Rightmost Pointers"><div class="sect2" id="idm46104532986008">
<h2>Rightmost Pointers</h2>

<p>B-Tree separator keys<a data-type="indexterm" data-primary="separator keys" id="idm46104532995048"></a><a data-type="indexterm" data-primary="rightmost pointers" id="idm46104532994440"></a><a data-type="indexterm" data-primary="page headers" data-secondary="rightmost pointers" id="idm46104532993832"></a> have strict invariants: they’re used to split the tree into subtrees and navigate them, so there is always one more pointer to child pages than there are keys. That’s where the <code> +1</code> mentioned in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html#counting_keys">“Counting Keys”</a> is coming from.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html#separator_keys">“Separator Keys”</a>, we described separator key invariants. In many implementations, nodes look more like the ones displayed in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#rightmost_pointer">Figure&nbsp;4-2</a>: each separator key has a child pointer, while the last pointer is stored separately, since it’s not paired with any key. You can compare this to <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html#tree_subrange">Figure&nbsp;2-10</a>.</p>

<figure><div id="rightmost_pointer" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0402.png" alt="dbin 0402" width="1440" height="465" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0402.png">
<h6><span class="label">Figure 4-2. </span>Rightmost pointer</h6>
</div></figure>

<p>This<a data-type="indexterm" data-primary="SQLite" data-secondary="rightmost pointers" id="idm46104532977880"></a> extra pointer can be stored in the header as, for example, it is implemented in <a href="https://databass.dev/links/16">SQLite</a>.</p>

<p>If the rightmost child is split and the new cell is appended to its parent, the rightmost child pointer has to be reassigned. As shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#rightmost_pointer_2">Figure&nbsp;4-3</a>, after the split, the cell appended to the parent (shown in gray) holds the promoted key and points to the split node. The pointer to the new node is assigned instead of the previous rightmost pointer. A similar approach is described and implemented in SQLite.<sup><a data-type="noteref" id="idm46104532975112-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532975112" class="totri-footnote">1</a></sup></p>

<figure><div id="rightmost_pointer_2" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0403.png" alt="dbin 0403" width="3300" height="849" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0403.png">
<h6><span class="label">Figure 4-3. </span>Rightmost pointer update during node split. The promoted key is shown in gray.</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Node High Keys"><div class="sect2" id="node_high_keys">
<h2>Node High Keys</h2>

<p>We<a data-type="indexterm" data-primary="page headers" data-secondary="node high keys" id="idm46104532968920"></a><a data-type="indexterm" data-primary="node high keys" id="idm46104532967720"></a><a data-type="indexterm" data-primary="high keys" id="idm46104532967112"></a> can take a slightly different approach and store the rightmost pointer in the cell along with the node <em>high key</em>. The high key represents the highest possible key that can be present in the subtree under the current node. This approach is used by<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="Blink-Trees" id="idm46104532966088"></a> PostgreSQL and is called<a data-type="indexterm" data-primary="Blink-Trees" id="idm46104532965240"></a> B<sup>link</sup>-Trees (for concurrency implications of this approach, see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#b_link_trees">“Blink-Trees”</a>).</p>

<p>B-Trees have <code>N</code> keys (denoted with <code>K<sub>i</sub></code>) and <code>N + 1</code> pointers (denoted with <code>P<sub>i</sub></code>). In each subtree, keys are bounded by <code>K<sub>i-1</sub> ≤ K<sub>s</sub> &lt; K<sub>i</sub></code>. The <code>K<sub>0</sub> = -∞</code> is implicit and is not present in the node.</p>

<p>B<sup>link</sup>-Trees add a <code>K<sub>N+1</sub></code> key to each node. It specifies an upper bound of keys that can be stored in the subtree to which the pointer <code>P<sub>N</sub></code> points, and therefore is an upper bound of values that can be stored in the current subtree. Both approaches are shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#rightmost_pointer_4">Figure&nbsp;4-4</a>: (a) shows a node <em>without</em> a high key, and (b) shows a node with a high key.</p>

<figure><div id="rightmost_pointer_4" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0404.png" alt="dbin 0404" width="1440" height="212" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0404.png">
<h6><span class="label">Figure 4-4. </span>B-Trees without (a) and with (b) a high key</h6>
</div></figure>

<p>In this case, pointers can be stored pairwise, and each cell can have a corresponding pointer, which might simplify rightmost pointer handling as there are not as many edge cases to consider.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#rightmost_pointer_3">Figure&nbsp;4-5</a>, you can see schematic page structure for both approaches and how the search space is split differently for these cases: going up to <code> +∞</code> in the first case, and up to the upper bound of <code>K<sub>3</sub></code> in the second.</p>

<figure><div id="rightmost_pointer_3" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0405.png" alt="dbin 0405" width="1440" height="428" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0405.png">
<h6><span class="label">Figure 4-5. </span>Using +∞ as a virtual key (a) versus storing the high key (b)</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Overflow Pages"><div class="sect2" id="overflow_pages">
<h2>Overflow Pages</h2>

<p>Node size<a data-type="indexterm" data-primary="page headers" data-secondary="overflow pages" id="idm46104532942888"></a><a data-type="indexterm" data-primary="overflow pages" id="idm46104532942040"></a> and tree fanout values are fixed and do not change dynamically. It would also be difficult to come up with a value that would be universally optimal: if variable-size values are present in the tree and they are large enough, only a few of them can fit into the page. If the values are tiny, we end up wasting the reserved space.</p>

<p>The B-Tree algorithm specifies that every node keeps a specific number of items. Since some values have different sizes, we may end up in a situation where, according to the B-Tree algorithm, the node is not <em>full</em> yet, but there’s <em>no more free space</em> on the fixed-size <em>page</em> that holds this node. Resizing the page requires copying already written data to the new region and is often impractical. However, we still need to find a way to increase or extend the page size.</p>

<p>To implement variable-size nodes without copying data to the new contiguous region, we can build nodes from multiple linked pages. For example, the default page size is 4 K, and after inserting a few values, its data size has grown over 4 K. Instead of allowing arbitrary sizes, nodes are allowed to grow in 4 K increments, so we allocate a 4 K extension page and link it from the original one. These linked page extensions are called <em>overflow pages</em>. For clarity, we call the<a data-type="indexterm" data-primary="primary pages" id="idm46104532936184"></a> original page the <em>primary page</em> in the scope of this section.</p>

<p>Most B-Tree implementations allow storing only up to a fixed number of payload bytes in the B-Tree node directly and <em>spilling</em> the rest to the overflow page. This value is calculated by dividing the node size by fanout. Using this approach, we cannot end up in a situation where the page has no free space, as it will always have at least <code>max_payload_size</code> bytes. For<a data-type="indexterm" data-primary="SQLite" data-secondary="overflow pages" id="idm46104532938968"></a><a data-type="indexterm" data-primary="MySQL" data-secondary="overflow pages" id="idm46104532930744"></a> more information on overflow pages in SQLite, see the <a href="https://databass.dev/links/16">SQLite source code repository</a>; also check out the <a href="https://databass.dev/links/17">MySQL InnoDB documentation</a>.</p>

<p class="pagebreak-before">When the inserted payload is larger than <code>max_payload_size</code>, the node is checked for whether or not it already has any associated overflow pages. If an overflow page already exists and has enough space available, extra bytes from the payload are spilled there. Otherwise, a new overflow page is allocated.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#overflow_pages_1">Figure&nbsp;4-6</a>, you can see a primary page and an overflow page with records pointing from the primary page to the overflow one, where their payload continues.</p>

<figure class="width-50"><div id="overflow_pages_1" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0406.png" alt="dbin 0406" width="802" height="918" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0406.png">
<h6><span class="label">Figure 4-6. </span>Overflow pages</h6>
</div></figure>

<p>Overflow pages require some extra bookkeeping, since they may get fragmented as well as primary pages, and we have to be able to reclaim this space to write new data, or discard the overflow page if it’s not needed anymore.</p>

<p>When the first overflow page is allocated, its page ID is stored in the header of the primary page. If a single overflow page is not enough, multiple overflow pages are linked together by storing the next overflow page ID in the previous one’s header. Several pages may have to be traversed to locate the overflow part for the given <span class="keep-together">payload.</span></p>

<p>Since keys usually have high cardinality, storing a portion of a key makes sense, as most of the comparisons can be made on the trimmed key part that resides in the primary page.</p>

<p class="pagebreak-before">For data records, we have to locate their overflow parts to return them to the user. However, this doesn’t matter much, since it’s an infrequent operation. If all data records are oversize, it is worth considering specialized blob storage for large values.<a data-type="indexterm" data-primary="" data-startref="BTIphead04" id="idm46104532922728"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Binary Search"><div class="sect1" id="idm46104533020936">
<h1>Binary Search</h1>

<p>We’ve<a data-type="indexterm" data-primary="binary search algorithm" id="idm46104532918424"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="binary search" id="BTIbsearch04"></a> already discussed the B-Tree lookup algorithm (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html#b_tree_lookup_algorithm">“B-Tree Lookup Algorithm”</a>) and mentioned that we locate a searched key within the node using the <em>binary search</em> algorithm. Binary search works <em>only</em> for sorted data. If keys are not ordered, they can’t be binary searched. This is why keeping keys in order and maintaining a sorted invariant is essential.</p>

<p>The binary search algorithm receives an array of sorted items and a searched key, and returns a number. If the returned number is positive, we know that the searched key was found and the number specifies its position in the input array. A negative return value indicates that the searched key is not present in the input array<a data-type="indexterm" data-primary="insertion points" id="idm46104532924024"></a> and gives us an <em>insertion point</em>.</p>

<p>The insertion point is the index of the first element that is <em>greater than</em> the given key. An absolute value of this number is the index at which the searched key can be inserted to preserve order. Insertion can be done by shifting elements over one position, starting from an insertion point, to make space for the inserted element <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#SEDGEWICK11">[SEDGEWICK11]</a>.</p>

<p>The majority of searches on higher levels do not result in exact matches, and we’re interested in the search direction, in which case we have to find the first value that is greater than the searched one and follow the corresponding child link into the associated subtree.</p>








<section data-type="sect2" data-pdf-bookmark="Binary Search with Indirection Pointers"><div class="sect2" id="idm46104532910552">
<h2>Binary Search with Indirection Pointers</h2>

<p>Cells<a data-type="indexterm" data-primary="indirection pointers" id="idm46104532908632"></a> in the B-Tree page are stored in the insertion order, and only cell offsets preserve the logical element order. To perform binary search through page cells, we pick the middle cell offset, follow its pointer to locate the cell, compare the key from this cell with the searched key to decide whether the search should continue left or right, and continue this process recursively until the searched element or the insertion point is found, as shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#binary_search">Figure&nbsp;4-7</a>.<a data-type="indexterm" data-primary="" data-startref="BTIbsearch04" id="idm46104532911752"></a></p>

<figure><div id="binary_search" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0407.png" alt="dbin 0407" width="1440" height="621" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0407.png">
<h6><span class="label">Figure 4-7. </span>Binary search with indirection pointers. The searched element is shown in gray. Dotted arrows represent binary search through cell pointers. Solid lines represent accesses that follow the cell pointers, necessary to compare the cell value with a searched key.</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Propagating Splits and Merges"><div class="sect1" id="idm46104532904808">
<h1>Propagating Splits and Merges</h1>

<p>As<a data-type="indexterm" data-primary="splits" id="idm46104532903496"></a><a data-type="indexterm" data-primary="node splits" id="idm46104532902888"></a><a data-type="indexterm" data-primary="node merges" id="idm46104532902280"></a><a data-type="indexterm" data-primary="merges" id="idm46104532901512"></a> we’ve discussed in previous chapters, B-Tree splits and merges can propagate to higher levels. For that, we need to be able to traverse a chain back to the root node from the splitting leaf or a pair of merging leaves.</p>

<p>B-Tree nodes may include parent node pointers. Since pages from lower levels are always paged in when they’re referenced from a higher level, it is not even necessary to persist this information on disk.</p>

<p>Just like sibling pointers (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#sibling_links">“Sibling Links”</a>), parent pointers have to be updated whenever the parent changes. This happens in all the cases when the separator key with the page identifier is transferred from one node to another: during the parent node splits, merges, or rebalancing of the parent node.</p>

<p>Some implementations (for example, <a href="https://databass.dev/links/20">WiredTiger</a>) use parent pointers for leaf traversal to avoid deadlocks, which may happen when using sibling pointers (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MILLER78">[MILLER78]</a>, <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LEHMAN81">[LEHMAN81]</a>). Instead of using sibling pointers to traverse leaf nodes, the algorithm employs parent pointers, much like we saw in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#sibling_links_1">Figure&nbsp;4-1</a>.</p>

<p>To address and locate a sibling, we can follow a pointer from the parent node and recursively descend back to the lower level. Whenever we reach the end of the parent node after traversing all the siblings sharing the parent, the search continues upward recursively, eventually reaching up to the root and continuing back down to the leaf level.</p>








<section data-type="sect2" data-pdf-bookmark="Breadcrumbs"><div class="sect2" id="breadcrumbs">
<h2>Breadcrumbs</h2>

<p>Instead<a data-type="indexterm" data-primary="breadcrumbs" id="idm46104532890664"></a> of storing and maintaining parent node pointers, it is possible to keep track of nodes traversed on the path to the target leaf node, and follow the chain of parent nodes in reverse order in case of cascading splits during inserts, or merges during deletes.</p>

<p>During operations that may result in structural changes of the B-Tree (insert or delete), we first traverse the tree from the root to the leaf to find the target node and the insertion point. Since we do not always know up front whether or not the operation will result in a split or merge (at least not until the target leaf node is located), we have to collect <em>breadcrumbs</em>.</p>

<p>Breadcrumbs contain references to the nodes followed from the root and are used to backtrack them in reverse when propagating splits or merges. The most natural data structure for this is a stack. For example, PostgreSQL stores breadcrumbs in a stack, internally referenced as BTStack.<sup><a data-type="noteref" id="idm46104532887240-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532887240" class="totri-footnote">2</a></sup></p>

<p>If the node is split or merged, breadcrumbs can be used to find insertion points for the keys pulled to the parent and to walk back up the tree to propagate structural changes to the higher-level nodes, if necessary. This stack is maintained in memory.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#btree_breadcrumbs">Figure&nbsp;4-8</a> shows an example of root-to-leaf traversal, collecting breadcrumbs containing pointers to the visited nodes and cell indices. If the target leaf node is split, the item on top of the stack is popped to locate its immediate parent. If the parent node has enough space, a new cell is appended to it at the cell index from the breadcrumb (assuming the index is still valid). Otherwise, the parent node is split as well. This process continues recursively until either the stack is empty and we have reached the root, or there was no split on the level.</p>

<figure class="width-75"><div id="btree_breadcrumbs" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0408.png" alt="dbin 0408" width="1440" height="1327" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0408.png">
<h6><span class="label">Figure 4-8. </span>Breadcrumbs collected during lookup, containing traversed nodes and cell indices. Dotted lines represent logical links to visited nodes. Numbers in the breadcrumbs table represent indices of the followed child pointers.</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Rebalancing"><div class="sect1" id="btree_rebalancing">
<h1>Rebalancing</h1>

<p>Some<a data-type="indexterm" data-primary="tree balancing" id="idm46104532879656"></a><a data-type="indexterm" data-primary="rebalancing" id="idm46104532879048"></a><a data-type="indexterm" data-primary="load-balancing" id="idm46104532878408"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="rebalancing" id="idm46104532877224"></a> B-Tree implementations attempt to postpone split and merge operations to amortize their costs by <em>rebalancing</em> elements within the level, or moving elements from more occupied nodes to less occupied ones for as long as possible before finally performing a split or merge. This helps to improve node occupancy and may reduce the number of levels within the tree at a potentially higher maintenance cost of <span class="keep-together">rebalancing.</span></p>

<p>Load balancing can be performed during insert and delete operations <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#GRAEFE11">[GRAEFE11]</a>. To improve space utilization, instead of splitting the node on overflow, we can transfer some of the elements to one of the sibling nodes and make space for the insertion. Similarly, during delete, instead of merging the sibling nodes, we may choose to move some of the elements from the neighboring nodes to ensure the node is at least half full.</p>

<p>B*-Trees keep distributing data between the neighboring nodes until both siblings are full <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#KNUTH98">[KNUTH98]</a>. Then, instead of splitting a single node into two half-empty ones, the algorithm splits two nodes into three nodes, each of which is two-thirds full. SQLite uses this variant in the <a href="https://databass.dev/links/22">implementation</a>. This approach improves an average occupancy by postponing splits, but requires additional tracking and balancing logic. Higher utilization also means more efficient searches, because the height of the tree is smaller and fewer pages have to be traversed on the path to the searched leaf.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#btree_balancing_1">Figure&nbsp;4-9</a> shows distributing elements between the neighboring nodes, where the left sibling contains more elements than the right one. Elements from the more occupied node are moved to the less occupied one. Since balancing changes the min/max invariant of the sibling nodes, we have to update keys and pointers at the parent node to preserve it.</p>

<figure><div id="btree_balancing_1" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0409.png" alt="dbin 0409" width="2952" height="1131" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0409.png">
<h6><span class="label">Figure 4-9. </span>B-Tree balancing: Distributing elements between the more occupied node and the less occupied one</h6>
</div></figure>

<p>Load balancing is a useful technique used in many database implementations. For example, SQLite implements the <a href="https://databass.dev/links/23"><em>balance-siblings</em> algorithm</a>, which is somewhat close to what we have described in this section. Balancing might add some complexity to the code, but since its use cases are isolated, it can be implemented as an optimization at a later stage.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Right-Only Appends"><div class="sect1" id="immutable_b_tree">
<h1>Right-Only Appends</h1>

<p>Many<a data-type="indexterm" data-primary="right-only appends" id="idm46104532863000"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="right-only appends" id="BTIrightonly04"></a> database systems use auto-incremented monotonically increasing values as primary index keys. This case opens up an opportunity for an optimization, since all the insertions are happening toward the end of the index (in the rightmost leaf), so most of the splits occur on the rightmost node on each level. Moreover, since the keys are monotonically incremented, given that the ratio of appends versus updates and deletes is low, nonleaf pages are also less fragmented than in the case of randomly ordered keys.</p>

<p>PostgreSQL<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="right-only appends (fastpath)" id="idm46104532860056"></a><a data-type="indexterm" data-primary="fastpath" id="idm46104532859208"></a> is calling this case a <a href="https://databass.dev/links/24"><em>fastpath</em></a>. When the inserted key is strictly greater than the first key in the rightmost page, and the rightmost page has enough space to hold the newly inserted entry, the new entry is inserted into the appropriate location in the cached rightmost leaf, and the whole read path can be skipped.</p>

<p>SQLite<a data-type="indexterm" data-primary="quickbalance" id="idm46104532857544"></a><a data-type="indexterm" data-primary="SQLite" data-secondary="quickbalance" id="idm46104532856936"></a> has a similar concept and calls it <a href="https://databass.dev/links/25"><em>quickbalance</em></a>. When the entry is inserted on the far right end and the target node is full (i.e., it becomes the largest entry in the tree upon insertion), instead of rebalancing or splitting the node, it allocates the new rightmost node and adds its pointer to the parent (for more on implementing balancing in SQLite, see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#btree_rebalancing">“Rebalancing”</a>). Even though this leaves the newly created page nearly empty (instead of half empty in the case of a node split), it is very likely that the node will get filled up shortly.</p>








<section data-type="sect2" data-pdf-bookmark="Bulk Loading"><div class="sect2" id="idm46104532849240">
<h2>Bulk Loading</h2>

<p>If<a data-type="indexterm" data-primary="bulk-loading" id="idm46104532850520"></a><a data-type="indexterm" data-primary="data" data-secondary="bulk-loading" id="idm46104532850024"></a> we have presorted data and want to bulk load it, or have to rebuild the tree (for example, for defragmentation), we can take the idea with right-only appends even further. Since the data required for tree creation is already sorted, during bulk loading we only need to append the items at the rightmost location in the tree.</p>

<p>In this case, we can avoid splits and merges altogether and compose the tree from the bottom up, writing it out level by level, or writing out higher-level nodes as soon as we have enough pointers to already written lower-level nodes.</p>

<p>One approach for implementing bulk loading is to write presorted data on the leaf level page-wise (rather then inserting individual elements). After the leaf page is written, we propagate its first key to the parent and use a normal algorithm for building higher B-Tree levels <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAMAKRISHNAN03">[RAMAKRISHNAN03]</a>. Since appended keys are given in the sorted order, all splits in this case occur on the rightmost node.</p>

<p>Since B-Trees are always built starting from the bottom (leaf) level, the complete leaf level can be written out before any higher-level nodes are composed. This allows having all child pointers at hand by the time the higher levels are constructed. The main benefits of this approach are that we do not have to perform any splits or merges on disk and, at the same time, have to keep only a minimal part of the tree (i.e., all parents of the currently filling leaf node) in memory for the time of construction.</p>

<p>Immutable B-Trees can be created in the same manner but, unlike mutable B-Trees, they require no space overhead for subsequent modifications, since all operations on a tree are final. All pages can be completely filled up, improving occupancy and resulting into better performance.<a data-type="indexterm" data-primary="" data-startref="BTIrightonly04" id="idm46104532844888"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Compression"><div class="sect1" id="b_tree_compression">
<h1>Compression</h1>

<p>Storing<a data-type="indexterm" data-primary="data" data-secondary="compressing" id="idm46104532845720"></a><a data-type="indexterm" data-primary="compression" id="idm46104532841720"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="compression" id="BTIcompress04"></a> the raw, uncompressed data can induce significant overhead, and many databases offer ways to compress it to save space. The apparent trade-off here is between access speed and compression ratio: larger compression ratios can improve data size, allowing you to fetch more data in a single access, but might require more RAM and CPU cycles to compress and decompress it.</p>

<p>Compression can be done at different granularity levels. Even though compressing entire files can yield better compression ratios, it has limited application as a whole file has to be recompressed on an update, and more granular compression is usually better-suited for larger datasets. Compressing an entire index file is both impractical and hard to implement efficiently: to address a particular page, the whole file (or its section containing compression metadata) has to be accessed (in order to locate a compressed section), decompressed, and made available.</p>

<p>An alternative is to compress data page-wise. It fits our discussion well, since the algorithms we’ve been discussing so far use fixed-size pages. Pages can be compressed and uncompressed independently from one another, allowing you to couple compression with page loading and flushing. However, a compressed page in this case can occupy only a fraction of a disk block and, since transfers are usually done in units of disk blocks, it might be necessary to page in extra bytes <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAY95">[RAY95]</a>. In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#compression_1">Figure&nbsp;4-10</a>, you can see a compressed page (a) taking less space than the disk block. When we load this page, we also page in additional bytes that belong to the other page. With pages that span multiple disk blocks, like (b) in the same image, we have to read an additional block.</p>

<figure><div id="compression_1" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0410.png" alt="dbin 0410" width="1440" height="525" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0410.png">
<h6><span class="label">Figure 4-10. </span>Compression and block padding</h6>
</div></figure>

<p>Another<a data-type="indexterm" data-primary="block padding" id="idm46104532833368"></a> approach is to compress data only, either row-wise (compressing entire data records) or column-wise (compressing columns individually). In this case, page management and compression are decoupled.</p>

<p>Most of the open source databases reviewed while writing this book have pluggable compression methods, using available libraries such as <a href="https://databass.dev/links/26">Snappy</a>, <a href="https://databass.dev/links/27">zLib</a>, <a href="https://databass.dev/links/28">lz4</a>, and many others.</p>

<p>As compression algorithms yield different results depending on a dataset and potential objectives (e.g., compression ratio, performance, or memory overhead), we will not go into comparison and implementation details in this book. There are many overviews available that evaluate different compression algorithms for different block sizes (for example, <a href="https://databass.dev/links/29">Squash Compression Benchmark</a>), usually focusing on four metrics: memory overhead, compression performance, decompression performance, and compression ratio. These metrics are important to consider when picking a compression library.<a data-type="indexterm" data-primary="" data-startref="BTIcompress04" id="idm46104532837976"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Vacuum and Maintenance"><div class="sect1" id="vacuum_and_maintenance">
<h1>Vacuum and Maintenance</h1>

<p>So<a data-type="indexterm" data-primary="garbage collection" id="idm46104532825928"></a><a data-type="indexterm" data-primary="B-Trees, implementing" data-secondary="vacuum and maintenance" id="BTIvacuum04"></a> far we’ve been mostly talking about user-facing operations in B-Trees. However, there are other processes that happen in parallel with queries that maintain storage integrity, reclaim space, reduce overhead, and keep pages in order. Performing these operations in the background allows us to save some time and avoid paying the price of cleanup during inserts, updates, and deletes.</p>

<p>The described design of<a data-type="indexterm" data-primary="slotted pages" id="idm46104532821624"></a> slotted pages (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html#slotted_pages">“Slotted Pages”</a>) requires maintenance to be performed on pages to keep them in good shape. For example, subsequent splits and merges in internal nodes or inserts, updates, and deletes on the leaf level can result in a page that has<a data-type="indexterm" data-primary="logical space" id="idm46104532816888"></a> enough <em>logical</em> space but does not have enough <em>contiguous</em> space, since it is fragmented. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#vacuum_1">Figure&nbsp;4-11</a> shows an example of such a situation: the page still has some logical space available, but it’s fragmented and is split between the two deleted (garbage) records and some remaining free space between the header/cell pointers and cells.</p>

<figure><div id="vacuum_1" class="figure">
<img src="./04. Implementing B-Trees - Database Internals_files/dbin_0411.png" alt="dbin 0411" width="1923" height="756" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0411.png">
<h6><span class="label">Figure 4-11. </span>An example of a fragmented page</h6>
</div></figure>

<p>B-Trees are navigated from the root level. Data records that can be reached by following pointers down from the root node are <em>live</em> (addressable). Nonaddressable data records are said to be <em>garbage</em>: these records are not referenced anywhere and cannot be read or interpreted, so their contents are as good as nullified.</p>

<p>You can see this distinction in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#vacuum_1">Figure&nbsp;4-11</a>: cells that still have pointers to them are addressable, unlike the removed or overwritten ones. Zero-filling of garbage areas is often skipped for performance reasons, as eventually these areas are overwritten by the new data anyway.</p>








<section data-type="sect2" data-pdf-bookmark="Fragmentation Caused by Updates and Deletes"><div class="sect2" id="idm46104532813784">
<h2>Fragmentation Caused by Updates and Deletes</h2>

<p>Let’s consider<a data-type="indexterm" data-primary="in-place updates" id="idm46104532810024"></a><a data-type="indexterm" data-primary="deletion markers" id="idm46104532809288"></a><a data-type="indexterm" data-primary="fragmentation" id="idm46104532808616"></a> under which circumstances pages get into the state where they have nonaddressable data and have to be compacted. On the leaf level, deletes only remove cell offsets from the header, leaving the cell itself intact. After this is done, the cell is not <em>addressable</em> anymore, its contents will not appear in the query results, and nullifying it or moving neighboring cells is not necessary.</p>

<p>When the page is split, only offsets are trimmed and, since the rest of the page is not addressable, cells whose offsets were truncated are not reachable, so they will be overwritten whenever the new data arrives, or garbage-collected when the vacuum process kicks in.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Some databases rely on garbage collection, and leave removed and updated cells in place for multiversion concurrency control (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#mvcc">“Multiversion Concurrency Control”</a>). Cells remain accessible for the concurrently executing transactions until the update is complete, and can be collected as soon as no other thread accesses them. Some databases maintain structures that<a data-type="indexterm" data-primary="ghost records" id="idm46104532804136"></a> track <em>ghost</em> records, which are collected as soon as all transactions that may have seen them complete <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>.</p>
</div>

<p>Since deletes only discard cell offsets and do not relocate remaining cells or physically remove the target cells to occupy the freed space, freed bytes might end up scattered across the page. In this case, we say that the page is <em>fragmented</em> and requires <span class="keep-together">defragmentation.</span></p>

<p>To make a write, we often need a contiguous block of free bytes where the cell fits. To put the freed fragments back together and fix this situation, we have to <em>rewrite</em> the page.</p>

<p>Insert operations leave tuples in their insertion order. This does not have as significant an impact, but having naturally sorted tuples can help with cache prefetch during sequential reads.</p>

<p>Updates are mostly applicable to the leaf level: internal page keys are used for guided navigation and only define subtree boundaries. Additionally, updates are performed on a per-key basis, and generally do not result in structural changes in the tree, apart from the creation of overflow pages. On the leaf level, however, update operations do not change cell order and attempt to avoid page rewrite. This means that multiple versions of the cell, only one of which is addressable, may end up being stored.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Page Defragmentation"><div class="sect2" id="idm46104532811352">
<h2>Page Defragmentation</h2>

<p>The<a data-type="indexterm" data-primary="defragmentation" id="idm46104532798376"></a><a data-type="indexterm" data-primary="compaction" data-secondary="defined" id="idm46104532797384"></a><a data-type="indexterm" data-primary="vacuum" id="idm46104532793768"></a><a data-type="indexterm" data-primary="maintenance" id="idm46104532793064"></a> process that takes care of space reclamation and page rewrites is called <em>compaction</em>, <em>vacuum</em>, or just <em>maintenance</em>. Page rewrites can be done synchronously on write if the page does not have enough free physical space (to avoid creating unnecessary overflow pages), but compaction is mostly referred to as a distinct, asynchronous process of walking through pages, performing garbage collection, and rewriting their contents.</p>

<p>This process reclaims the space occupied by dead cells, and rewrites cells in their logical order. When pages are rewritten, they may also get relocated to new positions in the file. Unused in-memory pages become available and are returned to the page cache. IDs<a data-type="indexterm" data-primary="free page list" id="idm46104532790936"></a><a data-type="indexterm" data-primary="freelist" id="idm46104532786536"></a> of the newly available on-disk pages are added to the <em>free page list</em> (sometimes called a <em>freelist</em><sup><a data-type="noteref" id="idm46104532785256-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532785256" class="totri-footnote">3</a></sup>). This information has to be persisted to survive node crashes and restarts, and to make sure free space is not lost or leaked.<a data-type="indexterm" data-primary="" data-startref="BTIvacuum04" id="idm46104532784648"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm46104532783848">
<h1>Summary</h1>

<p>In this chapter, we discussed the concepts specific to on-disk B-Tree implementations, such as:</p>
<dl>
<dt>Page header</dt>
<dd>
<p>What information is usually stored there.</p>
</dd>
<dt>Rightmost pointers</dt>
<dd>
<p>These are not paired with separator keys, and how to handle them.</p>
</dd>
<dt>High keys</dt>
<dd>
<p>Determine the maximum allowed key that can be stored in the node.</p>
</dd>
<dt>Overflow pages</dt>
<dd>
<p>Allow you to store oversize and variable-size records using fixed-size pages.</p>
</dd>
</dl>

<p class="pagebreak-before">After that, we went through some details related to root-to-leaf traversals:</p>

<ul>
<li>
<p>How to perform binary search with indirection pointers</p>
</li>
<li>
<p>How to keep track of tree hierarchies using parent pointers or breadcrumbs</p>
</li>
</ul>

<p>Lastly, we went through some optimization and maintenance techniques:</p>
<dl>
<dt>Rebalancing</dt>
<dd>
<p>Moves elements between neighboring nodes to reduce a number of splits and merges.</p>
</dd>
<dt>Right-only appends</dt>
<dd>
<p>Appends the new rightmost cell instead of splitting it under the assumption that it will quickly fill up.</p>
</dd>
<dt>Bulk loading</dt>
<dd>
<p>A technique for efficiently building B-Trees from scratch from sorted data.</p>
</dd>
<dt>Garbage collection</dt>
<dd>
<p>A process that rewrites pages, puts cells in key order, and reclaims space occupied by unaddressable cells.</p>
</dd>
</dl>

<p>These concepts should bridge the gap between the basic B-Tree algorithm and a real-world implementation, and help you better understand how B-Tree–based storage systems work.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104532766696">
<h5>Further Reading</h5>
<p>If you’d like to learn more about the concepts mentioned in this chapter, you can refer to the following sources:</p>
<dl>
<dt>Disk-based B-Trees</dt>
<dd>
<p>Graefe, Goetz. 2011. “Modern B-Tree Techniques.” <em>Foundations and Trends in Databases</em> 3, no. 4 (April): 203-402. <a href="https://doi.org/10.1561/1900000028"><em class="hyperlink">https://doi.org/10.1561/1900000028</em></a>.</p>

<p>Healey, Christopher G. 2016. <em>Disk-Based Algorithms for Big Data (1st Ed.)</em>. Boca Raton: CRC Press.</p>
</dd>
</dl>
</div></aside>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm46104532975112"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532975112-marker" class="totri-footnote">1</a></sup> You can find this algorithm in the <code>balance_deeper</code> function in <a href="https://databass.dev/links/15">the project repository</a>.</p><p data-type="footnote" id="idm46104532887240"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532887240-marker" class="totri-footnote">2</a></sup> You can read more about it in the project repository: <a href="https://databass.dev/links/21"><em class="hyperlink">https://databass.dev/links/21</em></a>.</p><p data-type="footnote" id="idm46104532785256"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#idm46104532785256-marker" class="totri-footnote">3</a></sup> For example, SQLite maintains a <a href="https://databass.dev/links/30">list of pages</a> that are not used by the database, where <em>trunk</em> pages are held in a linked list and hold addresses of freed pages.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-12" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. File Formats</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">5. Transaction Processing and Recovery</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  function decodeHtml(html) {
    var txt = document.createElement("textarea");
    txt.innerHTML = html;
    return txt.value;
  }

  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Database Internals',
      type: 'book',
      identifier: '9781492040330',
      topic: 'Data Warehousing, '
    },
    content: {
      title: 'Database Internals',
      formatType: 'book',
      identifier: '9781492040330',
      author: 'Alex Petrov',
      publisher: decodeHtml('O&#39;Reilly Media, Inc.'),
      releaseDate: '2019-10-08',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          

          
            <p>You have 6 days left in your trial, Iswade. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      
        


<footer class="pagefoot t-pagefoot" style="padding-bottom: 75px;">
  <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" class="icon-up" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2019 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"queueTime":3,"applicationTime":407,"errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","agent":"","licenseKey":"510f1a6865","applicationID":"172641827,79672898,93931619"}</script>

      
    
    <script src="./04. Implementing B-Trees - Database Internals_files/saved_resource" charset="utf-8"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./04. Implementing B-Trees - Database Internals_files/embed.js"></script>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("set","agent","tmgoogletagmanager","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>

<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>
<script type="text/javascript" id="">window._pp=window._pp||[];if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/register/")_pp.targetUrl="/confirm/trial";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/subscribe/")_pp.targetUrl="/confirm/paid";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/signup/")_pp.targetUrl="/confirm/paid";_pp.siteId="2508";
_pp.siteUId="78724200-da8c-4410-821c-6ec73f6340d0";_pp.orderValue="undefined";_pp.orderId="undefined";(function(){var ppjs=document.createElement("script");ppjs.type="text/javascript";ppjs.async=true;ppjs.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.pbbl.co/r/"+_pp.siteId+".js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ppjs,s)})();</script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.8761141995538091"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.039377343765153894" width="0" height="0" alt="" src="./04. Implementing B-Trees - Database Internals_files/0"></div>
    <script src="./04. Implementing B-Trees - Database Internals_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice">Sorry we could not read the annotations from the store</div><div class="font-flyout" style="top: 201.001px; left: 1557.4px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./04. Implementing B-Trees - Database Internals_files/generic1576598380235.js" charset="UTF-8"></script><div style="display: none; visibility: hidden;"><script>(function(){if(null!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')&&void 0!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')){var a=!1;window.addEventListener("blur",function(){a&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"facebook",eventVal:0,nonInteraction:0})});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseover",function(){window.focus();
a=!0});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseout",function(){a=!1})}try{window.twttr=function(b,a,d){var c,e=b.getElementsByTagName(a)[0];if(!b.getElementById(d))return b=b.createElement(a),b.id=d,b.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(b,e),window.twttr||(c={_e:[],ready:function(a){c._e.push(a)}})}(document,"script","twitter-wjs"),twttr.ready(function(a){a.events.bind("tweet",trackTwitter)})}catch(b){}})();
null!==document.querySelector(".IN-widget")&&void 0!==document.querySelector(".IN-widget")&&document.querySelector(".IN-widget").addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"linkedin",eventVal:0,nonInteraction:0})});
function trackTwitter(a){a&&(a.target&&"IFRAME"==a.target.nodeName&&(opt_target=extractParamFromUri(a.target.src,"url")),dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0}))}function extractParamFromUri(a,b){if(a){var c=new RegExp("[\\?\x26#]"+b+"\x3d([^\x26#]*)");c=c.exec(a);if(null!=c)return unescape(c[1])}};</script></div><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./04. Implementing B-Trees - Database Internals_files/widget_iframe.69e02060c7c44baddf1b5629549acc0c.html" title="Twitter settings iframe" style="display: none;"></iframe></body><div class="fika-reader-mode" id="fika-reader" style="display: none;"><div id="fika" class="fika-app theme-vanilla"><!--drawer--><div class="fika-tool"><!--open--><button class="fika-btn fika-btn-icon mr-1" id="fika-tool-btn" data-whats-new="menu"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg></button><!--toc--><button class="fika-btn fika-btn-icon" id="fika-toc-btn"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M4 13c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1zm-3 5c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1z"></path></svg><div class="fika-tooltip">TOC</div></button><button class="fika-btn fika-btn-icon" id="fika-settings" data-whats-new="settings"><svg class="fika-icon" width="20px" height="20px" viewBox="0 0 20 20"><path d="M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"></path></svg><div class="fika-tooltip">Settings</div></button><!--appearance settings--><div class="fika-menu"><div class="fika-menu-nav d-flex flex-column"><div class="fika-menu-nav-item active">Text</div><div class="fika-menu-nav-item">Theme</div><div class="fika-menu-nav-item fika-pro">Autopilot</div><div class="flex-fill"></div><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="fb" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://www.facebook.com/dialog/feed?app_id=393950891439557&amp;display=popup&amp;link=https://chrome.google.com/webstore/detail/fika-reader-mode/fbcdnjeoghampomjjaahjgjghdjdbbcj" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Share to Facebook</a><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="tw" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://twitter.com/intent/retweet?tweet_id=1117715831540965376" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Share to Twitter</a><a class="fika-menu-nav-item small mb-1" href="http://fika.io/updatelog" target="_blank">What's new</a><div class="fika-menu-nav-item static small" style="font-size: 12px;line-height: 16px;" id="fika-beta-info"><div class="fika-pro" style=" margin-left: -4px;"></div>Login and share Fika to gain BETA access.</div><!--<a class="fika-menu-nav-item small" href="http://fika.io/pro" target="_blank">Upgrade to Pro</a>--><div class="fika-menu-login"><div id="fika-login" class="px-2"><div class="mb-1">Log in</div><div>with Google account</div></div><div class="fika-loading" id="fika-loading-login" style="display: none;position: absolute;right: 16px;bottom: 24px;"></div></div></div><div class="fika-menu-view-cont"><!--text--><div class="fika-menu-view" style="display: block"><div class="fika-menu-label">Text</div><div class="fika-tab"><div class="fika-tab-item active" style="font-size:12px" data-sel="size-small">small</div><div class="fika-tab-item" style="font-size:14px" data-sel="size-medium">medium</div><div class="fika-tab-item" style="font-size:16px" data-sel="size-large">large</div></div><div class="fika-menu-label mt-3">Alignment</div><div class="fika-tab"><div class="fika-tab-item active" data-sel="align-normal">normal</div><div class="fika-tab-item" data-sel="align-justify">justify</div></div><div class="fika-menu-label mt-3">Font</div><div class="fika-select fika-select-fonts"><div class="fika-select-item font-arial" data-sel="font-arial">Arial</div><div class="fika-select-item font-courier" data-sel="font-courier">Courier</div><div class="fika-select-item font-georgia" data-sel="font-georgia">Georgia</div><div class="fika-select-item font-merriweather active" data-sel="font-merriweather">Merriweather</div><div class="fika-select-item font-openSans" data-sel="font-openSans">Open Sans</div><div class="fika-select-item font-palatino" data-sel="font-palatino">Palatino</div></div></div><!--theme--><div class="fika-menu-view" data-tab="theme"><div class="fika-menu-label">Theme Color</div><div class="fika-select-themes"><div class="fika-select-theme theme-vanilla active" data-sel="theme-vanilla"></div><div class="fika-select-theme theme-latte" data-sel="theme-latte"></div><div class="fika-select-theme theme-blabar" data-sel="theme-blabar"></div><div class="fika-select-theme theme-licorice" data-sel="theme-licorice"></div></div><div class="fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="mt-3 fika-menu-label fika-pro">Background</div><div class="my-2 d-flex fika-justify-space-between"><div class="fika-menu-label"><span class="fika-menu-label-sec">Photo Rotation</span><div class="fika-menu-label-desc">Rotate photo backgrounds everyday</div></div><input type="checkbox" id="fika-photo-bg" disabled=""><label class="fika-toggle" for="fika-photo-bg"></label></div><div class="d-flex fika-align-center mb-1 mt-2"><div class="fika-photo-grid-tab active" data-tab="photo">PHOTO</div><div class="ml-2 fika-photo-grid-tab" data-tab="color">COLOR</div></div><div class="fika-photo-grid" data-tab="photo"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div></div><div class="fika-photo-grid" data-tab="color" style="display: none;"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div><div class="fika-photo-grid-item" data-type="color" data-index="0" data-id="1"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#C3ACEA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="1" data-id="2"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FFC5CC"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="2" data-id="3"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F6D863"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="3" data-id="4"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FCF3CA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="4" data-id="5"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#B9E4C9"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="5" data-id="6"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#90F3E8"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="6" data-id="7"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#8FCAF2"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="7" data-id="8"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#293990"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="8" data-id="9"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#191D2D"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="9" data-id="10"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#111111"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="10" data-id="11"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F5F5F5"></div></div></div></div></div><!--autopilot--><div class="fika-menu-view fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="fika-menu-label mt-1"><div class="fika-pro">Autopilot</div><div class="fika-menu-label-desc">Automatically open Fika reader mode on whitelisted websites</div></div><div class="fika-menu-label d-flex fika-align-center"><svg width="24" height="24" class="fika-icon" style="opacity: 0.7;min-width:24px;" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><div class="ml-1 fika-menu-label-desc" style="margin-top: 0px;">Tip: whitelist current website</div></div><div class="fika-menu-label mt-3">Whitelist</div><div class="fika-select"><input class="fika-input" disabled="" id="fika-autopilot-input" type="url" placeholder="Add new website URL"><div class="fika-autopilot-whitelist"></div></div></div></div></div><!--print--><!--<button class="fika-btn fika-btn-icon" id="fika-print">--><!--<svg class="fika-icon" viewBox="0 0 24 24">--><!--<path d="M19,8H5c-1.7,0-3,1.3-3,3v6h4v4h12v-4h4v-6C22,9.3,20.7,8,19,8z M16,19H8v-5h8V19z M19,12c-0.5,0-1-0.4-1-1s0.5-1,1-1--><!--s1,0.4,1,1S19.5,12,19,12z M18,3H6v4h12V3z"/>--><!--</svg>--><!--</button>--><!--fullscreen--><button class="fika-btn fika-btn-icon" id="fika-fullscreen"><!--exit--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg><!--fs--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg><div class="fika-tooltip">Fullscreen</div></button><!--autopilot--><button class="fika-btn fika-btn-icon fika-pro-item fika-disabled" id="fika-autopilot-local" data-whats-new="autopilot-local"><!--on  .on--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><!--off--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M18 6l-2.91 6.26 5.25 5.25C21.39 15.93 22 14.04 22 12c0-5.52-4.48-10-10-10-2.04 0-3.93.61-5.51 1.66l5.25 5.25L18 6zM2.81 5.64l.85.85c-1.37 2.07-2 4.68-1.48 7.45.75 3.95 3.92 7.13 7.88 7.88 2.77.52 5.38-.1 7.45-1.48l.85.85c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.22 4.22c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.03 0 1.42zm6.1 6.1l3.35 3.35L6 18l2.91-6.26z"></path></svg><div class="fika-tooltip">Autopilot</div></button></div><div class="fika-drawer"><div class="my-2 d-flex fika-align-center fika-justify-space-between"><div class="fika-select-label" style="margin: 8px">Table of content</div><button class="fika-btn fika-btn-icon ml-1 fika-drawer-close"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><div class="fika-drawer-content"><div class="fika-drawer-content-wrap"><!-- ** toc--><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div></div></div><!--overlay--><div class="fika-overlay"></div><!--paper--><div class="fika-main-body"><div class="fika-toc-static fika-toc-static-active"><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div><div class="fika-paper"><div class="fika-article size-small font-merriweather align-normal"><div class="fika-article-domain"><img src="./04. Implementing B-Trees - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><span>learning.oreilly.com</span></div><div class="fika-article-title" id="237.8510044098481">14. Consensus - Database Internals</div><div class="fika-article-divider"></div><div class="fika-content"><div><h2 id="6615.593398842472">Egalitarian Paxos</h2><p>Using a distinguished proposer as a leader makes a system prone to failures: as soon as the leader fails, the system has to elect a new one before it can proceed with further steps. Another problem is that having a leader can put a disproportionate load on it, impairing system performance.</p><div><h6 id="508.40453387557494">Note</h6><p>One of the ways to avoid putting an entire system load on the leader is <em>partitioning</em>. Many systems split the range of possible values into smaller segments and allow a part of the system to be responsible for a specific range without having to worry about the other parts. This helps with availability (by isolating failures to a single partition and preventing propagation to other parts of the system), performance (since segments serving different values are nonoverlapping), and scalability (since we can scale the system by increasing the number of partitions). It is important to keep in mind that performing an operation against <em>multiple</em> partitions will require an atomic commitment.</p></div><p>Instead of using a leader and proposal numbers for sequencing commands, we can use a leader responsible for the commit of the <em>specific</em> command, and establish the order by looking up and setting dependencies. This approach is commonly called Egalitarian Paxos, or EPaxos <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU11" target="_blank">[MORARU11]</a>. The idea of allowing nonconflicting writes to be committed to the replicated state machine independently was first introduced in <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT05" target="_blank">[LAMPORT05]</a> and called Generalized Paxos. EPaxos is a first implementation of Generalized Paxos.</p><p>EPaxos attempts to offer benefits of both the classic Paxos algorithm and Multi-Paxos. Classic Paxos offers high availability, since a leader is established during each round, but has a higher message complexity. Multi-Paxos offers high throughput and requires fewer messages, but a leader may become a bottleneck.</p><p>EPaxos starts with a <em>Pre-Accept</em> phase, during which a process becomes a leader for the specific proposal. Every proposal has to include:</p><dl><dt>Dependencies</dt><dd><p>All commands that potentially interfere with a current proposal, but are not necessarily already committed.</p></dd><dt>A sequence number</dt><dd><p>This breaks cycles between the dependencies. Set it with a value larger than any sequence number of the known dependencies.</p></dd></dl><p>After collecting this information, it forwards a <code>Pre-Accept</code> message to a <em>fast quorum</em> of replicas. A fast quorum is <code>⌈3f/4⌉</code> replicas, where <code>f</code> is the number of tolerated <span>failures.</span></p><p>Replicas check their local command logs, update the proposal dependencies based on their view of potentially conflicting proposals, and send this information back to the leader. If the leader receives responses from a fast quorum of replicas, and their dependency lists are in agreement with each other and the leader itself, it can commit the command.</p><p>If the leader does not receive enough responses or if the command lists received from the replicas differ and contain interfering commands, it updates its proposal with a new dependency list and a sequence number. The new dependency list is based on previous replica responses and combines <em>all</em> collected dependencies. The new sequence number has to be larger than the highest sequence number seen by the replicas. After that, the leader sends the new, updated command to <code>⌊f/2⌋ + 1</code> replicas. After this is done, the leader can finally commit the proposal.</p><p>Effectively, we have two possible scenarios:</p><dl><dt>Fast path</dt><dd><p>When dependencies match and the leader can safely proceed with the commit phase with only a <em>fast quorum</em> of replicas.</p></dd><dt>Slow path</dt><dd><p>When there’s a disagreement between the replicas, and their command lists have to be updated before the leader can proceed with a commit.</p></dd></dl><p><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#epaxos_1" target="_blank">Figure&nbsp;14-8</a> shows these scenarios—<code>P<sub>1</sub></code> initiating a fast path run, and <code>P<sub>5</sub></code> initiating a slow path run:</p><ul><li><p><code>P<sub>1</sub></code> starts with proposal number <code>1</code> and no dependencies, and sends a <code>PreAccept(1, ∅)</code> message. Since the command logs of <code>P<sub>2</sub></code> and <code>P<sub>3</sub></code> are empty, <code>P<sub>1</sub></code> can proceed with a commit.</p></li><li><p><code>P<sub>5</sub></code> creates a proposal with sequence number <code>2</code>. Since its command log is empty by that point, it also declares no dependencies and sends a <code>PreAccept(2, ∅)</code> message. <code>P<sub>4</sub></code> is not aware of the committed proposal <code>1</code>, but <code>P<sub>3</sub></code> notifies <code>P<sub>5</sub></code> about the conflict and sends its command log: <code>{1}</code>.</p></li><li><p><code>P<sub>5</sub></code> updates its local dependency list and sends a message to make sure replicas have the same dependencies: <code>Accept(2,{1})</code>. As soon as the replicas respond, it can commit the value.</p></li></ul><figure><div><img src="./04. Implementing B-Trees - Database Internals_files/dbin_1408.png" alt="dbin 1408" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1408.png" style="display: block; margin: 32px auto;"><h6 id="247.8583250215993"><span>Figure 14-8. </span>EPaxos algorithm run</h6></div></figure><p>Two commands, <code>A</code> and <code>B</code>, interfere only if their execution order matters; in other words, if executing <code>A</code> before <code>B</code> and executing <code>B</code> before <code>A</code> produce different results.</p><p>Commit is done by responding to the client and asynchronously notifying replicas with a <code>Commit</code> message. Commands are executed <em>after</em> they’re committed.</p><p>Since dependencies are collected during the Pre-Accept phase, by the time requests are executed, the command order is already established and no command can suddenly appear somewhere in-between: it can only get appended <em>after</em> the command with the largest sequence number.</p><p>To execute a command, replicas build a dependency graph and execute all commands in a reverse dependency order. In other words, before a command can be executed, all its dependencies (and, subsequently, all their dependencies) have to be executed. Since only interfering commands have to depend on each other, this situation should be relatively rare for most workloads <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU13" target="_blank">[MORARU13]</a>.</p><p>Similar to Paxos, EPaxos uses proposal numbers, which prevent stale messages from being propagated. Sequence numbers consist of an <em>epoch</em> (identifier of the current cluster configuration that changes when nodes leave and join the cluster), a monotonically incremented node-local counter, and a replica ID. If a replica receives a proposal with a sequence number lower than one it has already seen, it negatively acknowledges the proposal, and sends the highest sequence number and an updated command list known to it in response.</p></div></div></div><div class="fika-share"><div class="fika-share-divider"></div><div class="fika-share-buttons"><button id="fika-twitter-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg></button><button id="fika-facebook-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg></button></div></div><div class="fika-feedback my-6"><p id="fika-feedback-msg">Is Fika working properly on this site?</p><div class="my-3"><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress fika-feedback-button" data-match="1"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4.41-6.11c-.35-.22-.82-.11-1.03.24-.74 1.17-2 1.87-3.38 1.87s-2.64-.7-3.38-1.88c-.22-.35-.68-.46-1.03-.24-.35.22-.46.68-.24 1.03C8.37 16.54 10.1 17.5 12 17.5s3.63-.97 4.65-2.58c.22-.35.11-.81-.24-1.03z"></path></svg></button><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress ml-2 fika-feedback-button" data-match="0"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-1.9 0-3.63.97-4.65 2.58-.22.35-.11.81.24 1.03.35.22.81.11 1.03-.24.74-1.18 2-1.88 3.38-1.88s2.64.7 3.38 1.88c.14.23.39.35.64.35.14 0 .27-.04.4-.11.35-.22.46-.68.24-1.03C15.63 14.96 13.9 14 12 14z"></path></svg></button></div></div></div><div class="fika-footer"><a class="fika-footer-logo" href="http://fika.io/" target="_blank"><img style="" src="chrome-extension://fbcdnjeoghampomjjaahjgjghdjdbbcj/images/logo64.png">Made with love by Fika</a><div class="d-flex fika-align-center"><b>Alt+R (Option+R)</b>: to open Fika  <b class="ml-2">Esc</b>: to close reader mode</div></div></div><!--message toast--><div class="fika-toast"><span id="fika-toast-msg"></span><a class="ml-5" id="fika-toast-close">close</a></div><!--background photo--><div class="fika-bg"></div><div class="fika-loading" id="fika-loading-bg" style="display: none;position: fixed;right: 24px;bottom: 24px;"></div><a class="fika-bg-credit" target="_blank"></a></div></div></html>