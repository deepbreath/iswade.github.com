<!DOCTYPE html>
<!-- saved from url=(0084)https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/database-internals/9781492040330/ch14.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="6145663" data-user-uuid="78724200-da8c-4410-821c-6ec73f6340d0" data-username="iswade" data-account-type="Trial" data-activated-trial-date="12/14/2019" data-archive="9781492040330" data-publishers="O&#39;Reilly Media, Inc." data-htmlfile-name="ch14.html" data-epub-title="Database Internals" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781492040330"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/cool-2.1.15.min.js"></script><script type="text/javascript" src="./05. Transaction Processing and Recovery - Database Internals_files/510f1a6865"></script><script id="twitter-wjs" src="./05. Transaction Processing and Recovery - Database Internals_files/widgets.js"></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/nr-1153.min.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/ec.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/2508.js"></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/443792972845831" async=""></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/1732687426968531" async=""></script><script async="" src="./05. Transaction Processing and Recovery - Database Internals_files/fbevents.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/analytics.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/bat.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/insight.min.js"></script><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/f.txt"></script><script async="" src="./05. Transaction Processing and Recovery - Database Internals_files/gtm.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={licenseKey:"510f1a6865",applicationID:"172641827"};window.NREUM||(NREUM={}),__nr_require=function(n,e,t){function r(t){if(!e[t]){var i=e[t]={exports:{}};n[t][0].call(i.exports,function(e){var i=n[t][1][e];return r(i||e)},i,i.exports)}return e[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<t.length;i++)r(t[i]);return r}({1:[function(n,e,t){function r(){}function i(n,e,t){return function(){return o(n,[u.now()].concat(f(arguments)),e?null:this,t),e?void 0:this}}var o=n("handle"),a=n(4),f=n(5),c=n("ee").get("tracer"),u=n("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(n,e){s[e]=i(d+e,!0,"api")}),s.addPageAction=i(d+"addPageAction",!0),s.setCurrentRouteName=i(d+"routeName",!0),e.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(n,e){var t={},r=this,i="function"==typeof e;return o(l+"tracer",[u.now(),n,t],r),function(){if(c.emit((i?"":"no-")+"fn-start",[u.now(),r,i],t),i)try{return e.apply(this,arguments)}catch(n){throw c.emit("fn-err",[arguments,this,n],t),n}finally{c.emit("fn-end",[u.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(n,e){m[e]=i(l+e)}),newrelic.noticeError=function(n,e){"string"==typeof n&&(n=new Error(n)),o("err",[n,u.now(),!1,e])}},{}],2:[function(n,e,t){function r(n,e){var t=n.getEntries();t.forEach(function(n){"first-paint"===n.name?a("timing",["fp",Math.floor(n.startTime)]):"first-contentful-paint"===n.name&&a("timing",["fcp",Math.floor(n.startTime)])})}function i(n){if(n instanceof c&&!s){var e,t=Math.round(n.timeStamp);e=t>1e12?Date.now()-t:f.now()-t,s=!0,a("timing",["fi",t,{type:n.type,fid:e}])}}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var o,a=n("handle"),f=n("loader"),c=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){o=new PerformanceObserver(r);try{o.observe({entryTypes:["paint"]})}catch(u){}}if("addEventListener"in document){var s=!1,p=["click","keydown","mousedown","pointerdown","touchstart"];p.forEach(function(n){document.addEventListener(n,i,!1)})}}},{}],3:[function(n,e,t){function r(n,e){if(!i)return!1;if(n!==i)return!1;if(!e)return!0;if(!o)return!1;for(var t=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var f=navigator.userAgent,c=f.match(a);c&&f.indexOf("Chrome")===-1&&f.indexOf("Chromium")===-1&&(i="Safari",o=c[1])}e.exports={agent:i,version:o,match:r}},{}],4:[function(n,e,t){function r(n,e){var t=[],r="",o=0;for(r in n)i.call(n,r)&&(t[o]=e(r,n[r]),o+=1);return t}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],5:[function(n,e,t){function r(n,e,t){e||(e=0),"undefined"==typeof t&&(t=n?n.length:0);for(var r=-1,i=t-e||0,o=Array(i<0?0:i);++r<i;)o[r]=n[e+r];return o}e.exports=r},{}],6:[function(n,e,t){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(n,e,t){function r(){}function i(n){function e(n){return n&&n instanceof r?n:n?c(n,f,o):o()}function t(t,r,i,o){if(!d.aborted||o){n&&n(t,r,i);for(var a=e(i),f=v(t),c=f.length,u=0;u<c;u++)f[u].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(n,e){h[n]=v(n).concat(e)}function m(n,e){var t=h[n];if(t)for(var r=0;r<t.length;r++)t[r]===e&&t.splice(r,1)}function v(n){return h[n]||[]}function g(n){return p[n]=p[n]||i(t)}function w(n,e){u(n,function(n,t){e=e||"feature",y[t]=e,e in s||(s[e]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:e,buffer:w,abort:a,aborted:!1};return b}function o(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var f="nr@context",c=n("gos"),u=n(4),s={},p={},d=e.exports=i();d.backlog=s},{}],gos:[function(n,e,t){function r(n,e,t){if(i.call(n,e))return n[e];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(n,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return n[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(n,e,t){function r(n,e,t,r){i.buffer([n],r),i.emit(n,e,t)}var i=n("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(n,e,t){function r(n){var e=typeof n;return!n||"object"!==e&&"function"!==e?-1:n===window?0:a(n,o,function(){return i++})}var i=1,o="nr@id",a=n("gos");e.exports=r},{}],loader:[function(n,e,t){function r(){if(!x++){var n=E.info=NREUM.info,e=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(n&&n.licenseKey&&n.applicationID&&e))return s.abort();u(y,function(e,t){n[e]||(n[e]=t)}),c("mark",["onload",a()+E.offset],null,"api");var t=l.createElement("script");t.src="https://"+n.agent,e.parentNode.insertBefore(t,e)}}function i(){"complete"===l.readyState&&o()}function o(){c("mark",["domContent",a()+E.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(f=Math.max((new Date).getTime(),f))-E.offset}var f=(new Date).getTime(),c=n("handle"),u=n(4),s=n("ee"),p=n(3),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1153.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),E=e.exports={offset:f,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};n(1),n(2),l[m]?(l[m]("DOMContentLoaded",o,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",i),d[v]("onload",r)),c("mark",["firstbyte",f],null,"api");var x=0,O=n(6)},{}],"wrap-function":[function(n,e,t){function r(n){return!(n&&n instanceof Function&&n.apply&&!n[a])}var i=n("ee"),o=n(5),a="nr@original",f=Object.prototype.hasOwnProperty,c=!1;e.exports=function(n,e){function t(n,e,t,i){function nrWrapper(){var r,a,f,c;try{a=this,r=o(arguments),f="function"==typeof t?t(r,a):t||{}}catch(u){d([u,"",[r,a,i],f])}s(e+"start",[r,a,i],f);try{return c=n.apply(a,r)}catch(p){throw s(e+"err",[r,a,p],f),p}finally{s(e+"end",[r,a,c],f)}}return r(n)?n:(e||(e=""),nrWrapper[a]=n,p(n,nrWrapper),nrWrapper)}function u(n,e,i,o){i||(i="");var a,f,c,u="-"===i.charAt(0);for(c=0;c<e.length;c++)f=e[c],a=n[f],r(a)||(n[f]=t(a,u?f+i:i,o,f))}function s(t,r,i){if(!c||e){var o=c;c=!0;try{n.emit(t,r,i,e)}catch(a){d([a,t,r,i])}c=o}}function p(n,e){if(Object.defineProperty&&Object.keys)try{var t=Object.keys(n);return t.forEach(function(t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){return n[t]=e,e}})}),e}catch(r){d([r])}for(var i in n)f.call(n,i)&&(e[i]=n[i]);return e}function d(e){try{n.emit("internal-error",e)}catch(t){}}return n||(n=i),t.inPlace=u,t.flag=a,t}},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="./05. Transaction Processing and Recovery - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./05. Transaction Processing and Recovery - Database Internals_files/css" rel="stylesheet" type="text/css"><title>5. Transaction Processing and Recovery - Database Internals</title><link rel="stylesheet" href="./05. Transaction Processing and Recovery - Database Internals_files/output.8054605313ed.css" type="text/css"><link rel="stylesheet" type="text/css" href="./05. Transaction Processing and Recovery - Database Internals_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./05. Transaction Processing and Recovery - Database Internals_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}#sbo-rt-content p[data-type="footnote"] sup{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important}#sbo-rt-content p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}#sbo-rt-content p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}#sbo-rt-content a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content table.border tbody>tr:last-child>td{border-bottom:transparent}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .width-10{width:10vw !important}#sbo-rt-content .width-20{width:20vw !important}#sbo-rt-content .width-30{width:30vw !important}#sbo-rt-content .width-40{width:40vw !important}#sbo-rt-content .width-50{width:50vw !important}#sbo-rt-content .width-60{width:60vw !important}#sbo-rt-content .width-70{width:70vw !important}#sbo-rt-content .width-80{width:80vw !important}#sbo-rt-content .width-90{width:90vw !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100vw !important}#sbo-rt-content .width-10{width:10% !important}#sbo-rt-content .width-20{width:20% !important}#sbo-rt-content .width-30{width:30% !important}#sbo-rt-content .width-40{width:40% !important}#sbo-rt-content .width-50{width:50% !important}#sbo-rt-content .width-60{width:60% !important}#sbo-rt-content .width-70{width:70% !important}#sbo-rt-content .width-75{width:75% !important}#sbo-rt-content .width-80{width:80% !important}#sbo-rt-content .width-90{width:90% !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100% !important}</style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781492040330/chapter/ch14.html",
          "book_id": "9781492040330",
          "chapter_uri": "ch14.html",
          "position": 0,
          "user_uuid": "78724200-da8c-4410-821c-6ec73f6340d0",
          "next_chapter_uri": "/library/view/database-internals/9781492040330/afterword02.html"
        
      },
      title: "Database Internals",
      author_list: "Alex Petrov",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta name="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta property="og:title" content="14. Consensus"><meta itemprop="isPartOf" content="/library/view/database-internals/9781492040330/"><meta itemprop="name" content="14. Consensus"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781492040330/"><meta property="og:description" itemprop="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O&#39;Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781492040347"><meta property="og:book:author" itemprop="author" content="Alex Petrov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '78724200-da8c-4410-821c-6ec73f6340d0';
      dataLayer.push({userIdentifier: '78724200-da8c-4410-821c-6ec73f6340d0'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '274b3493-4443-4dee-a486-ec0579099f2c';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./05. Transaction Processing and Recovery - Database Internals_files/vendor.b72079115638.js"></script><script defer="" src="./05. Transaction Processing and Recovery - Database Internals_files/reader.25f0dd727df4.js"></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/f(1).txt"></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/f(2).txt"></script><script src="./05. Transaction Processing and Recovery - Database Internals_files/f(3).txt"></script><script async="" src="./05. Transaction Processing and Recovery - Database Internals_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 2147483020;
}
.annotator-filter {
  z-index: 2147483010;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/78724200-da8c-4410-821c-6ec73f6340d0/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=collection&amp;sort=date_added&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Expert Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Practice</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/" class="l2 nav-icn"><span>Katacoda Scenarios</span></a></li><li><a href="https://learning.oreilly.com/interactive/#notebooks" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M10.0440191,12.1582649 C10.177209,12.3351976 10.2476998,12.552011 10.2434767,12.7742985 L10.2434767,13.9482829 L1.96869684,13.9482829 L1.96869684,12.7742985 C1.96418597,12.536863 2.04491894,12.3056731 2.19625329,12.1226596 L2.20142503,12.1226596 C3.18373453,10.9898864 4.60930376,10.339179 6.10867266,10.339179 C7.30793519,10.339179 8.45998426,10.7554703 9.37576632,11.5017585 L14.3434936,11.5017585 L14.3434936,3.65650645 L1.65650645,3.65650645 L1.65650645,11.5017585 L2.06682298,11.5017585 L1.82063306,12.1582649 L1.32825322,12.1582649 C1.14771395,12.1582649 1,12.010551 1,11.8300117 L1,3.32825322 C1,3.14771395 1.14771395,3 1.32825322,3 L14.6717468,3 C14.852286,3 15,3.14771395 15,3.32825322 L15,11.8300117 C15,12.010551 14.852286,12.1582649 14.6717468,12.1582649 L10.0440191,12.1582649 Z M12.5483683,7.16419284 C12.6159362,7.20929881 12.6563112,7.2853432 12.6558247,7.36658194 C12.6553382,7.44782068 12.6140555,7.5233761 12.5459522,7.56766966 L10.4270949,8.91581376 C10.3903366,8.94010203 10.3431312,8.9419685 10.3045699,8.9206583 C10.2660086,8.89934811 10.2424712,8.85838696 10.2434767,8.81434055 L10.2434767,5.91510593 C10.2420711,5.86982855 10.2666257,5.82771857 10.3067229,5.80664182 C10.3468202,5.78556507 10.3954292,5.7892172 10.431927,5.81604875 L12.5483683,7.16419284 Z M6.10608679,9.81089299 C4.9635781,9.81089299 4.03739181,8.8847067 4.03739181,7.74219802 C4.03739181,6.59968933 4.9635781,5.67350304 6.10608679,5.67350304 C7.24859547,5.67350304 8.17478176,6.59968933 8.17478176,7.74219802 C8.17478176,8.8847067 7.24859547,9.81089299 6.10608679,9.81089299 Z"></path></svg><span>Sandboxes</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/kubernetes-sandbox/9781492062820/" class="l2 nav-icn"><span>Kubernetes</span></a></li><li><a href="https://learning.oreilly.com/scenarios/python-sandbox/9781492062844/" class="l2 nav-icn"><span>Python</span></a></li><li><a href="https://learning.oreilly.com/scenarios/tensorflow-sandbox/9781492062851/" class="l2 nav-icn"><span>TensorFlow</span></a></li><li><a href="https://learning.oreilly.com/scenarios/ubuntu-sandbox/9781492062837/" class="l2 nav-icn"><span>Ubuntu</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/r/" class="l2 nav-icn"><span>Recommendations</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Release</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M13.4 9.8a.6.6 0 0 1 .6.6v1.2h-1.2l-.6 2.4H3.8l-.6-2.4H2v-1.2a.6.6 0 0 1 .6-.6h10.8zM8 5.6a1.8 1.8 0 1 1-.001-3.599A1.8 1.8 0 0 1 8 5.6zm3.6 2.35v.95H4.4v-.95c0-.167.066-.33.19-.443A5.08 5.08 0 0 1 8 6.2a5.08 5.08 0 0 1 3.41 1.307c.124.113.19.276.19.444z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Training</span></a></li><li><a href="https://www.oreilly.com/conferences/?discount=learn" class="l2 nav-icn" target="&quot;_blank&quot;"><span>Conferences</span></a></li></ul></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Database Internals
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781492040330/chapter/ch14.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./05. Transaction Processing and Recovery - Database Internals_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html&amp;text=Database%20Internals&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2014.%20Consensus&amp;body=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html%0D%0Afrom%20Database%20Internals%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">4. Implementing B-Trees</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch06.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">6. B-Tree Variants</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Transaction Processing and Recovery"><div class="chapter" id="transaction_processing">
<h1><span class="label">Chapter 5. </span>Transaction Processing and Recovery</h1>


<p>In this book, we’ve taken a bottom-up approach to database system concepts: we first learned about storage structures. Now, we’re ready to move to the higher-level components responsible for buffer management, lock management, and recovery, which are the prerequisites for understanding database transactions.</p>

<p>A <em>transaction</em> is an<a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="ACID properties" id="idm46104532757672"></a> indivisible logical unit of work in a database management system, allowing you to represent multiple operations as a single step. Operations executed by transactions include reading and writing database records. A database transaction has to preserve atomicity, consistency, isolation, and durability. These<a data-type="indexterm" data-primary="ACID properties" id="idm46104532751704"></a> properties are commonly referred as <em>ACID</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HAERDER83">[HAERDER83]</a>:</p>
<dl>
<dt>Atomicity</dt>
<dd>
<p>Transaction steps<a data-type="indexterm" data-primary="atomicity" id="idm46104532754744"></a><a data-type="indexterm" data-primary="indivisibility" id="idm46104532753752"></a> are <em>indivisible</em>, which means that either <em>all</em> the steps associated with the transaction execute successfully or none of them do. In other words, transactions should not be applied partially. Each transaction can<a data-type="indexterm" data-primary="commit operation" id="idm46104532749208"></a><a data-type="indexterm" data-primary="abort" id="idm46104532748600"></a> either <em>commit</em> (make all changes from write operations executed during the transaction visible), or <em>abort</em> (roll back all transaction side effects that haven’t yet been made visible). Commit is a final operation. After an abort, the transaction can be retried.</p>
</dd>
<dt>Consistency</dt>
<dd>
<p>Consistency<a data-type="indexterm" data-primary="consistency" data-secondary="consistency guarantees" id="idm46104532745256"></a> is an application-specific guarantee; a transaction should only bring the database from one valid state to another valid state, maintaining all database invariants (such as constraints, referential integrity, and others). Consistency is the most weakly defined property, possibly because it is the only property that is controlled by the user and not only by the database itself.</p>
</dd>
<dt>Isolation</dt>
<dd>
<p>Multiple<a data-type="indexterm" data-primary="isolation" id="idm46104532742760"></a> concurrently executing transactions should be able to run without interference, as if there were no other transactions executing at the same time. <span class="keep-together">Isolation</span> defines <em>when</em> the changes to the database state may become visible, and what changes may become visible to the concurrent transactions. Many databases use isolation levels that are weaker than the given definition of isolation for performance reasons. Depending on the methods and approaches used for concurrency control, changes made by a transaction may or may not be visible to other concurrent transactions (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#isolation_levels">“Isolation Levels”</a>).</p>
</dd>
<dt>Durability</dt>
<dd>
<p>Once<a data-type="indexterm" data-primary="durability" id="idm46104532740984"></a> a transaction has been committed, all database state modifications have to be persisted on disk and be able to survive power outages, system failures, and crashes.</p>
</dd>
</dl>

<p>Implementing transactions in a database system, in addition to a storage structure that organizes and persists data on disk, requires several components to work together. On the node locally, the <em>transaction manager</em> coordinates, schedules, and tracks transactions and their individual steps.</p>

<p>The <em>lock manager</em> guards<a data-type="indexterm" data-primary="lock manager" id="idm46104532733592"></a> access to these resources and prevents concurrent accesses that would violate data integrity. Whenever a lock is requested, the lock manager checks if it is already held by any other transaction in shared or exclusive mode, and grants access to it if the requested access level results in no contradiction. Since exclusive locks can be held by at most one transaction at any given moment, other transactions requesting them have to wait until locks are released, or abort and retry later. As soon as the lock is released or whenever the transaction terminates, the lock manager notifies one of the pending transactions, letting it acquire the lock and continue.</p>

<p>The <em>page cache</em> serves as an intermediary between persistent storage (disk) and the rest of the storage engine. It stages state changes in main memory and serves as a cache for the pages that haven’t been synchronized with persistent storage. All changes to a database state are first applied to the cached pages.</p>

<p>The <em>log manager</em> holds<a data-type="indexterm" data-primary="log manager" id="idm46104532726360"></a> a history of operations (log entries) applied to cached pages but not yet synchronized with persistent storage to guarantee they won’t be lost in case of a crash. In other words, the log is used to reapply these operations and reconstruct the cached state during startup. Log entries can also be used to undo changes done by the aborted transactions.</p>

<p>Distributed (multipartition) transactions require additional coordination and remote execution. We discuss distributed transaction protocols in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html#database_transactions">Chapter&nbsp;13</a>.</p>






<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Buffer Management"><div class="sect1" id="buffer_pool">
<h1>Buffer Management</h1>

<p>Most databases<a data-type="indexterm" data-primary="buffer management" data-secondary="overview of" id="idm46104532731240"></a><a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="buffer management" id="TPRbuffer5"></a> are built using a<a data-type="indexterm" data-primary="two-level memory hierarchy" id="idm46104532728600"></a> two-level memory hierarchy: slower persistent storage (disk) and faster main memory (RAM). To<a data-type="indexterm" data-primary="caching" id="cach05"></a> reduce the number of accesses to <span class="keep-together">persistent</span> storage, pages are <em>cached</em> in memory. When the page is requested again by the storage layer, its cached copy is returned.</p>

<p>Cached pages available in memory can be reused under the assumption that no other process has modified the data on disk. This approach is sometimes referenced<a data-type="indexterm" data-primary="virtual disks" id="idm46104532720296"></a> as <em>virtual disk</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BAYER72">[BAYER72]</a>. A virtual disk read accesses physical storage only if no copy of the page is already available in memory. A more common name for the same concept<a data-type="indexterm" data-primary="page caches" id="idm46104532718008"></a><a data-type="indexterm" data-primary="buffer pools" id="idm46104532717368"></a> is <em>page cache</em> or <em>buffer pool</em>. The page cache is responsible for caching pages read from disk in memory. In case of a database system crash or unorderly shutdown, cached contents are lost.</p>

<p>Since the term <em>page cache</em> better reflects the purpose of this structure, this book defaults to this name. The term <em>buffer pool</em> sounds like its primary purpose is to pool and reuse <em>empty</em> buffers, without sharing their contents, which can be a useful part of a page cache or even as a separate component, but does not reflect the entire purpose as precisely.</p>

<p>The problem of caching pages is not limited in scope to databases. Operating systems have the concept of a page cache, too. Operating systems utilize <em>unused</em> memory segments to transparently cache disk contents to improve performance of I/O syscalls.</p>

<p>Uncached pages<a data-type="indexterm" data-primary="paging-in" id="idm46104532713688"></a><a data-type="indexterm" data-primary="dirty pages" id="idm46104532711272"></a><a data-type="indexterm" data-primary="flushing" id="idm46104532710664"></a> are said to be <em>paged in</em> when they’re loaded from disk. If any changes are made to the cached page, it is said to be <em>dirty</em>, until these changes are <em>flushed</em> back on disk.</p>

<p>Since the memory region where cached pages are held is usually substantially smaller than an entire dataset, the page cache eventually fills up and, in order to page in a new page, one of the cached pages<a data-type="indexterm" data-primary="eviction" id="idm46104532707544"></a> has to be <em>evicted</em>.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#buffer_pool_1">Figure&nbsp;5-1</a>, you can see the relation between the logical representation of B-Tree pages, their cached versions, and the pages on disk. The page cache loads pages into free slots out of order, so there’s no direct mapping between how pages are ordered on disk and in memory.</p>

<figure><div id="buffer_pool_1" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0501.png" alt="dbin 0501" width="3000" height="1020" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0501.png">
<h6><span class="label">Figure 5-1. </span>Page cache</h6>
</div></figure>

<p>The primary functions of a page cache can be summarized as:</p>

<ul>
<li>
<p>It keeps cached page contents in memory.</p>
</li>
<li>
<p>It allows modifications to on-disk pages to be <em>buffered</em> together and performed against their cached versions.</p>
</li>
<li>
<p>When a requested page isn’t present in memory and there’s enough space available for it, it is <em>paged in</em> by the page cache, and its cached version is returned.</p>
</li>
<li>
<p>If an already cached page is requested, its cached version is returned.</p>
</li>
<li>
<p>If there’s not enough space available for the new page, some other page is <em>evicted</em> and its contents are <em>flushed</em> to disk.</p>
</li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104532693800">
<h5>Bypassing the Kernel Page Cache</h5>
<p>Many<a data-type="indexterm" data-primary="kernel page cache" id="idm46104532692776"></a><a data-type="indexterm" data-primary="O_DIRECT flag" id="idm46104532692280"></a><a data-type="indexterm" data-primary="buffer management" data-secondary="database-specific" id="idm46104532691672"></a> database systems open files using <a href="https://databass.dev/links/31"><code>O_DIRECT</code> flag</a>. This flag allows I/O system calls to bypass the kernel page cache, access the disk directly, and use database-specific buffer management. This is sometimes frowned upon by the operating systems folks.</p>

<p>Linus Torvalds has <a href="https://databass.dev/links/32">criticized</a> usage of <code>O_DIRECT</code> since it’s not asynchronous and has no readahead or other means for instructing the kernel about access patterns. However, until operating systems start offering better mechanisms, <code>O_DIRECT</code> is still going to be useful.</p>

<p>We<a data-type="indexterm" data-primary="fadvise flag" id="idm46104532684904"></a> can gain some control over how the kernel evicts pages from its cache is by using <a href="https://databass.dev/links/33"><code>fadvise</code></a>, but this only allows us to ask the kernel to consider our opinion and does not guarantee it will actually happen. To avoid syscalls when performing I/O, we can use memory mapping, but then we lose control over caching.</p>
</div></aside>








<section data-type="sect2" data-pdf-bookmark="Caching Semantics"><div class="sect2" id="idm46104532687544">
<h2>Caching Semantics</h2>

<p>All<a data-type="indexterm" data-primary="buffer management" data-secondary="caching semantics" id="idm46104532683112"></a> changes made to buffers are kept in memory until they are eventually written back to disk. As no other process is allowed to make changes to the backing file, this synchronization is a one-way process: from memory to disk, and not vice versa. The page cache allows the database to have more control over memory management and disk accesses. You can think of it as an application-specific equivalent of the kernel page cache: it accesses the block device directly, implements similar functionality, and serves a similar purpose. It abstracts disk accesses and decouples logical write operations from the physical ones.</p>

<p>Caching pages helps to keep the tree partially in memory without making additional changes to the algorithm and materializing objects in memory. All we have to do is replace disk accesses by the calls to the page cache.</p>

<p>When the storage engine accesses (in other words, requests) the page, we first check if its contents are already cached, in which case the cached page contents are returned. If the page contents are not yet cached, the cache translates the logical page address or page number to its physical address, loads its contents in memory, and returns its cached version to the storage engine. Once<a data-type="indexterm" data-primary="referencing" id="idm46104532681688"></a><a data-type="indexterm" data-primary="pinning" id="idm46104532677448"></a> returned, the buffer with cached page contents is said to be <em>referenced</em>, and the storage engine has to hand it back to the page cache or dereference it once it’s done. The page cache can be instructed to avoid evicting pages by <em>pinning</em> them.</p>

<p>If the page is modified (for example, a cell was appended to it), it is marked as dirty. A dirty flag set on the page indicates that its contents are out of sync with the disk and have to be flushed for durability.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Cache Eviction"><div class="sect2" id="idm46104532673688">
<h2>Cache Eviction</h2>

<p>Keeping<a data-type="indexterm" data-primary="buffer management" data-secondary="cache eviction" id="idm46104532676120"></a><a data-type="indexterm" data-primary="eviction" id="idm46104532671976"></a> caches populated is good: we can serve more reads without going to persistent storage, and more same-page writes can be buffered together. However, the page cache has a limited capacity and, sooner or later, to serve the new contents, old pages have to be evicted. If page contents are in sync with the disk (i.e., were already flushed or were never modified) and the page is not pinned or referenced, it can be evicted right away. Dirty<a data-type="indexterm" data-primary="dirty pages" id="idm46104532680248"></a><a data-type="indexterm" data-primary="flushing" id="idm46104532678104"></a> pages have to be <em>flushed</em> before they can be evicted. Referenced pages should not be evicted while some other thread is using them.</p>

<p>Since triggering a flush on every eviction might be bad for performance, some databases use a separate background process that cycles through the dirty pages that are likely to be evicted, updating their disk versions. For example, PostgreSQL has a <a href="https://databass.dev/links/34">background flush writer</a> that does just that.</p>

<p>Another<a data-type="indexterm" data-primary="durability" id="idm46104532669784"></a> important property to keep in mind is <em>durability</em>: if the database has crashed, all data that was not flushed is lost. To make sure that all changes are persisted, flushes<a data-type="indexterm" data-primary="checkpointing" id="idm46104532667992"></a> are coordinated by the <em>checkpoint</em> process. The checkpoint<a data-type="indexterm" data-primary="write-ahead log (WAL)" id="idm46104532666792"></a><a data-type="indexterm" data-primary="page caches" id="idm46104532666152"></a> process controls the write-ahead log (WAL) and page cache, and ensures that they work in lockstep. Only log records associated with operations applied to cached pages that were flushed can be discarded from the WAL. Dirty pages cannot be evicted until this process completes.</p>

<p>This means there is always a trade-off between several objectives:</p>

<ul>
<li>
<p>Postpone flushes to reduce the number of disk accesses</p>
</li>
<li>
<p>Preemptively flush pages to allow quick eviction</p>
</li>
<li>
<p>Pick pages for eviction and flush in the optimal order</p>
</li>
<li>
<p>Keep cache size within its memory bounds</p>
</li>
<li>
<p>Avoid losing the data as it is not persisted to the primary storage</p>
</li>
</ul>

<p>We explore several techniques that help us to improve the first three characteristics while keeping us within the boundaries of the other two.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Locking Pages in Cache"><div class="sect2" id="idm46104532673432">
<h2>Locking Pages in Cache</h2>

<p>Having<a data-type="indexterm" data-primary="locking" id="idm46104532656104"></a><a data-type="indexterm" data-primary="buffer management" data-secondary="locking pages in cache" id="idm46104532655608"></a> to perform disk I/O on each read or write is impractical: subsequent reads may request the same page, just as subsequent writes may modify the same page. Since B-Tree gets “narrower” toward the top, higher-level nodes (ones that are closer to the root) are hit for most of the reads. Splits and merges also eventually propagate to the higher-level nodes. This means there’s always at least a part of a tree that can significantly benefit from being cached.</p>

<p>We can “lock” pages that have a high probability of being used in the nearest time. Locking pages<a data-type="indexterm" data-primary="pinning" id="idm46104532646136"></a> in the cache is called <em>pinning</em>. Pinned pages are kept in memory for a longer time, which helps to reduce the number of disk accesses and improve performance <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#GRAEFE11">[GRAEFE11]</a>.</p>

<p>Since each lower B-Tree node level has exponentially more nodes than the higher one, and higher-level nodes represent just a small fraction of the tree, this part of the tree can reside in memory permanently, and other parts can be paged in on demand. This means that, in order to perform a query, we won’t have to make <code>h</code> disk accesses (as discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch02.html#b_tree_complexity">“B-Tree Lookup Complexity”</a>, <code>h</code> is the height of the tree), but only hit the disk for the lower levels, for which pages are not cached.</p>

<p>Operations performed against a subtree may result in structural changes that contradict each other—for example, multiple delete operations causing merges followed by writes causing splits, or vice versa. Likewise for structural changes that propagate from different subtrees (structural changes occurring close to each other in time, in different parts of the tree, propagating up). These operations can be buffered together by applying changes only in memory, which can reduce the number of disk writes and amortize the operation costs, since only one write can be performed instead of multiple writes.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104532644664">
<h5>Prefetching and Immediate Eviction</h5>
<p>The<a data-type="indexterm" data-primary="prefetching" id="idm46104532649928"></a><a data-type="indexterm" data-primary="immediate eviction" id="idm46104532648616"></a><a data-type="indexterm" data-primary="eviction" id="idm46104532647976"></a><a data-type="indexterm" data-primary="buffer management" data-secondary="circular buffers" id="idm46104532647272"></a> page cache also allows the storage engine to have fine-grained control over prefetching and eviction. It can be instructed to load pages ahead of time, before they are accessed. For example, when the leaf nodes are traversed in a range scan, the next leaves can be preloaded. Similarly, if a maintenance process loads the page, it can be evicted immediately after the process finishes, since it’s unlikely to be useful for the in-flight queries. Some databases, for example, <a href="https://databass.dev/links/35">PostgreSQL</a>, use<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="circular buffers" id="idm46104532642808"></a><a data-type="indexterm" data-primary="circular buffers" id="idm46104532641960"></a> a circular buffer (in other words, FIFO page replacement policy) for large sequential scans.<a data-type="indexterm" data-primary="" data-startref="cach05" id="idm46104532641192"></a></p>
</div></aside>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Page Replacement"><div class="sect2" id="idm46104532633496">
<h2>Page Replacement</h2>

<p>When<a data-type="indexterm" data-primary="page replacement" data-secondary="eviction policy" id="idm46104532640360"></a><a data-type="indexterm" data-primary="buffer management" data-secondary="page replacement" id="BMreplace05"></a> cache capacity is reached, to load new pages, old ones have to be evicted. However, unless we evict pages that are least likely to be accessed again soon, we might end up loading them several times subsequently even though we could’ve just kept them in memory for all that time. We need to find a way to estimate the likelihood of subsequent page access to optimize this.</p>

<p>For this, we can say that pages should be<a data-type="indexterm" data-primary="eviction policy" id="idm46104532628088"></a><a data-type="indexterm" data-primary="page-replacement policy" id="idm46104532638056"></a> evicted according to the <em>eviction policy</em> (also sometimes called the <em>page-replacement</em> policy). It attempts to find pages that are least likely to be accessed again any time soon. When the page is evicted from the cache, the new page can be loaded in its place.</p>

<p>For a page cache implementation to be performant, it needs an efficient page-replacement algorithm. An ideal page-replacement strategy would require a crystal ball that would predict the order in which pages are going to be accessed and evict only pages that will not be touched for the longest time. Since requests do not necessarily follow any specific pattern or distribution, precisely predicting behavior can be complicated, but using a right page replacement strategy can help to reduce the number of evictions.</p>

<p>It seems logical that we can reduce the number of evictions by simply using a larger cache. However, this does not appear to be the case. One of the examples demonstrating this dilemma this is called <em>Bélády’s anomaly</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BEDALY69">[BEDALY69]</a>. It shows that increasing the number of pages might increase the number of evictions if the used page-replacement algorithm is not optimal. When pages that might be required soon are evicted and then loaded again, pages start competing for space in the cache. Because of that, we need to wisely consider the algorithm we’re using, so that it would improve the situation, not make it worse.</p>










<section data-type="sect3" data-pdf-bookmark="FIFO and LRU"><div class="sect3" id="idm46104532626856">
<h3>FIFO and LRU</h3>

<p>The<a data-type="indexterm" data-primary="page replacement" data-secondary="FIFO algorithm" id="idm46104532623368"></a><a data-type="indexterm" data-primary="first in, first out (FIFO) strategy" id="idm46104532622520"></a> most naïve page-replacement strategy is first in, first out (<em>FIFO</em>). FIFO maintains a queue of page IDs in their insertion order, adding new pages to the tail of the queue. Whenever the page cache is full, it takes the element from the head of the queue to find the page that was paged in at the farthest point in time. Since it does not account for subsequent page accesses, only for page-in events, this proves to be impractical for the most real-world systems. For example, the root and topmost-level pages are paged in first and, according to this algorithm, are the first candidates for eviction, even though it’s clear from the tree structure that these pages are likely to paged in again soon, if not immediately.</p>

<p>A<a data-type="indexterm" data-primary="page replacement" data-secondary="LRU-based cache eviction" id="idm46104532632088"></a> natural extension of the FIFO algorithm<a data-type="indexterm" data-primary="least-recently used (LRU)" id="idm46104532625912"></a> is <em>least-recently used</em> (LRU) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#TANENBAUM14">[TANENBAUM14]</a>. It also maintains a queue of eviction candidates in insertion order, but allows you to place a page back to the tail of the queue on repeated accesses, as if this was the first time it was paged in. However, updating references and relinking nodes on every access can become expensive in a concurrent environment.</p>

<p>There are other LRU-based cache eviction strategies. For example, 2Q (Two-Queue LRU) maintains two queues and puts pages into the first queue during the initial access and moves them to the second <em>hot</em> queue on subsequent accesses, allowing you to distinguish between the recently and frequently accessed pages <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#JONSON94">[JONSON94]</a>. LRU-K identifies frequently referenced pages by keeping track of the last <code>K</code> accesses, and using this information to estimate access times on a page basis <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#ONEIL93">[ONEIL93]</a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="CLOCK"><div class="sect3" id="idm46104532624440">
<h3>CLOCK</h3>

<p>In<a data-type="indexterm" data-primary="page replacement" data-secondary="CLOCK algorithm" id="idm46104532619288"></a><a data-type="indexterm" data-primary="CLOCK algorithm" id="idm46104532618376"></a> some situations, efficiency may be more important than precision. <em>CLOCK</em> algorithm variants are often used as compact, cache-friendly, and concurrent alternatives to LRU <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#SOUNDARARARJAN06">[SOUNDARARARJAN06]</a>. Linux, for example, uses a <a href="https://databass.dev/links/36">variant of the CLOCK algorithm</a>.</p>

<p>CLOCK-sweep holds references to pages and associated access bits in a<a data-type="indexterm" data-primary="circular buffers" id="idm46104532608936"></a><a data-type="indexterm" data-primary="buffer management" data-secondary="circular buffers" id="idm46104532608328"></a> circular buffer. Some variants use <a href="https://databass.dev/links/37">counters</a> instead of bits to account for frequency. Every time the page is accessed, its access bit is set to <code>1</code>. The algorithm works by going around the circular buffer, checking access bits:</p>

<ul>
<li>
<p>If the access bit is <code>1</code>, and the page is unreferenced, it is set to <code>0</code>, and the next page is inspected.</p>
</li>
<li>
<p>If the access bit is already <code>0</code>, the page<a data-type="indexterm" data-primary="candidates" id="idm46104532603496"></a> becomes a <em>candidate</em> and is scheduled for eviction.</p>
</li>
<li>
<p>If the page is currently referenced, its access bit remains unchanged. It is assumed that the access bit of an accessed page cannot be 0, so it cannot be evicted. This makes referenced pages less likely to be replaced.</p>
</li>
</ul>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#clock_algorithm">Figure&nbsp;5-2</a> shows a circular buffer with access bits.</p>

<figure class="width-50"><div id="clock_algorithm" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0502.png" alt="dbin 0502" width="1438" height="1438" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0502.png">
<h6><span class="label">Figure 5-2. </span>CLOCK-sweep example. Counters for currently referenced pages are shown in gray. Counters for unreferenced pages are shown in white. The arrow points to the element that will be checked next.</h6>
</div></figure>

<p>An advantage of using a circular buffer is that both the clock hand pointer and contents can be modified using compare-and-swap operations, and do not require additional locking mechanisms. The algorithm is easy to understand and implement and is often used in both textbooks <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#TANENBAUM14">[TANENBAUM14]</a> and real-wold systems.</p>

<p>LRU is not always the best replacement strategy for a database system. Sometimes, it may<a data-type="indexterm" data-primary="usage frequency" id="idm46104532595960"></a><a data-type="indexterm" data-primary="page replacement" data-secondary="usage frequency" id="idm46104532595576"></a> be more practical to consider <em>usage frequency</em> rather than <em>recency</em> as a predictive factor. In the end, for a database system under a heavy load, recency might not be very indicative as it only represents the order in which items were accessed.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="LFU"><div class="sect3" id="idm46104532596648">
<h3>LFU</h3>

<p>To<a data-type="indexterm" data-primary="least-frequently used (LFU)" id="idm46104532590840"></a><a data-type="indexterm" data-primary="page replacement" data-secondary="least-frequently used (LFU)" id="idm46104532589848"></a> improve the situation, we can<a data-type="indexterm" data-primary="page reference events" id="idm46104532588488"></a><a data-type="indexterm" data-primary="paging-in" id="idm46104532587880"></a> start tracking <em>page reference events</em> rather than <em>page-in events</em>. One of the approaches allowing us to do this tracks least-frequently used (LFU) pages.</p>

<p>TinyLFU, a<a data-type="indexterm" data-primary="TinyLFU" id="idm46104532586008"></a> frequency-based page-eviction policy <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#EINZIGER17">[EINZIGER17]</a>, does precisely this: instead of evicting pages based on <em>page-in recency</em>, it orders pages<a data-type="indexterm" data-primary="usage frequency" id="idm46104532583656"></a> by <em>usage frequency</em>. It is implemented in the popular Java library called <a href="https://databass.dev/links/38">Caffeine</a>.</p>

<p>TinyLFU uses a frequency histogram <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CORMODE11">[CORMODE11]</a> to maintain compact cache access history, since preserving an entire history might be prohibitively expensive for practical purposes.</p>

<p>Elements can be in one of the three queues:</p>

<ul>
<li>
<p><em>Admission</em>, maintaining<a data-type="indexterm" data-primary="admission queue" id="idm46104532578280"></a> newly added elements, implemented using LRU policy.</p>
</li>
<li>
<p><em>Probation</em>, holding<a data-type="indexterm" data-primary="probation queue" id="idm46104532575848"></a> elements most likely to get evicted.</p>
</li>
<li>
<p><em>Protected</em>, holding<a data-type="indexterm" data-primary="protected queue" id="idm46104532573864"></a> elements that are to stay in the queue for a longer time.</p>
</li>
</ul>

<p>Rather than choosing which elements to evict every time, this approach chooses which ones to promote for retention. Only the items that have a frequency larger than the item that would be evicted as a result of promoting them, can be moved to the probation queue. On subsequent accesses, items can get moved from probation to the protected queue. If the protected queue is full, one of the elements from it may have to be placed back into probation. More frequently accessed items have a higher chance of retention, and less frequently used ones are more likely to be evicted.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#tiny_lfu_algorithm">Figure&nbsp;5-3</a> shows the logical connections between the admission, probation, and protected queues, the frequency filter, and eviction.</p>

<figure><div id="tiny_lfu_algorithm" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0503.png" alt="dbin 0503" width="1440" height="352" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0503.png">
<h6><span class="label">Figure 5-3. </span>TinyLFU admission, protected, and probation queues</h6>
</div></figure>

<p>There are many other algorithms that can be used for optimal cache eviction. The choice of a page-replacement strategy has a significant impact on latency and the number of performed I/O operations, and has to be taken into consideration.<a data-type="indexterm" data-primary="" data-startref="TPRbuffer5" id="idm46104532569896"></a><a data-type="indexterm" data-primary="" data-startref="BMreplace05" id="idm46104532565464"></a></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Recovery"><div class="sect1" id="write_ahead_log">
<h1>Recovery</h1>

<p>Database systems<a data-type="indexterm" data-primary="recovery" data-secondary="write-ahead log (WAL)" id="idm46104532567912"></a><a data-type="indexterm" data-primary="write-ahead log (WAL)" id="idm46104532567064"></a><a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="recovery" id="TPRrecov05"></a><a data-type="indexterm" data-primary="commit log" id="idm46104532561544"></a> are built on top of several hardware and software layers that can have their own stability and reliability problems. Database systems themselves, as well as the underlying software and hardware components, may fail. Database implementers have to consider these failure scenarios and make sure that the data that was “promised” to be written is, in fact, written.</p>

<p>A <em>write-ahead log</em> (WAL for short, also known as a <em>commit log</em>) is an append-only auxiliary disk-resident structure used for crash and transaction recovery. The page cache allows buffering changes to page contents in memory. Until the cached contents are flushed back to disk, the only disk-resident copy preserving the operation history is stored in the WAL. Many<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="append-only write-ahead logs" id="idm46104532560072"></a><a data-type="indexterm" data-primary="MySQL" data-secondary="append-only write-ahead logs" id="idm46104532559224"></a> database systems use append-only write-ahead logs; for example, <a href="https://databass.dev/links/39">PostgreSQL</a> and <a href="https://databass.dev/links/40">MySQL</a>.</p>

<p>The main functionality of a write-ahead log can be summarized as:</p>

<ul>
<li>
<p>Allow the page cache to buffer updates to disk-resident pages while ensuring durability semantics in the larger context of a database system.</p>
</li>
<li>
<p>Persist all operations on disk until the cached copies of pages affected by these operations are synchronized on disk. Every operation that modifies the database state has to be logged on disk <em>before</em> the contents of the associated pages can be modified.</p>
</li>
<li>
<p>Allow lost in-memory changes to be reconstructed from the operation log in case of a crash.</p>
</li>
</ul>

<p>In addition to this functionality, the write-ahead log plays an important role in transaction processing. It is hard to overstate the importance of the WAL as it ensures that data makes it to the persistent storage and is available in case of a crash, as uncommitted data is replayed from the log and the pre-crash database state is fully restored. In this section, we will often refer to ARIES (Algorithm for Recovery and Isolation Exploiting Semantics), a state-of-the-art recovery algorithm that is widely used and cited <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MOHAN92">[MOHAN92]</a>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104532549896">
<h5>PostgreSQL Versus fsync()</h5>
<p>PostgreSQL<a data-type="indexterm" data-primary="PostgreSQL" data-secondary="versus fsync()" data-secondary-sortas="fsync()" id="idm46104532547672"></a><a data-type="indexterm" data-primary="fsync()" id="idm46104532546584"></a> uses checkpoints to ensure that index and data files have been updated with all information up to a certain record in the logfile. Flushing all dirty (modified) pages at once is done periodically by the checkpoint process. Synchronizing dirty page contents with disk is done by making the <code>fsync()</code> kernel call, which is supposed to sync dirty pages to disk, and unset the <em>dirty</em> flag on the kernel pages. As you would expect, <code>fsync</code> returns with an error if it isn’t able to flush pages on disk.</p>

<p>In Linux and a few other operating systems, <code>fsync</code> unsets the dirty flag <em>even</em> from unsuccessfully flushed pages after I/O errors. Additionally, errors will be reported only to the file descriptors that were open at the time of failure, so <code>fsync</code> will <em>not</em> return any errors that have occurred <em>before</em> the descriptor it was called upon was opened <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CORBET18">[CORBET18]</a>.</p>

<p>Since the checkpointer doesn’t keep all files open at any given point in time, it may happen that it misses error notifications. Because dirty page flags are cleared, the checkpointer will assume that data has successfully made it on disk while, in fact, it might have not been written.</p>

<p>A combination of these behaviors can be a source of data loss or database corruption in the presence of potentially recoverable failures. Such behaviors can be difficult to detect and some of the states they lead to may be unrecoverable. Sometimes, even triggering such behavior can be nontrivial. When working on recovery mechanisms, we should always take extra care and think through and attempt to test every possible failure scenario.</p>
</div></aside>








<section data-type="sect2" data-pdf-bookmark="Log Semantics"><div class="sect2" id="idm46104532533144">
<h2>Log Semantics</h2>

<p>The<a data-type="indexterm" data-primary="recovery" data-secondary="log semantics" id="idm46104532531800"></a> write-ahead log is append-only and its written contents are immutable, so all writes to the log are sequential. Since the WAL is an immutable, append-only data structure, readers can safely access its contents up to the latest write threshold while the writer continues appending data to the log tail.</p>

<p>The WAL consists of log records. Every record has a unique, monotonically<a data-type="indexterm" data-primary="log sequence number (LSN)" id="idm46104532531064"></a> increasing <em>log sequence number</em> (LSN). Usually, the LSN is represented by an internal counter or a timestamp. Since log records do not necessarily occupy an entire disk block, their contents are cached in the<a data-type="indexterm" data-primary="log buffer" id="idm46104532530936"></a><a data-type="indexterm" data-primary="force operation" id="idm46104532537656"></a> <em>log buffer</em> and are flushed on disk in a <em>force</em> operation. Forces happen as the log buffers fill up, and can be requested by the transaction manager or a page cache. All log records have to be flushed on disk in LSN order.</p>

<p>Besides individual operation records, the WAL holds records indicating transaction completion. A transaction can’t be considered committed until the log is forced up to the LSN of its commit record.</p>

<p>To make sure the system can continue functioning correctly after a crash during rollback or recovery, some<a data-type="indexterm" data-primary="compensation log records (CLR)" id="idm46104532526616"></a> systems use <em>compensation log records</em> (CLR) during undo and store them in the log.</p>

<p>The WAL is usually coupled with a primary storage structure by the interface that allows<a data-type="indexterm" data-primary="trimming" id="idm46104532525320"></a><a data-type="indexterm" data-primary="checkpointing" id="idm46104532524936"></a> <em>trimming</em> it whenever a <em>checkpoint</em> is reached. Logging is one of the most critical correctness aspects of the database, which is somewhat tricky to get right: even the slightest disagreements between log trimming and ensuring that the data has made it to the primary storage structure may cause data loss.</p>

<p>Checkpoints are a way for a log to know that log records up to a certain mark are fully persisted and aren’t required anymore, which significantly reduces the amount of work required during the database startup. A<a data-type="indexterm" data-primary="sync checkpoint" id="idm46104532523752"></a><a data-type="indexterm" data-primary="flushing" id="idm46104532523144"></a><a data-type="indexterm" data-primary="dirty pages" id="idm46104532522440"></a> process that forces <em>all</em> dirty pages to be flushed on disk is generally called a <em>sync checkpoint</em>, as it fully synchronizes the primary storage structure.</p>

<p>Flushing the entire contents on disk is rather impractical and would require pausing all running operations until the checkpoint is done, so<a data-type="indexterm" data-primary="fuzzy checkpoints" id="idm46104532521736"></a> most database systems implement <em>fuzzy checkpoints</em>. In this case, the <code>last_checkpoint</code> pointer stored in the log header contains the information about the last successful checkpoint. A fuzzy checkpoint begins with a special <code>begin_checkpoint</code> log record specifying its start, and ends with <code>end_checkpoint</code> log record, containing information about the dirty pages, and the contents of a transaction table. Until all the pages specified by this record are flushed, the checkpoint is considered<a data-type="indexterm" data-primary="incomplete checkpoints" id="idm46104532518024"></a> to be <em>incomplete</em>. Pages are flushed asynchronously and, once this is done, the <code>last_checkpoint</code> record is updated with the LSN of the <code>begin_checkpoint</code> record and, in case of a crash, the recovery process will start from there <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MOHAN92">[MOHAN92]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Operation Versus Data Log"><div class="sect2" id="idm46104532519592">
<h2>Operation Versus Data Log</h2>

<p>Some<a data-type="indexterm" data-primary="recovery" data-secondary="operation versus data logs" id="idm46104532512632"></a><a data-type="indexterm" data-primary="operation logs" id="idm46104532511432"></a><a data-type="indexterm" data-primary="data logs" id="idm46104532510824"></a><a data-type="indexterm" data-primary="shadow paging" id="idm46104532510184"></a> database systems, for example System R <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHAMBERLIN81">[CHAMBERLIN81]</a>, use <em>shadow paging</em>: a copy-on-write technique ensuring data durability and transaction atomicity. New contents are placed into the new unpublished <em>shadow</em> page and made visible with a pointer flip, from the old page to the one holding updated contents.</p>

<p>Any state change can be represented by a before-image and an after-image or by corresponding redo and undo operations. Applying<a data-type="indexterm" data-primary="redo operations" id="idm46104532509224"></a><a data-type="indexterm" data-primary="before-images" id="idm46104532504696"></a><a data-type="indexterm" data-primary="after-images" id="idm46104532506808"></a> a <em>redo</em> operation to a <em>before-image</em> produces an <em>after-image</em>. Similarly, applying an <em>undo</em> operation to an <em>after-image</em> produces a <em>before-image</em>.</p>

<p>We<a data-type="indexterm" data-primary="physical logs" id="idm46104532501352"></a><a data-type="indexterm" data-primary="logical logs" id="idm46104532500744"></a> can use a physical log (that stores complete page state or byte-wise changes to it) or a logical log (that stores operations that have to be performed against the current state) to move records or pages from one state to the other, both backward and forward in time. It is important to track the <em>exact</em> state of the pages that physical and logical log records can be applied to.</p>

<p>Physical logging records before and after images, requiring entire pages affected by the operation to be logged. A logical log specifies which operations have to be applied to the page, such as <code>"insert a data record X for key Y"</code>, and a corresponding undo operation, such as <code>"remove the value associated with Y"</code>.</p>

<p>In practice, many database systems use a combination of these two approaches, using logical logging to perform an undo (for concurrency and performance) and physical logging to perform a redo (to improve recovery time) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MOHAN92">[MOHAN92]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Steal and Force Policies"><div class="sect2" id="idm46104532494104">
<h2>Steal and Force Policies</h2>

<p>To<a data-type="indexterm" data-primary="recovery" data-secondary="steal and force policies" id="idm46104532498456"></a><a data-type="indexterm" data-primary="steal/no-steal policy" id="idm46104532497608"></a><a data-type="indexterm" data-primary="force/no-force policy" id="idm46104532497000"></a> determine when the changes made in memory have to be flushed on disk, database management systems define steal/no-steal and force/no-force policies. These policies are <em>mostly</em> applicable to the page cache, but they’re better discussed in the context of recovery, since they have a significant impact on which recovery approaches can be used in combination with them.</p>

<p>A recovery method that allows flushing a page modified by the transaction even before the transaction has committed is called a <em>steal</em> policy. A <em>no-steal</em> policy does not allow flushing any uncommitted transaction contents on disk. To <em>steal</em> a dirty page here means flushing its in-memory contents to disk and loading a different page from disk in its place.</p>

<p>A <em>force</em> policy requires all pages modified by the transactions to be flushed on disk <em>before</em> the transaction commits. On the other hand, a <em>no-force</em> policy allows a transaction to commit even if some pages modified during this transaction were not yet flushed on disk. To <em>force</em> a dirty page here means to flush it on disk before the <span class="keep-together">commit.</span></p>

<p>Steal<a data-type="indexterm" data-primary="undo and redo" id="idm46104532485896"></a> and force policies are important to understand, since they have implications for transaction undo and redo. <em>Undo</em> rolls back updates to forced pages for committed transactions, while <em>redo</em> applies changes performed by committed transactions on disk.</p>

<p>Using the <em>no-steal</em> policy allows implementing recovery using only redo entries: old copy is contained in the page on disk and modification is stored in the log <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>. With <em>no-force</em>, we potentially can buffer several updates to pages by <em>deferring</em> them. Since page contents have to be cached in memory for that time, a larger page cache may be needed.</p>

<p>When the <em>force</em> policy is used, crash recovery doesn’t need any additional work to reconstruct the results of committed transactions, since pages modified by these transactions are already flushed. A major drawback of using this approach is that transactions take longer to commit due to the necessary I/O.</p>

<p>More generally, <em>until</em> the transaction commits, we need to have enough information to undo its results. If any pages touched by the transaction are flushed, we need to keep undo information in the log until it commits to be able to roll it back. Otherwise, we have to keep redo records in the log until it commits. In both cases, transaction <em>cannot</em> commit until either undo or redo records are written to the logfile.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="ARIES"><div class="sect2" id="idm46104532493848">
<h2>ARIES</h2>

<p>ARIES<a data-type="indexterm" data-primary="recovery" data-secondary="ARIES algorithm" id="idm46104532477336"></a><a data-type="indexterm" data-primary="ARIES" id="idm46104532476104"></a> is a <em>steal/no-force</em> recovery algorithm. It uses physical redo to improve performance during recovery (since changes can be installed quicker) and logical undo to improve concurrency during normal operation (since logical undo operations can be applied to pages independently). It<a data-type="indexterm" data-primary="repeating history" id="idm46104532475080"></a> uses WAL records to implement <em>repeating history</em> during recovery, to completely reconstruct the database state before undoing uncommitted transactions, and creates compensation log records during undo <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MOHAN92">[MOHAN92]</a>.</p>

<p>When the database system restarts after the crash, recovery proceeds in three phases:</p>
<ol>
<li>
<p>The <em>analysis</em> phase identifies dirty pages in the page cache and transactions that were in progress at the time of a crash. Information about dirty pages is used to identify the starting point for the redo phase. A list of in-progress transactions is used during the undo phase to roll back incomplete transactions.</p>
</li>
<li>
<p>The <em>redo</em> phase repeats the history up to the point of a crash and restores the database to the previous state. This phase is done for incomplete transactions as well as ones that were committed but whose contents weren’t flushed to persistent storage.</p>
</li>
<li>
<p>The <em>undo</em> phase rolls back all incomplete transactions and restores the database to the last consistent state. All operations are rolled back in reverse chronological order. In case the database crashes again during recovery, operations that undo transactions are logged as well to avoid repeating them.</p>
</li>

</ol>

<p>ARIES uses LSNs for identifying log records, tracks pages modified by running transactions in the dirty page table, and uses physical redo, logical undo, and fuzzy checkpointing. Even though the paper describing this system was released in 1992, most concepts, approaches, and paradigms are still relevant in transaction processing and recovery today.<a data-type="indexterm" data-primary="" data-startref="TPRrecov05" id="idm46104532462216"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Concurrency Control"><div class="sect1" id="b_tree_concurrency">
<h1>Concurrency Control</h1>

<p>When<a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="concurrency control" id="TRPconcur05"></a><a data-type="indexterm" data-primary="concurrency control" data-secondary="categories of" id="idm46104532466376"></a> discussing database management system architecture in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch01.html#dbms_architecture">“DBMS Architecture”</a>, we mentioned that the transaction manager and lock manager work together to handle <em>concurrency control</em>. Concurrency control is a set of techniques for handling interactions between concurrently executing transactions. These techniques can be roughly grouped into the following categories:</p>
<dl>
<dt>Optimistic concurrency control (OCC)</dt>
<dd>
<p>Allows<a data-type="indexterm" data-primary="optimistic concurrency control (OCC)" id="idm46104532456040"></a> transactions to execute concurrent read and write operations, and determines whether or not the result of the combined execution is serializable. In other words, transactions do not block each other, maintain histories of their operations, and check these histories for possible conflicts before commit. If execution results in a conflict, one of the conflicting transactions is aborted.</p>
</dd>
<dt>Multiversion concurrency control (MVCC)</dt>
<dd>
<p>Guarantees<a data-type="indexterm" data-primary="multiversion concurrency control (MVCC)" id="idm46104532453800"></a> a consistent view of the database at some point in the past identified by the timestamp by allowing multiple timestamped versions of the record to be present. MVCC can be implemented using validation techniques, allowing only one of the updating or committing transactions to win, as well as with lockless techniques such as timestamp ordering, or lock-based ones, such as two-phase locking.</p>
</dd>
<dt>Pessimistic (also known as conservative) concurrency control (PCC)</dt>
<dd>
<p>There<a data-type="indexterm" data-primary="pessimistic (conservative) concurrency control (PCC)" id="idm46104532447256"></a><a data-type="indexterm" data-primary="conservative concurrency control" id="idm46104532446376"></a> are both lock-based and nonlocking conservative methods, which differ in how they manage and grant access to shared resources. Lock-based approaches require transactions to maintain locks on database records to prevent other transactions from modifying locked records and assessing records that are being modified until the transaction releases its locks. Nonlocking approaches maintain read and write operation lists and restrict execution, depending on the schedule of unfinished transactions. Pessimistic schedules can result in a deadlock when multiple transactions wait for each other to release a lock in order to proceed.</p>
</dd>
</dl>

<p>In this chapter, we concentrate on node-local concurrency control techniques. In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html#database_transactions">Chapter&nbsp;13</a>, you can find information about distributed transactions and other approaches, such as deterministic concurrency control (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html#calvin">“Distributed Transactions with Calvin”</a>).</p>

<p>Before we can further discuss concurrency control, we need to define a set of problems we’re trying to solve and discuss how transaction operations overlap and what consequences this overlapping has.</p>








<section data-type="sect2" data-pdf-bookmark="Serializability"><div class="sect2" id="serializability">
<h2>Serializability</h2>

<p>Transactions<a data-type="indexterm" data-primary="isolation levels" data-secondary="serializability" id="idm46104532444888"></a><a data-type="indexterm" data-primary="serializability" id="idm46104532444040"></a> consist of read and write operations executed against the database state, and business logic (transformations, applied to the read contents). A<a data-type="indexterm" data-primary="schedules" id="idm46104532443400"></a> <em>schedule</em> is a list of operations required to execute a set of transactions from the database-system perspective (i.e., only ones that interact with the database state, such as read, write, commit, or abort operations), since all other operations are assumed to be side-effect free (in other words, have no impact on the database state) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MOLINA08">[MOLINA08]</a>.</p>

<p>A<a data-type="indexterm" data-primary="complete schedules" id="idm46104532442392"></a><a data-type="indexterm" data-primary="correct schedules" id="idm46104532441400"></a> schedule is <em>complete</em> if contains all operations from every transaction executed in it. <em>Correct</em> schedules are logical equivalents to the original lists of operations, but their parts can be executed in parallel or get reordered for optimization purposes, as long as this does not<a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="ACID properties" id="idm46104532437224"></a><a data-type="indexterm" data-primary="ACID properties" id="idm46104532434056"></a> violate ACID properties and the correctness of the results of individual transactions <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>.</p>

<p>A<a data-type="indexterm" data-primary="serial schedules" id="idm46104532436216"></a> schedule is said to be <em>serial</em> when transactions in it are executed completely independently and without any interleaving: every preceding transaction is fully executed before the next one starts. Serial execution is easy to reason about, as contrasted with all possible interleavings between several multistep transactions. However, always executing transactions one after another would significantly limit the system throughput and hurt performance.</p>

<p>We need to find a way to execute transaction operations concurrently, while maintaining the correctness and simplicity of a serial schedule. We can achieve this with <em>serializable</em> schedules. A schedule is serializable if it is equivalent to <em>some</em> complete serial schedule over the same set of transactions. In other words, it produces the same result as if we executed a set of transactions one after another in <em>some</em> order. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#serializable_schedules">Figure&nbsp;5-4</a> shows three concurrent transactions, and possible execution histories (<span class="keep-together"><code>3! = 6</code></span> possibilities, in every possible order).</p>

<figure><div id="serializable_schedules" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0504.png" alt="dbin 0504" width="1438" height="450" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0504.png">
<h6><span class="label">Figure 5-4. </span>Concurrent transactions and their possible sequential execution histories</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Transaction Isolation"><div class="sect2" id="transaction_isolation">
<h2>Transaction Isolation</h2>

<p>Transactional<a data-type="indexterm" data-primary="concurrency control" data-secondary="transaction isolation" id="idm46104532423736"></a><a data-type="indexterm" data-primary="transaction isolation" id="idm46104532422888"></a><a data-type="indexterm" data-primary="isolation levels" data-secondary="purpose of" id="idm46104532422280"></a> database systems allow different isolation levels. An <em>isolation level</em> specifies how and when parts of the transaction can and should become visible to other transactions. In other words, isolation levels describe the degree to which transactions are isolated from other concurrently executing transactions, and what kinds of anomalies can be encountered during execution.</p>

<p>Achieving isolation comes at a cost: to prevent incomplete or temporary writes from propagating over transaction boundaries, we need additional coordination and synchronization, which negatively impacts the performance.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Read and Write Anomalies"><div class="sect2" id="read_write_anomalies">
<h2>Read and Write Anomalies</h2>

<p>The<a data-type="indexterm" data-primary="isolation levels" data-secondary="read and write anomalies" id="idm46104532418616"></a> SQL standard <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MELTON06">[MELTON06]</a> refers to and describes <em>read anomalies</em> that can occur during execution of concurrent transactions: dirty, nonrepeatable, and phantom reads.</p>

<p>A <em>dirty read</em> is<a data-type="indexterm" data-primary="dirty reads" id="idm46104532414216"></a><a data-type="indexterm" data-primary="read anomalies" data-secondary="dirty read" id="idm46104532413608"></a> a situation in which a transaction can read uncommitted changes from other transactions. For example, transaction <code>T<sub>1</sub></code> updates a user record with a new value for the address field, and transaction <code>T<sub>2</sub></code> reads the updated address before <code>T<sub>1</sub></code> commits. Transaction <code>T<sub>1</sub></code> aborts and rolls back its execution results. However, <code>T<sub>2</sub></code> has already been able to read this value, so it has accessed the value that has never been committed.</p>

<p>A <em>nonrepeatable read</em> (sometimes called a fuzzy read)<a data-type="indexterm" data-primary="nonrepeatable reads" id="idm46104532408216"></a><a data-type="indexterm" data-primary="fuzzy reads" id="idm46104532407544"></a><a data-type="indexterm" data-primary="read anomalies" data-secondary="nonrepeatable read" id="idm46104532405096"></a> is a situation in which a transaction queries the <em>same row</em> twice and gets different results. For example, this can happen even if transaction <code>T<sub>1</sub></code> reads a row, then transaction <code>T<sub>2</sub></code> modifies it <em>and commits</em> this change. If <code>T<sub>1</sub></code> requests the same row again before finishing its execution, the result will differ from the previous run.</p>

<p>If<a data-type="indexterm" data-primary="phantom reads" id="idm46104532400488"></a><a data-type="indexterm" data-primary="read anomalies" data-secondary="phantom read" id="idm46104532399656"></a> we use range reads during the transaction (i.e., read not a single data record, but a range of records), we might see <em>phantom records</em>. A <em>phantom read</em> is when a <span class="keep-together">transaction</span> queries the same <em>set of rows</em> twice and receives different results. It is similar to a nonrepeatable read, but holds for range queries.</p>

<p>There<a data-type="indexterm" data-primary="write anomalies" id="idm46104532396424"></a> are also <em>write anomalies</em> with similar semantics: lost update, dirty write, and write skew.</p>

<p>A <em>lost update</em> occurs<a data-type="indexterm" data-primary="lost updates" id="idm46104532393592"></a> when transactions <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code> both attempt to update the value of <code>V</code>. <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code> read the value of <code>V</code>. <code>T<sub>1</sub></code> updates <code>V</code> and commts, and <code>T<sub>2</sub></code> updates <code>V</code> after that and commits as well. Since the transactions are not aware about each other’s existence, if both of them are allowed to commit, the results of <code>T<sub>1</sub></code> will be overwritten by the results of <code>T<sub>2</sub></code>, and the update from <code>T<sub>1</sub></code> will be lost.</p>

<p>A <em>dirty write</em> is<a data-type="indexterm" data-primary="dirty writes" id="idm46104532382376"></a> a situation in which one of the transactions takes an uncommitted value (i.e., dirty read), modifies it, and saves it. In other words, when transaction results are based on the values that have never been committed.</p>

<p>A <em>write skew</em> occurs<a data-type="indexterm" data-primary="write skews" id="idm46104532380168"></a> when each individual transaction respects the required invariants, but their combination does not satisfy these invariants. For example, transactions <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code> modify values of two accounts <code>A<sub>1</sub></code> and <code>A<sub>2</sub></code>. <code>A<sub>1</sub></code> starts with <code>100$</code> and <code>A<sub>2</sub></code> starts with <code>150$</code>. The account value is allowed to be negative, as long as the sum of the two accounts is nonnegative: <code>A<sub>1</sub> + A<sub>2</sub> &gt;= 0</code>. <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code> each attempt to withdraw <code>200$</code> from <code>A<sub>1</sub></code> and <code>A<sub>2</sub></code>, respectively. Since at the time these transactions start <code>A<sub>1</sub> + A<sub>2</sub> = 250$</code>, <code>250$</code> is available in total. Both transactions assume they’re preserving the invariant and are allowed to commit. After the commit, <code>A<sub>1</sub></code> has <code>-100$</code> and <code>A<sub>2</sub></code> has <code>-50$</code>, which clearly violates the requirement to keep a sum of the accounts positive <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#FEKETE04">[FEKETE04]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Isolation Levels"><div class="sect2" id="isolation_levels">
<h2>Isolation Levels</h2>

<p>The<a data-type="indexterm" data-primary="concurrency control" data-secondary="isolation levels" id="idm46104532360184"></a><a data-type="indexterm" data-primary="isolation levels" data-secondary="already committed" id="idm46104532359336"></a><a data-type="indexterm" data-primary="read uncommitted isolation level" id="idm46104532358488"></a> lowest (in other words, weakest) isolation level is <em>read uncommitted</em>. Under this isolation level, the transactional system allows one transaction to observe uncommitted changes of other concurrent transactions. In other words, dirty reads are allowed.</p>

<p>We can avoid some of the anomalies. For example, we can make sure that any read performed by the specific transaction can only read <em>already committed</em> changes. However, it is not guaranteed that if the transaction attempts to read the same data record once again at a later stage, it will see the same value. If there was a committed modification between two reads, two queries in the same transaction would yield different results. In other words, dirty reads are not permitted, but phantom and nonrepeatable reads are. This<a data-type="indexterm" data-primary="read committed isolation level" id="idm46104532356792"></a> isolation level is called <em>read committed</em>. If we further disallow nonrepeatable reads, we<a data-type="indexterm" data-primary="repeatable read isolation level" id="idm46104532354248"></a> get a <em>repeatable read</em> isolation level.</p>

<p>The strongest isolation level is<a data-type="indexterm" data-primary="serializability" id="idm46104532354776"></a> serializability. As we already discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#serializability">“Serializability”</a>, it guarantees that transaction outcomes will appear in <em>some</em> order as if transactions were executed <em>serially</em> (i.e., without overlapping in time). Disallowing concurrent execution would have a substantial negative impact on the database performance. Transactions can get reordered, as long as their internal invariants hold and can be executed concurrently, but their outcomes have to appear in <em>some</em> serial order.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#isolation_levels_001">Figure&nbsp;5-5</a> shows isolation levels and the anomalies they allow.</p>

<figure><div id="isolation_levels_001" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0505.png" alt="dbin 0505" width="1439" height="300" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0505.png">
<h6><span class="label">Figure 5-5. </span>Isolation levels and allowed anomalies</h6>
</div></figure>

<p>Transactions that do not have dependencies can be executed in any order since their results are fully independent. Unlike<a data-type="indexterm" data-primary="linearizability" id="idm46104532346472"></a> linearizability (which we discuss in the context of distributed systems; see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch11.html#linearizability">“Linearizability”</a>), serializability is a property of <em>multiple</em> operations executed in <em>arbitrary</em> order. It does not imply or attempt to impose any particular order on executing transactions. <em>Isolation</em> in <a data-type="indexterm" data-primary="transaction processing and recovery" data-secondary="ACID properties" id="idm46104532342840"></a><a data-type="indexterm" data-primary="ACID properties" id="idm46104532341992"></a>ACID terms means serializability <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BAILIS14a">[BAILIS14a]</a>. Unfortunately, implementing serializability requires coordination. In other words, transactions executing concurrently have to coordinate to preserve invariants and impose a serial order on conflicting executions <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BAILIS14b">[BAILIS14b]</a>.</p>

<p>Some<a data-type="indexterm" data-primary="snapshot isolation (SI)" id="idm46104532339176"></a> databases use <em>snapshot isolation</em>. Under snapshot isolation, a transaction can observe the state changes performed by all transactions that were committed by the time it has started. Each transaction takes a snapshot of data and executes queries against it. This snapshot cannot change during transaction execution. The transaction commits only if the values it has modified did <em>not</em> change while it was executing. Otherwise, it is aborted and rolled back.</p>

<p>If two transactions attempt to modify the same value, only one of them is allowed to commit. This<a data-type="indexterm" data-primary="lost update anomaly" id="idm46104532337400"></a> precludes a <em>lost update</em> anomaly. For example, transactions <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code> both attempt to modify <code>V</code>. They read the current value of <code>V</code> from the snapshot that contains changes from all transactions that were committed before they started. Whichever transaction attempts to commit first, will commit, and the other one will have to abort. The failed transactions will retry instead of overwriting the value.</p>

<p>A <em>write skew</em> anomaly<a data-type="indexterm" data-primary="write skews" id="idm46104532332520"></a> is possible under snapshot isolation, since if two transactions read from local state, modify independent records, and preserve local invariants, they both are allowed to commit <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#FEKETE04">[FEKETE04]</a>. We discuss snapshot isolation in more detail in the context of distributed transactions in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html#percolator">“Distributed Transactions with Percolator”</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Optimistic Concurrency Control"><div class="sect2" id="idm46104532329672">
<h2>Optimistic Concurrency Control</h2>

<p>Optimistic concurrency control<a data-type="indexterm" data-primary="concurrency control" data-secondary="optimistic concurrency control (OCC)" id="idm46104532327352"></a><a data-type="indexterm" data-primary="optimistic concurrency control (OCC)" id="idm46104532326504"></a> assumes that transaction conflicts occur rarely and, instead of using locks and blocking transaction execution, we can validate transactions to prevent read/write conflicts with concurrently executing transactions and ensure serializability before committing their results. Generally, transaction execution is split into three phases <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>:</p>
<dl>
<dt>Read phase</dt>
<dd>
<p>The<a data-type="indexterm" data-primary="read phase" id="idm46104532323336"></a> transaction executes its steps in its own private context, without making any of the changes visible to other transactions. After this step, all transaction dependencies (<em>read set</em>) are known, as well as the side effects the transaction produces (<em>write set</em>).</p>
</dd>
<dt>Validation phase</dt>
<dd>
<p>Read<a data-type="indexterm" data-primary="validation phase" id="idm46104532321224"></a> and write sets of concurrent transactions are checked for the presence of possible conflicts between their operations that might violate serializability. If some of the data the transaction was reading is now out-of-date, or it would overwrite some of the values written by transactions that committed during its read phase, its private context is cleared and the read phase is restarted. In other words, the validation phase determines whether or not committing the transaction preserves ACID properties.</p>
</dd>
<dt>Write phase</dt>
<dd>
<p>If<a data-type="indexterm" data-primary="write phase" id="idm46104532317480"></a> the validation phase hasn’t determined any conflicts, the transaction can commit its write set from the private context to the database state.</p>
</dd>
</dl>

<p>Validation<a data-type="indexterm" data-primary="backward-oriented validation" id="idm46104532316264"></a><a data-type="indexterm" data-primary="forward-oriented validation" id="idm46104532315656"></a> can be done by checking for conflicts with the transactions that have already been committed (<em>backward-oriented</em>), or with the transactions that are currently in the validation phase (<em>forward-oriented</em>). Validation and write phases of different transactions should be done atomically. No transaction is allowed to commit while some other transaction is being validated. Since validation and write phases are generally shorter than the read phase, this is an acceptable compromise.</p>

<p>Backward-oriented concurrency control ensures that for any pair of transactions <code>T<sub>1</sub></code> and <code>T<sub>2</sub></code>, the following properties hold:</p>

<ul>
<li>
<p><code>T<sub>1</sub></code> was committed before the read phase of <code>T<sub>2</sub></code> began, so <code>T<sub>2</sub></code> is allowed to commit.</p>
</li>
<li>
<p><code>T<sub>1</sub></code> was committed before the <code>T<sub>2</sub></code> write phase, and the write set of <code>T<sub>1</sub></code> doesn’t intersect with the <code>T<sub>2</sub></code> read set. In other words, <code>T<sub>1</sub></code> hasn’t written any values <code>T<sub>2</sub></code> should have seen.</p>
</li>
<li>
<p>The read phase of <code>T<sub>1</sub></code> has completed before the read phase of <code>T<sub>2</sub></code>, and the write set of <code>T<sub>2</sub></code> doesn’t intersect with the read or write sets of <code>T<sub>1</sub></code>. In other words, <span class="keep-together">transactions</span> have operated on independent sets of data records, so both are allowed to commit.</p>
</li>
</ul>

<p>This approach is efficient if validation usually succeeds and transactions don’t have to be retried, since retries have a significant negative impact on performance. Of course, optimistic concurrency still has a <em>critical section</em>, which transactions can enter one at a time. Another approach that allows nonexclusive ownership for some operations is to use readers-writer locks (to allow shared access for readers) and upgradeable locks (to allow conversion of shared locks to exclusive when needed).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Multiversion Concurrency Control"><div class="sect2" id="mvcc">
<h2>Multiversion Concurrency Control</h2>

<p>Multiversion concurrency control<a data-type="indexterm" data-primary="concurrency control" data-secondary="multiversion concurrency control (MVCC)" id="idm46104532292408"></a><a data-type="indexterm" data-primary="multiversion concurrency control (MVCC)" id="idm46104532291560"></a> is a way to achieve transactional consistency in database management systems by allowing multiple record versions and using monotonically incremented transaction IDs or timestamps. This allows reads and writes to proceed with a minimal coordination on the storage level, since reads can continue accessing older values until the new ones are committed.</p>

<p>MVCC<a data-type="indexterm" data-primary="committed version" id="idm46104532294024"></a><a data-type="indexterm" data-primary="uncommitted version" id="idm46104532293416"></a> distinguishes between <em>committed</em> and <em>uncommitted</em> versions, which correspond to value versions of committed and uncommitted transactions. The last committed version of the value is assumed to be <em>current</em>. Generally, the goal of the transaction manager in this case is to have at most one uncommitted value at a time.</p>

<p>Depending on the isolation level implemented by the database system, read operations may or may not be allowed to access uncommitted values <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>. Multiversion concurrency can be implemented using locking, scheduling, and conflict resolution techniques (such as two-phase locking), or timestamp ordering. One of the major use cases for MVCC for implementing snapshot isolation <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HELLERSTEIN07">[HELLERSTEIN07]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Pessimistic Concurrency Control"><div class="sect2" id="idm46104532289144">
<h2>Pessimistic Concurrency Control</h2>

<p>Pessimistic concurrency control<a data-type="indexterm" data-primary="pessimistic (conservative) concurrency control (PCC)" id="idm46104532284872"></a><a data-type="indexterm" data-primary="concurrency control" data-secondary="pessimistic (conservative) concurrency control (PCC)" id="idm46104532284136"></a> schemes are more conservative than optimistic ones. These schemes determine transaction conflicts while they’re running and block or abort their execution.</p>

<p>One<a data-type="indexterm" data-primary="timestamp ordering" id="idm46104532282456"></a> of the simplest pessimistic (lock-free) concurrency control schemes is <em>timestamp ordering</em>, where each transaction has a timestamp. Whether or not transaction operations are allowed to be executed is determined by whether or not any transaction with an <em>earlier</em> timestamp has already been committed. To implement that, the transaction manager has to maintain <code>max_read_timestamp</code> and <code>max_write_timestamp</code> per value, describing read and write operations executed by concurrent transactions.</p>

<p class="pagebreak-before"><em>Read</em> operations that attempt to read a value with a timestamp lower than <code>max_write_timestamp</code> cause the transaction they belong to be aborted, since there’s already a newer value, and allowing this operation would violate the transaction order.</p>

<p>Similarly, <em>write</em> operations with a timestamp lower than <code>max_read_timestamp</code> would conflict with a more recent read. However, <em>write</em> operations with a timestamp lower than <code>max_write_timestamp</code> are allowed, since we can safely ignore the outdated written values. This<a data-type="indexterm" data-primary="Thomas Write Rule" id="idm46104532274520"></a> conjecture is commonly called the <em>Thomas Write Rule</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#THOMAS79">[THOMAS79]</a>. As soon as read or write operations are performed, the corresponding maximum timestamp values are updated. Aborted transactions restart with a <em>new</em> timestamp, since otherwise they’re guaranteed to be aborted again <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAMAKRISHNAN03">[RAMAKRISHNAN03]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Lock-Based Concurrency Control"><div class="sect2" id="lock_based_cc">
<h2>Lock-Based Concurrency Control</h2>

<p>Lock-based concurrency control<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="overview of" id="idm46104532269416"></a><a data-type="indexterm" data-primary="concurrency control" data-secondary="lock-based concurrency control" id="CClock05"></a> schemes are a form of pessimistic concurrency control that uses explicit locks on the database objects rather than resolving schedules, like protocols such as timestamp ordering do. Some of the downsides of using locks are contention and scalability issues <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#REN16">[REN16]</a>.</p>

<p>One<a data-type="indexterm" data-primary="two-phase locking (2PL)" id="idm46104532266232"></a> of the most widespread lock-based techniques is <em>two-phase locking</em> (2PL), which separates lock management into two phases:</p>

<ul>
<li>
<p>The<a data-type="indexterm" data-primary="growing phase" id="idm46104532263784"></a><a data-type="indexterm" data-primary="expanding phase" id="idm46104532262728"></a> <em>growing phase</em> (also called the <em>expanding phase</em>), during which all locks required by the transaction are acquired and no locks are released.</p>
</li>
<li>
<p>The<a data-type="indexterm" data-primary="shrinking phase" id="idm46104532260456"></a> <em>shrinking phase</em>, during which all locks acquired during the growing phase are released.</p>
</li>
</ul>

<p>A rule that follows from these two definitions is that a transaction cannot acquire any locks as soon as it has released at least one of them. It’s important to note that 2PL does not preclude transactions from executing steps during either one of these phases; however, some 2PL variants (such as conservative 2PL) do impose these <span class="keep-together">limitations.</span></p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Despite similar names, two-phase locking is a concept that is entirely different from<a data-type="indexterm" data-primary="two-phase commits (2PCs)" data-secondary="versus two-phase locking" id="idm46104532256632"></a> two-phase commit (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html#two_phase_commit">“Two-Phase Commit”</a>). Two-phase commit is a protocol used for distributed multipartition transactions, while two-phase locking is a concurrency control mechanism often used to implement <span class="keep-together">serializability.</span></p>
</div>










<section data-type="sect3" data-pdf-bookmark="Deadlocks"><div class="sect3" id="deadlocks">
<h3>Deadlocks</h3>

<p>In<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="deadlocks" id="idm46104532251672"></a><a data-type="indexterm" data-primary="deadlocks" id="idm46104532250824"></a> locking protocols, transactions attempt to acquire locks on the database objects and, in case a lock cannot be granted immediately, a transaction has to wait until the lock is released. A situation may occur when two transactions, while attempting to acquire locks they require in order to proceed with execution, end up waiting for each other to release the other locks they hold. This situation is called a <em>deadlock</em>.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#deadlock_1">Figure&nbsp;5-6</a> shows an example of a deadlock: <code>T<sub>1</sub></code> holds lock <code>L<sub>1</sub></code> and waits for lock <code>L<sub>2</sub></code> to be released, while <code>T<sub>2</sub></code> holds lock <code>L<sub>2</sub></code> and waits for <code>L<sub>1</sub></code> to be released.</p>

<figure class="width-75"><div id="deadlock_1" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0506.png" alt="dbin 0506" width="598" height="334" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0506.png">
<h6><span class="label">Figure 5-6. </span>Example of a deadlock</h6>
</div></figure>

<p>The simplest way to handle deadlocks is to introduce timeouts and abort long-running transactions under the assumption that they might be in a deadlock. Another strategy, conservative 2PL<a data-type="indexterm" data-primary="conservative 2PL" id="idm46104532239944"></a>, requires transactions to acquire all the locks before they can execute any of their operations and abort if they cannot. However, these approaches significantly limit system concurrency, and database systems mostly use a transaction manager<a data-type="indexterm" data-primary="transaction manager" id="idm46104532236280"></a> to <em>detect</em> or <em>avoid</em> (in other words, prevent) deadlocks.</p>

<p>Detecting deadlocks<a data-type="indexterm" data-primary="waits-for graphs" id="idm46104532238424"></a> is generally done using a <em>waits-for graph</em>, which tracks relationships between the in-flight transactions and establishes waits-for relationships between them.</p>

<p>Cycles in this graph indicate the presence of a deadlock: transaction <code>T<sub>1</sub></code> is waiting for <code>T<sub>2</sub></code> which, in turn, waits for <code>T<sub>1</sub></code>. Deadlock detection can be done <em>periodically</em> (once per time interval) or <em>continuously</em> (every time the waits-for graph is updated) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#WEIKUM01">[WEIKUM01]</a>. One of the transactions (usually, the one that attempted to acquire the lock more recently) is aborted.</p>

<p>To <em>avoid</em> deadlocks and restrict lock acquisition to cases that will not result in a deadlock, the transaction manager can use transaction timestamps to determine their <em>priority</em>. A lower timestamp usually implies higher priority and vice versa.</p>

<p>If transaction <code>T<sub>1</sub></code> attempts to acquire a lock currently held by <code>T<sub>2</sub></code>, and <code>T<sub>1</sub></code> has higher priority (it started before <code>T<sub>2</sub></code>), we can use one of the following restrictions to avoid deadlocks <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAMAKRISHNAN03">[RAMAKRISHNAN03]</a>:</p>
<dl>
<dt><em>Wait-die</em></dt>
<dd>
<p><code>T<sub>1</sub></code> is allowed<a data-type="indexterm" data-primary="wait-die restriction" id="idm46104532222120"></a> to block and <em>wait</em> for the lock. Otherwise, T<sub>1</sub> is aborted and restarted. In other words, a transaction can be blocked only by a transaction with a higher timestamp.</p>
</dd>
<dt><em>Wound-wait</em></dt>
<dd>
<p><code>T<sub>2</sub></code> is aborted and restarted (<code>T<sub>1</sub></code> <em>wounds</em> <code>T<sub>2</sub></code>). Otherwise (if <code>T<sub>2</sub></code> has started before <code>T<sub>1</sub></code>), <code>T<sub>1</sub></code> is allowed<a data-type="indexterm" data-primary="wound-wait restriction" id="idm46104532213400"></a> to wait. In other words, a transaction can be blocked only by a transaction with a lower timestamp.</p>
</dd>
</dl>

<p>Transaction processing requires a scheduler to handle deadlocks. At the same time, latches (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#latches">“Latches”</a>) rely on the programmer to ensure that deadlocks cannot happen and do not rely on deadlock avoidance mechanisms.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Locks"><div class="sect3" id="idm46104532255400">
<h3>Locks</h3>

<p>If two transactions are submitted concurrently, modifying overlapping segments of data, neither one of them should observe partial results of the other one, hence maintaining logical consistency. Similarly, two threads from the same transaction have to observe the same database contents, and have access to each other’s data.</p>

<p>In<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="locks" id="idm46104532211832"></a> transaction processing, there’s a distinction between the mechanisms that guard the logical and physical data integrity. The two concepts responsible logical and physical integrity are, correspondingly, <em>locks</em> and <em>latches</em>. The naming is somewhat unfortunate since what’s called a latch here is usually referred to as a lock in systems programming, but we’ll clarify the distinction and implications in this section.</p>

<p>Locks are used to isolate and schedule overlapping transactions and manage database contents but not the internal storage structure, and are acquired on the key. Locks can guard either a specific key (whether it’s existing or nonexisting) or a range of keys. Locks are generally stored and managed outside of the tree implementation and represent a higher-level concept, managed by the database lock manager.</p>

<p>Locks are more heavyweight than latches and are held for the duration of the <span class="keep-together">transaction.</span></p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Latches"><div class="sect3" id="latches">
<h3>Latches</h3>

<p>On<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="latches" id="idm46104532205320"></a><a data-type="indexterm" data-primary="latches" id="idm46104532204472"></a> the other hand, latches guard the <em>physical</em> representation: leaf page contents are modified during insert, update, and delete operations. Nonleaf page contents and a tree structure are modified during operations resulting in splits and merges that propagate from leaf under- and overflows. Latches guard the physical tree representation (page contents and the tree structure) during these operations and are obtained on the page level. Any page has to be latched to allow safe concurrent access to it. Lockless concurrency control techniques still have to use latches.</p>

<p>Since a single modification on the leaf level might propagate to higher levels of the B-Tree, latches might have to be obtained on multiple levels. Executing queries should not be able to observe pages in an inconsistent state, such as incomplete writes or partial node splits, during which data might be present in both the source and target node, or not yet propagated to the parent.</p>

<p>The same rules apply to parent or sibling pointer updates. A general rule is to hold a latch for the smallest possible duration—namely, when the page is read or updated—to increase concurrency.</p>

<p>Interferences<a data-type="indexterm" data-primary="concurrency control" data-secondary="interference between operations" id="idm46104532193272"></a> between concurrent operations can be roughly grouped into three <span class="keep-together">categories:</span></p>

<ul>
<li>
<p><em>Concurrent reads</em>, when several threads access the same page without modifying it.</p>
</li>
<li>
<p><em>Concurrent updates</em>, when several threads attempt to make modifications to the same page.</p>
</li>
<li>
<p><em>Reading while writing</em>, when one of the threads is trying to modify the page contents, and the other one is trying to access the same page for a read.</p>
</li>
</ul>

<p>These scenarios also apply to accesses that overlap with database maintenance (such as background processes, as described in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#vacuum_and_maintenance">“Vacuum and Maintenance”</a>).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Readers-writer lock"><div class="sect3" id="readers_writers_locks">
<h3>Readers-writer lock</h3>

<p>The<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="readers-writer lock (RW lock)" id="idm46104532189688"></a><a data-type="indexterm" data-primary="readers-writer lock (RW lock)" id="idm46104532188488"></a> simplest latch implementation would grant exclusive read/write access to the requesting thread. However, most of the time, we do not need to isolate <em>all</em> the processes from each other. For example, reads can access pages concurrently without causing any trouble, so we only need to make sure that multiple concurrent <em>writers</em> do not overlap, and <em>readers</em> do not overlap with <em>writers</em>. To achieve this level of granularity, we can use a <em>readers-writer lock</em> or RW lock.</p>

<p>An RW lock allows multiple readers to access the object concurrently, and only writers (which we usually have fewer of) have to obtain exclusive access to the object. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#read_write_locks_2">Figure&nbsp;5-7</a> shows the compatibility table for readers-writer locks: only readers can share lock ownership, while all other combinations of readers and writers should obtain exclusive ownership.</p>

<figure class="width-50"><div id="read_write_locks_2" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0507.png" alt="dbin 0507" width="1261" height="359" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0507.png">
<h6><span class="label">Figure 5-7. </span>Readers-writer lock compatibility table</h6>
</div></figure>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#read_write_locks_1">Figure&nbsp;5-8</a> (a), we have multiple readers accessing the object, while the writer is waiting for its turn, since it can’t modify the page while readers access it. In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#read_write_locks_1">Figure&nbsp;5-8</a> (b), <code>writer 1</code> holds an exclusive lock on the object, while another writer and three readers have to wait.</p>

<figure><div id="read_write_locks_1" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0508.png" alt="dbin 0508" width="1440" height="194" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0508.png">
<h6><span class="label">Figure 5-8. </span>Readers-writer locks</h6>
</div></figure>

<p>Since two overlapping reads attempting to access the same page do not require synchronization other than preventing the page from being fetched from disk by the page cache twice, reads can be safely executed concurrently in shared mode. As soon as writes come into play, we need to isolate them from both concurrent reads and other writes.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104532176472">
<h5>Busy-Wait and Queueing Techniques</h5>
<p>To<a data-type="indexterm" data-primary="busy-wait algorithms" id="idm46104532175016"></a> manage shared access to pages, we can either use blocking algorithms, which de-schedule threads and wake them up as soon as they can proceed, or use busy-wait algorithms. Busy-wait algorithms allow threads to wait for insignificant amounts of time instead of handing control back to the scheduler.</p>

<p>Queuing is usually implemented using<a data-type="indexterm" data-primary="compare-and-swap instructions" id="idm46104532170104"></a> compare-and-swap instructions, used to perform operations guaranteeing lock acquisition and<a data-type="indexterm" data-primary="queueing techniques" id="idm46104532173096"></a> queue update atomicity. If the queue is empty, the thread obtains access immediately. Otherwise, the thread appends itself to the waiting queue and spins on the variable that can be updated only by the thread preceding it in the queue. This helps to reduce the amount of CPU traffic for lock acquisition and release <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MELLORCRUMMEY91">[MELLORCRUMMEY91]</a>.</p>
</div></aside>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Latch crabbing"><div class="sect3" id="latch_crabbing">
<h3>Latch crabbing</h3>

<p>The<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="latch crabbing" id="idm46104532168120"></a><a data-type="indexterm" data-primary="latch crabbing" id="idm46104532167272"></a> most straightforward approach for latch acquisition is to grab all the latches on the way from the root to the target leaf. This creates a concurrency bottleneck and can be avoided in most cases. The time during which a latch is held should be minimized. One of the optimizations that can be used to achieve that is called <em>latch crabbing</em> (or latch coupling) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RAMAKRISHNAN03">[RAMAKRISHNAN03]</a>.</p>

<p>Latch crabbing is a rather simple method that allows holding latches for less time and releasing them as soon as it’s clear that the executing operation does not require them anymore. On the read path, as soon as the child node is located and its latch is acquired, the parent node’s latch can be released.</p>

<p>During insert, the parent latch can be released if the operation is guaranteed not to result in structural changes that can propagate to it. In other words, the parent latch can be released if the child node is not full.</p>

<p>Similarly, during deletes, if the child node holds enough elements and the operation will not cause sibling nodes to merge, the latch on the parent node is released.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#latch_crabbing_1">Figure&nbsp;5-9</a> shows a root-to-leaf pass during insert:</p>

<ul>
<li>
<p>a) The write latch is acquired on the root level.</p>
</li>
<li>
<p>b) The next-level node is located, and its write latch is acquired. The node is checked for potential structural changes. Since the node is not full, the parent latch can be released.</p>
</li>
<li>
<p>c) The operation descends to the next level. The write latch is acquired, the target leaf node is checked for potential structural changes, and the parent latch is released.</p>
</li>
</ul>

<p>This approach is optimistic: most insert and delete operations do not cause structural changes that propagate multiple levels up. In fact, the probability of structural changes decreases at higher levels. Most of the operations only require the latch on the target node, and the number of cases when the parent latch has to be retained is relatively small.</p>

<p>If the child page is still not loaded in the page cache, we can either latch a future loading page, or release a parent latch and restart the root-to-leaf pass after the page is loaded to reduce contention. Restarting root-to-leaf traversal sounds rather expensive, but in reality, we have to perform it rather infrequently, and can employ mechanisms to detect whether or not there were any structural changes at higher levels since the time of traversal <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#GRAEFE10">[GRAEFE10]</a>.</p>

<figure><div id="latch_crabbing_1" class="figure">
<img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_0509.png" alt="dbin 0509" width="1440" height="1711" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_0509.png">
<h6><span class="label">Figure 5-9. </span>Latch crabbing during insert</h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar" class="less_space pagebreak-before"><div class="sidebar" id="idm46104532150072">
<h5>Latch Upgrading and Pointer Chasing</h5>
<p>Instead<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="latch upgrading and pointer chasing" id="idm46104532154360"></a><a data-type="indexterm" data-primary="latch upgrading" id="idm46104532153512"></a><a data-type="indexterm" data-primary="pointer chasing" id="idm46104532152904"></a> of acquiring latches during traversal in an exclusive mode right away, <em>latch upgrading</em> can be employed instead. This approach involves acquisition of shared locks along the search path and <em>upgrading</em> them to exclusive locks when necessary.</p>

<p>Write operations first acquire exclusive locks only at the leaf level. If the leaf has to be split or merged, the algorithm walks up the tree and attempts to <em>upgrade</em> a shared lock that the parent holds, acquiring exclusive ownership of latches for the affected portion of the tree (i.e., nodes that will also be split or merged as a result of that operation). Since multiple threads might attempt to acquire exclusive locks on one of the higher levels, one of them has to wait or restart.</p>

<p>You might have noticed that the mechanisms described so far all start by acquiring a latch on the root node. Every request has to go through the root node, and it quickly becomes a bottleneck. At the same time, the root is always the last to be split, since all of its children have to fill up first. This means that the root node can <em>always</em> be latched optimistically, and the price of a retry (<em>pointer chasing</em>) is seldom paid.</p>
</div></aside>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Blink-Trees"><div class="sect3" id="b_link_trees">
<h3>Blink-Trees</h3>

<p>B<sup>link</sup>-Trees build<a data-type="indexterm" data-primary="lock-based concurrency control" data-secondary="Blink-Trees" id="idm46104532143400"></a><a data-type="indexterm" data-primary="Blink-Trees" id="idm46104532142552"></a><a data-type="indexterm" data-primary="high keys" id="idm46104532141912"></a><a data-type="indexterm" data-primary="sibling links" id="idm46104532141208"></a> on top of B*-Trees (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#btree_rebalancing">“Rebalancing”</a>) and add <em>high keys</em> (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html#node_high_keys">“Node High Keys”</a>) and <em>sibling link</em> pointers <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LEHMAN81">[LEHMAN81]</a>. A high key indicates the highest possible subtree key. Every node but root in a B<sup>link</sup>-Tree has two pointers: a child pointer descending from the parent and a sibling link from the left node residing on the same level.</p>

<p>B<sup>link</sup>-Trees<a data-type="indexterm" data-primary="half-split nodes" id="idm46104532135064"></a> allow a state called <em>half-split</em>, where the node is already referenced by the sibling pointer, but not by the child pointer from its parent. Half-split is identified by checking the node high key. If the search key exceeds the high key of the node (which violates the high key invariant), the lookup algorithm concludes that the structure has been changed concurrently and follows the sibling link to proceed with the search.</p>

<p>The pointer has to be quickly added to the parent guarantee the best performance, but the search process doesn’t have to be aborted and restarted, since all elements in the tree are accessible. The advantage here is that we do not have to hold the parent lock when descending to the child level, even if the child is going to be split: we can make a new node visible through its sibling link and update the parent pointer lazily without sacrificing correctness <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#GRAEFE10">[GRAEFE10]</a>.</p>

<p>While this is slightly less efficient than descending directly from the parent and requires accessing an extra page, this results in correct root-to-leaf descent while simplifying concurrent access. Since splits are a relatively infrequent operation and B-Trees rarely shrink, this case is exceptional, and its cost is insignificant. This approach has quite a few benefits: it reduces contention, prevents holding a parent lock during splits, and reduces the number of locks held during tree structure modification to a constant number. More importantly, it allows reads concurrent to structural tree changes, and prevents deadlocks otherwise resulting from concurrent modifications ascending to the parent nodes.<a data-type="indexterm" data-primary="" data-startref="TRPconcur05" id="idm46104532122312"></a><a data-type="indexterm" data-primary="" data-startref="CClock05" id="idm46104532124920"></a></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm46104532460232">
<h1>Summary</h1>

<p>In this chapter, we discussed the storage engine components responsible for transaction processing and recovery. When implementing transaction processing, we are presented with two problems:</p>

<ul>
<li>
<p>To improve efficiency, we need to allow concurrent transaction execution.</p>
</li>
<li>
<p>To preserve correctness, we have to ensure that concurrently executing transactions preserve ACID properties.</p>
</li>
</ul>

<p>Concurrent transaction execution can cause different kinds of read and write anomalies. Presence or absence of these anomalies is described and limited by implementing different isolation levels. Concurrency control approaches determine how transactions are scheduled and executed.</p>

<p>The page cache is responsible for reducing the number of disk accesses: it caches pages in memory and allows read and write access to them. When the cache reaches its capacity, pages are evicted and flushed back on disk. To make sure that unflushed changes are not lost in case of node crashes and to support transaction rollback, we use write-ahead logs. The page cache and write-ahead logs are coordinated using force and steal policies, ensuring that every transaction can be executed efficiently and rolled back without sacrificing durability.</p>
<aside data-type="sidebar" epub:type="sidebar" class="less_space pagebreak-before"><div class="sidebar" id="idm46104532120680">
<h5>Further Reading</h5>
<p>If you’d like to learn more about the concepts mentioned in this chapter, you can refer to the following sources:</p>
<dl>
<dt>Transaction processing and recovery, generally</dt>
<dd>
<p>Weikum, Gerhard, and Gottfried Vossen. 2001. <em>Transactional Information Systems: Theory, Algorithms, and the Practice of Concurrency Control and Recovery</em>. San Francisco: Morgan Kaufmann Publishers Inc.</p>

<p>Bernstein, Philip A. and Eric Newcomer. 2009. <em>Principles of Transaction Processing</em>. San Francisco: Morgan Kaufmann.</p>

<p>Graefe, Goetz, Guy, Wey &amp; Sauer, Caetano. 2016. “Instant Recovery with Write-Ahead Logging: Page Repair, System Restart, Media Restore, and System Failover, (2nd Ed.)” in <em>Synthesis Lectures on Data Management</em> 8, 1-113. 10.2200/S00710ED2V01Y201603DTM044.</p>

<p>Mohan, C., Don Haderle, Bruce Lindsay, Hamid Pirahesh, and Peter Schwarz. 1992. “ARIES: a transaction recovery method supporting fine-granularity locking and partial rollbacks using write-ahead logging.” <em>Transactions on Database Systems</em> 17, no. 1 (March): 94-162. <a href="https://doi.org/10.1145/128765.128770"><em class="hyperlink">https://doi.org/10.1145/128765.128770</em></a>.</p>
</dd>
<dt>Concurrency control in B-Trees</dt>
<dd>
<p>Wang, Paul. 1991. “An In-Depth Analysis of Concurrent B-Tree Algorithms.” MIT Technical Report. <a href="https://apps.dtic.mil/dtic/tr/fulltext/u2/a232287.pdf"><em class="hyperlink">https://apps.dtic.mil/dtic/tr/fulltext/u2/a232287.pdf</em></a>.</p>

<p>Goetz Graefe. 2010. A survey of B-tree locking techniques. ACM Trans. Database Syst. 35, 3, Article 16 (July 2010), 26 pages.</p>
</dd>
<dt>Parallel and concurrent data structures</dt>
<dd>
<p>McKenney, Paul E. 2012. “Is Parallel Programming Hard, And, If So,What Can You Do About It?” <a href="https://arxiv.org/abs/1701.00854"><em class="hyperlink">https://arxiv.org/abs/1701.00854</em></a>.</p>

<p>Herlihy, Maurice and Nir Shavit. 2012.  <em>The Art of Multiprocessor Programming, Revised Reprint (1st Ed.)</em>. San Francisco: Morgan Kaufmann.</p>
</dd>
<dt>Chronological developments in the field of transaction processing</dt>
<dd>
<p>Diaconu, Cristian, Craig Freedman, Erik Ismert, Per-Åke Larson, Pravin Mittal, Ryan Stonecipher, Nitin Verma, and Mike Zwilling. 2013. “Hekaton: SQL Server’s Memory-Optimized OLTP Engine.” In <em>Proceedings of the 2013 ACM SIGMOD International Conference on Management of Data (SIGMOD ’13)</em>, 1243-1254. New York: Association for Computing Machinery. <a href="https://doi.org/10.1145/2463676.2463710"><em class="hyperlink">https://doi.org/10.1145/2463676.2463710</em></a>.</p>

<p>Kimura, Hideaki. 2015. “FOEDUS: OLTP Engine for a Thousand Cores and NVRAM.” In <em>Proceedings of the 2015 ACM SIGMOD International Conference on Management of Data (SIGMOD ’15)</em>, 691-706. <a href="https://doi.org/10.1145/2723372.2746480"><em class="hyperlink">https://doi.org/10.1145/2723372.2746480</em></a>.</p>

<p>Yu, Xiangyao, Andrew Pavlo, Daniel Sanchez, and Srinivas Devadas. 2016. “TicToc: Time Traveling Optimistic Concurrency Control.” In <em>Proceedings of the 2016 International Conference on Management of Data (SIGMOD ’16)</em>, 1629-1642. <a href="https://doi.org/10.1145/2882903.2882935"><em class="hyperlink">https://doi.org/10.1145/2882903.2882935</em></a>.</p>

<p>Kim, Kangnyeon, Tianzheng Wang, Ryan Johnson, and Ippokratis Pandis. 2016. “ERMIA: Fast Memory-Optimized Database System for Heterogeneous Workloads.” In <em>Proceedings of the 2016 International Conference on Management of Data (SIGMOD ’16)</em>, 1675-1687. <a href="https://doi.org/10.1145/2882903.2882905"><em class="hyperlink">https://doi.org/10.1145/2882903.2882905</em></a>.</p>

<p>Lim, Hyeontaek, Michael Kaminsky, and David G. Andersen. 2017. “Cicada: Dependably Fast Multi-Core In-Memory Transactions.” In <em>Proceedings of the 2017 ACM International Conference on Management of Data (SIGMOD ’17)</em>, 21-35. <a href="https://doi.org/10.1145/3035918.3064015"><em class="hyperlink">https://doi.org/10.1145/3035918.3064015</em></a>.</p>
</dd>
</dl>
</div></aside>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-11" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch04.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">4. Implementing B-Trees</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch06.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">6. B-Tree Variants</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  function decodeHtml(html) {
    var txt = document.createElement("textarea");
    txt.innerHTML = html;
    return txt.value;
  }

  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Database Internals',
      type: 'book',
      identifier: '9781492040330',
      topic: 'Data Warehousing, '
    },
    content: {
      title: 'Database Internals',
      formatType: 'book',
      identifier: '9781492040330',
      author: 'Alex Petrov',
      publisher: decodeHtml('O&#39;Reilly Media, Inc.'),
      releaseDate: '2019-10-08',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          

          
            <p>You have 6 days left in your trial, Iswade. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      
        


<footer class="pagefoot t-pagefoot" style="padding-bottom: 75px;">
  <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" class="icon-up" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2019 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"queueTime":3,"applicationTime":407,"errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","agent":"","licenseKey":"510f1a6865","applicationID":"172641827,79672898,93931619"}</script>

      
    
    <script src="./05. Transaction Processing and Recovery - Database Internals_files/saved_resource" charset="utf-8"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./05. Transaction Processing and Recovery - Database Internals_files/embed.js"></script>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("set","agent","tmgoogletagmanager","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>

<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>
<script type="text/javascript" id="">window._pp=window._pp||[];if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/register/")_pp.targetUrl="/confirm/trial";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/subscribe/")_pp.targetUrl="/confirm/paid";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/signup/")_pp.targetUrl="/confirm/paid";_pp.siteId="2508";
_pp.siteUId="78724200-da8c-4410-821c-6ec73f6340d0";_pp.orderValue="undefined";_pp.orderId="undefined";(function(){var ppjs=document.createElement("script");ppjs.type="text/javascript";ppjs.async=true;ppjs.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.pbbl.co/r/"+_pp.siteId+".js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ppjs,s)})();</script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.8761141995538091"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.039377343765153894" width="0" height="0" alt="" src="./05. Transaction Processing and Recovery - Database Internals_files/0"></div>
    <script src="./05. Transaction Processing and Recovery - Database Internals_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice">Sorry we could not read the annotations from the store</div><div class="font-flyout" style="top: 201.001px; left: 1557.4px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch05.html#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./05. Transaction Processing and Recovery - Database Internals_files/generic1576598380235.js" charset="UTF-8"></script><div style="display: none; visibility: hidden;"><script>(function(){if(null!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')&&void 0!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')){var a=!1;window.addEventListener("blur",function(){a&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"facebook",eventVal:0,nonInteraction:0})});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseover",function(){window.focus();
a=!0});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseout",function(){a=!1})}try{window.twttr=function(b,a,d){var c,e=b.getElementsByTagName(a)[0];if(!b.getElementById(d))return b=b.createElement(a),b.id=d,b.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(b,e),window.twttr||(c={_e:[],ready:function(a){c._e.push(a)}})}(document,"script","twitter-wjs"),twttr.ready(function(a){a.events.bind("tweet",trackTwitter)})}catch(b){}})();
null!==document.querySelector(".IN-widget")&&void 0!==document.querySelector(".IN-widget")&&document.querySelector(".IN-widget").addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"linkedin",eventVal:0,nonInteraction:0})});
function trackTwitter(a){a&&(a.target&&"IFRAME"==a.target.nodeName&&(opt_target=extractParamFromUri(a.target.src,"url")),dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0}))}function extractParamFromUri(a,b){if(a){var c=new RegExp("[\\?\x26#]"+b+"\x3d([^\x26#]*)");c=c.exec(a);if(null!=c)return unescape(c[1])}};</script></div><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./05. Transaction Processing and Recovery - Database Internals_files/widget_iframe.69e02060c7c44baddf1b5629549acc0c.html" title="Twitter settings iframe" style="display: none;"></iframe></body><div class="fika-reader-mode" id="fika-reader" style="display: none;"><div id="fika" class="fika-app theme-vanilla"><!--drawer--><div class="fika-tool"><!--open--><button class="fika-btn fika-btn-icon mr-1" id="fika-tool-btn" data-whats-new="menu"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg></button><!--toc--><button class="fika-btn fika-btn-icon" id="fika-toc-btn"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M4 13c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1zm-3 5c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1z"></path></svg><div class="fika-tooltip">TOC</div></button><button class="fika-btn fika-btn-icon" id="fika-settings" data-whats-new="settings"><svg class="fika-icon" width="20px" height="20px" viewBox="0 0 20 20"><path d="M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"></path></svg><div class="fika-tooltip">Settings</div></button><!--appearance settings--><div class="fika-menu"><div class="fika-menu-nav d-flex flex-column"><div class="fika-menu-nav-item active">Text</div><div class="fika-menu-nav-item">Theme</div><div class="fika-menu-nav-item fika-pro">Autopilot</div><div class="flex-fill"></div><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="fb" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://www.facebook.com/dialog/feed?app_id=393950891439557&amp;display=popup&amp;link=https://chrome.google.com/webstore/detail/fika-reader-mode/fbcdnjeoghampomjjaahjgjghdjdbbcj" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Share to Facebook</a><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="tw" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://twitter.com/intent/retweet?tweet_id=1117715831540965376" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Share to Twitter</a><a class="fika-menu-nav-item small mb-1" href="http://fika.io/updatelog" target="_blank">What's new</a><div class="fika-menu-nav-item static small" style="font-size: 12px;line-height: 16px;" id="fika-beta-info"><div class="fika-pro" style=" margin-left: -4px;"></div>Login and share Fika to gain BETA access.</div><!--<a class="fika-menu-nav-item small" href="http://fika.io/pro" target="_blank">Upgrade to Pro</a>--><div class="fika-menu-login"><div id="fika-login" class="px-2"><div class="mb-1">Log in</div><div>with Google account</div></div><div class="fika-loading" id="fika-loading-login" style="display: none;position: absolute;right: 16px;bottom: 24px;"></div></div></div><div class="fika-menu-view-cont"><!--text--><div class="fika-menu-view" style="display: block"><div class="fika-menu-label">Text</div><div class="fika-tab"><div class="fika-tab-item active" style="font-size:12px" data-sel="size-small">small</div><div class="fika-tab-item" style="font-size:14px" data-sel="size-medium">medium</div><div class="fika-tab-item" style="font-size:16px" data-sel="size-large">large</div></div><div class="fika-menu-label mt-3">Alignment</div><div class="fika-tab"><div class="fika-tab-item active" data-sel="align-normal">normal</div><div class="fika-tab-item" data-sel="align-justify">justify</div></div><div class="fika-menu-label mt-3">Font</div><div class="fika-select fika-select-fonts"><div class="fika-select-item font-arial" data-sel="font-arial">Arial</div><div class="fika-select-item font-courier" data-sel="font-courier">Courier</div><div class="fika-select-item font-georgia" data-sel="font-georgia">Georgia</div><div class="fika-select-item font-merriweather active" data-sel="font-merriweather">Merriweather</div><div class="fika-select-item font-openSans" data-sel="font-openSans">Open Sans</div><div class="fika-select-item font-palatino" data-sel="font-palatino">Palatino</div></div></div><!--theme--><div class="fika-menu-view" data-tab="theme"><div class="fika-menu-label">Theme Color</div><div class="fika-select-themes"><div class="fika-select-theme theme-vanilla active" data-sel="theme-vanilla"></div><div class="fika-select-theme theme-latte" data-sel="theme-latte"></div><div class="fika-select-theme theme-blabar" data-sel="theme-blabar"></div><div class="fika-select-theme theme-licorice" data-sel="theme-licorice"></div></div><div class="fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="mt-3 fika-menu-label fika-pro">Background</div><div class="my-2 d-flex fika-justify-space-between"><div class="fika-menu-label"><span class="fika-menu-label-sec">Photo Rotation</span><div class="fika-menu-label-desc">Rotate photo backgrounds everyday</div></div><input type="checkbox" id="fika-photo-bg" disabled=""><label class="fika-toggle" for="fika-photo-bg"></label></div><div class="d-flex fika-align-center mb-1 mt-2"><div class="fika-photo-grid-tab active" data-tab="photo">PHOTO</div><div class="ml-2 fika-photo-grid-tab" data-tab="color">COLOR</div></div><div class="fika-photo-grid" data-tab="photo"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div></div><div class="fika-photo-grid" data-tab="color" style="display: none;"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div><div class="fika-photo-grid-item" data-type="color" data-index="0" data-id="1"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#C3ACEA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="1" data-id="2"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FFC5CC"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="2" data-id="3"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F6D863"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="3" data-id="4"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FCF3CA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="4" data-id="5"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#B9E4C9"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="5" data-id="6"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#90F3E8"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="6" data-id="7"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#8FCAF2"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="7" data-id="8"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#293990"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="8" data-id="9"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#191D2D"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="9" data-id="10"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#111111"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="10" data-id="11"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F5F5F5"></div></div></div></div></div><!--autopilot--><div class="fika-menu-view fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="fika-menu-label mt-1"><div class="fika-pro">Autopilot</div><div class="fika-menu-label-desc">Automatically open Fika reader mode on whitelisted websites</div></div><div class="fika-menu-label d-flex fika-align-center"><svg width="24" height="24" class="fika-icon" style="opacity: 0.7;min-width:24px;" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><div class="ml-1 fika-menu-label-desc" style="margin-top: 0px;">Tip: whitelist current website</div></div><div class="fika-menu-label mt-3">Whitelist</div><div class="fika-select"><input class="fika-input" disabled="" id="fika-autopilot-input" type="url" placeholder="Add new website URL"><div class="fika-autopilot-whitelist"></div></div></div></div></div><!--print--><!--<button class="fika-btn fika-btn-icon" id="fika-print">--><!--<svg class="fika-icon" viewBox="0 0 24 24">--><!--<path d="M19,8H5c-1.7,0-3,1.3-3,3v6h4v4h12v-4h4v-6C22,9.3,20.7,8,19,8z M16,19H8v-5h8V19z M19,12c-0.5,0-1-0.4-1-1s0.5-1,1-1--><!--s1,0.4,1,1S19.5,12,19,12z M18,3H6v4h12V3z"/>--><!--</svg>--><!--</button>--><!--fullscreen--><button class="fika-btn fika-btn-icon" id="fika-fullscreen"><!--exit--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg><!--fs--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg><div class="fika-tooltip">Fullscreen</div></button><!--autopilot--><button class="fika-btn fika-btn-icon fika-pro-item fika-disabled" id="fika-autopilot-local" data-whats-new="autopilot-local"><!--on  .on--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><!--off--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M18 6l-2.91 6.26 5.25 5.25C21.39 15.93 22 14.04 22 12c0-5.52-4.48-10-10-10-2.04 0-3.93.61-5.51 1.66l5.25 5.25L18 6zM2.81 5.64l.85.85c-1.37 2.07-2 4.68-1.48 7.45.75 3.95 3.92 7.13 7.88 7.88 2.77.52 5.38-.1 7.45-1.48l.85.85c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.22 4.22c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.03 0 1.42zm6.1 6.1l3.35 3.35L6 18l2.91-6.26z"></path></svg><div class="fika-tooltip">Autopilot</div></button></div><div class="fika-drawer"><div class="my-2 d-flex fika-align-center fika-justify-space-between"><div class="fika-select-label" style="margin: 8px">Table of content</div><button class="fika-btn fika-btn-icon ml-1 fika-drawer-close"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><div class="fika-drawer-content"><div class="fika-drawer-content-wrap"><!-- ** toc--><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div></div></div><!--overlay--><div class="fika-overlay"></div><!--paper--><div class="fika-main-body"><div class="fika-toc-static fika-toc-static-active"><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div><div class="fika-paper"><div class="fika-article size-small font-merriweather align-normal"><div class="fika-article-domain"><img src="./05. Transaction Processing and Recovery - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><span>learning.oreilly.com</span></div><div class="fika-article-title" id="237.8510044098481">14. Consensus - Database Internals</div><div class="fika-article-divider"></div><div class="fika-content"><div><h2 id="6615.593398842472">Egalitarian Paxos</h2><p>Using a distinguished proposer as a leader makes a system prone to failures: as soon as the leader fails, the system has to elect a new one before it can proceed with further steps. Another problem is that having a leader can put a disproportionate load on it, impairing system performance.</p><div><h6 id="508.40453387557494">Note</h6><p>One of the ways to avoid putting an entire system load on the leader is <em>partitioning</em>. Many systems split the range of possible values into smaller segments and allow a part of the system to be responsible for a specific range without having to worry about the other parts. This helps with availability (by isolating failures to a single partition and preventing propagation to other parts of the system), performance (since segments serving different values are nonoverlapping), and scalability (since we can scale the system by increasing the number of partitions). It is important to keep in mind that performing an operation against <em>multiple</em> partitions will require an atomic commitment.</p></div><p>Instead of using a leader and proposal numbers for sequencing commands, we can use a leader responsible for the commit of the <em>specific</em> command, and establish the order by looking up and setting dependencies. This approach is commonly called Egalitarian Paxos, or EPaxos <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU11" target="_blank">[MORARU11]</a>. The idea of allowing nonconflicting writes to be committed to the replicated state machine independently was first introduced in <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT05" target="_blank">[LAMPORT05]</a> and called Generalized Paxos. EPaxos is a first implementation of Generalized Paxos.</p><p>EPaxos attempts to offer benefits of both the classic Paxos algorithm and Multi-Paxos. Classic Paxos offers high availability, since a leader is established during each round, but has a higher message complexity. Multi-Paxos offers high throughput and requires fewer messages, but a leader may become a bottleneck.</p><p>EPaxos starts with a <em>Pre-Accept</em> phase, during which a process becomes a leader for the specific proposal. Every proposal has to include:</p><dl><dt>Dependencies</dt><dd><p>All commands that potentially interfere with a current proposal, but are not necessarily already committed.</p></dd><dt>A sequence number</dt><dd><p>This breaks cycles between the dependencies. Set it with a value larger than any sequence number of the known dependencies.</p></dd></dl><p>After collecting this information, it forwards a <code>Pre-Accept</code> message to a <em>fast quorum</em> of replicas. A fast quorum is <code>⌈3f/4⌉</code> replicas, where <code>f</code> is the number of tolerated <span>failures.</span></p><p>Replicas check their local command logs, update the proposal dependencies based on their view of potentially conflicting proposals, and send this information back to the leader. If the leader receives responses from a fast quorum of replicas, and their dependency lists are in agreement with each other and the leader itself, it can commit the command.</p><p>If the leader does not receive enough responses or if the command lists received from the replicas differ and contain interfering commands, it updates its proposal with a new dependency list and a sequence number. The new dependency list is based on previous replica responses and combines <em>all</em> collected dependencies. The new sequence number has to be larger than the highest sequence number seen by the replicas. After that, the leader sends the new, updated command to <code>⌊f/2⌋ + 1</code> replicas. After this is done, the leader can finally commit the proposal.</p><p>Effectively, we have two possible scenarios:</p><dl><dt>Fast path</dt><dd><p>When dependencies match and the leader can safely proceed with the commit phase with only a <em>fast quorum</em> of replicas.</p></dd><dt>Slow path</dt><dd><p>When there’s a disagreement between the replicas, and their command lists have to be updated before the leader can proceed with a commit.</p></dd></dl><p><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#epaxos_1" target="_blank">Figure&nbsp;14-8</a> shows these scenarios—<code>P<sub>1</sub></code> initiating a fast path run, and <code>P<sub>5</sub></code> initiating a slow path run:</p><ul><li><p><code>P<sub>1</sub></code> starts with proposal number <code>1</code> and no dependencies, and sends a <code>PreAccept(1, ∅)</code> message. Since the command logs of <code>P<sub>2</sub></code> and <code>P<sub>3</sub></code> are empty, <code>P<sub>1</sub></code> can proceed with a commit.</p></li><li><p><code>P<sub>5</sub></code> creates a proposal with sequence number <code>2</code>. Since its command log is empty by that point, it also declares no dependencies and sends a <code>PreAccept(2, ∅)</code> message. <code>P<sub>4</sub></code> is not aware of the committed proposal <code>1</code>, but <code>P<sub>3</sub></code> notifies <code>P<sub>5</sub></code> about the conflict and sends its command log: <code>{1}</code>.</p></li><li><p><code>P<sub>5</sub></code> updates its local dependency list and sends a message to make sure replicas have the same dependencies: <code>Accept(2,{1})</code>. As soon as the replicas respond, it can commit the value.</p></li></ul><figure><div><img src="./05. Transaction Processing and Recovery - Database Internals_files/dbin_1408.png" alt="dbin 1408" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1408.png" style="display: block; margin: 32px auto;"><h6 id="247.8583250215993"><span>Figure 14-8. </span>EPaxos algorithm run</h6></div></figure><p>Two commands, <code>A</code> and <code>B</code>, interfere only if their execution order matters; in other words, if executing <code>A</code> before <code>B</code> and executing <code>B</code> before <code>A</code> produce different results.</p><p>Commit is done by responding to the client and asynchronously notifying replicas with a <code>Commit</code> message. Commands are executed <em>after</em> they’re committed.</p><p>Since dependencies are collected during the Pre-Accept phase, by the time requests are executed, the command order is already established and no command can suddenly appear somewhere in-between: it can only get appended <em>after</em> the command with the largest sequence number.</p><p>To execute a command, replicas build a dependency graph and execute all commands in a reverse dependency order. In other words, before a command can be executed, all its dependencies (and, subsequently, all their dependencies) have to be executed. Since only interfering commands have to depend on each other, this situation should be relatively rare for most workloads <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU13" target="_blank">[MORARU13]</a>.</p><p>Similar to Paxos, EPaxos uses proposal numbers, which prevent stale messages from being propagated. Sequence numbers consist of an <em>epoch</em> (identifier of the current cluster configuration that changes when nodes leave and join the cluster), a monotonically incremented node-local counter, and a replica ID. If a replica receives a proposal with a sequence number lower than one it has already seen, it negatively acknowledges the proposal, and sends the highest sequence number and an updated command list known to it in response.</p></div></div></div><div class="fika-share"><div class="fika-share-divider"></div><div class="fika-share-buttons"><button id="fika-twitter-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg></button><button id="fika-facebook-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg></button></div></div><div class="fika-feedback my-6"><p id="fika-feedback-msg">Is Fika working properly on this site?</p><div class="my-3"><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress fika-feedback-button" data-match="1"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4.41-6.11c-.35-.22-.82-.11-1.03.24-.74 1.17-2 1.87-3.38 1.87s-2.64-.7-3.38-1.88c-.22-.35-.68-.46-1.03-.24-.35.22-.46.68-.24 1.03C8.37 16.54 10.1 17.5 12 17.5s3.63-.97 4.65-2.58c.22-.35.11-.81-.24-1.03z"></path></svg></button><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress ml-2 fika-feedback-button" data-match="0"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-1.9 0-3.63.97-4.65 2.58-.22.35-.11.81.24 1.03.35.22.81.11 1.03-.24.74-1.18 2-1.88 3.38-1.88s2.64.7 3.38 1.88c.14.23.39.35.64.35.14 0 .27-.04.4-.11.35-.22.46-.68.24-1.03C15.63 14.96 13.9 14 12 14z"></path></svg></button></div></div></div><div class="fika-footer"><a class="fika-footer-logo" href="http://fika.io/" target="_blank"><img style="" src="chrome-extension://fbcdnjeoghampomjjaahjgjghdjdbbcj/images/logo64.png">Made with love by Fika</a><div class="d-flex fika-align-center"><b>Alt+R (Option+R)</b>: to open Fika  <b class="ml-2">Esc</b>: to close reader mode</div></div></div><!--message toast--><div class="fika-toast"><span id="fika-toast-msg"></span><a class="ml-5" id="fika-toast-close">close</a></div><!--background photo--><div class="fika-bg"></div><div class="fika-loading" id="fika-loading-bg" style="display: none;position: fixed;right: 24px;bottom: 24px;"></div><a class="fika-bg-credit" target="_blank"></a></div></div></html>