<!DOCTYPE html>
<!-- saved from url=(0094)https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#consensus -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/database-internals/9781492040330/ch14.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="6145663" data-user-uuid="78724200-da8c-4410-821c-6ec73f6340d0" data-username="iswade" data-account-type="Trial" data-activated-trial-date="12/14/2019" data-archive="9781492040330" data-publishers="O&#39;Reilly Media, Inc." data-htmlfile-name="ch14.html" data-epub-title="Database Internals" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781492040330"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/cool-2.1.15.min.js"></script><script type="text/javascript" src="./14. Consensus - Database Internals_files/510f1a6865"></script><script id="twitter-wjs" src="./14. Consensus - Database Internals_files/widgets.js"></script><script src="./14. Consensus - Database Internals_files/nr-1153.min.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/ec.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/2508.js"></script><script src="./14. Consensus - Database Internals_files/443792972845831" async=""></script><script src="./14. Consensus - Database Internals_files/1732687426968531" async=""></script><script async="" src="./14. Consensus - Database Internals_files/fbevents.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/analytics.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/bat.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/f.txt"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/insight.min.js"></script><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/f.txt"></script><script async="" src="./14. Consensus - Database Internals_files/gtm.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={licenseKey:"510f1a6865",applicationID:"172641827"};window.NREUM||(NREUM={}),__nr_require=function(n,e,t){function r(t){if(!e[t]){var i=e[t]={exports:{}};n[t][0].call(i.exports,function(e){var i=n[t][1][e];return r(i||e)},i,i.exports)}return e[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<t.length;i++)r(t[i]);return r}({1:[function(n,e,t){function r(){}function i(n,e,t){return function(){return o(n,[u.now()].concat(f(arguments)),e?null:this,t),e?void 0:this}}var o=n("handle"),a=n(4),f=n(5),c=n("ee").get("tracer"),u=n("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(n,e){s[e]=i(d+e,!0,"api")}),s.addPageAction=i(d+"addPageAction",!0),s.setCurrentRouteName=i(d+"routeName",!0),e.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(n,e){var t={},r=this,i="function"==typeof e;return o(l+"tracer",[u.now(),n,t],r),function(){if(c.emit((i?"":"no-")+"fn-start",[u.now(),r,i],t),i)try{return e.apply(this,arguments)}catch(n){throw c.emit("fn-err",[arguments,this,n],t),n}finally{c.emit("fn-end",[u.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(n,e){m[e]=i(l+e)}),newrelic.noticeError=function(n,e){"string"==typeof n&&(n=new Error(n)),o("err",[n,u.now(),!1,e])}},{}],2:[function(n,e,t){function r(n,e){var t=n.getEntries();t.forEach(function(n){"first-paint"===n.name?a("timing",["fp",Math.floor(n.startTime)]):"first-contentful-paint"===n.name&&a("timing",["fcp",Math.floor(n.startTime)])})}function i(n){if(n instanceof c&&!s){var e,t=Math.round(n.timeStamp);e=t>1e12?Date.now()-t:f.now()-t,s=!0,a("timing",["fi",t,{type:n.type,fid:e}])}}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var o,a=n("handle"),f=n("loader"),c=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){o=new PerformanceObserver(r);try{o.observe({entryTypes:["paint"]})}catch(u){}}if("addEventListener"in document){var s=!1,p=["click","keydown","mousedown","pointerdown","touchstart"];p.forEach(function(n){document.addEventListener(n,i,!1)})}}},{}],3:[function(n,e,t){function r(n,e){if(!i)return!1;if(n!==i)return!1;if(!e)return!0;if(!o)return!1;for(var t=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var f=navigator.userAgent,c=f.match(a);c&&f.indexOf("Chrome")===-1&&f.indexOf("Chromium")===-1&&(i="Safari",o=c[1])}e.exports={agent:i,version:o,match:r}},{}],4:[function(n,e,t){function r(n,e){var t=[],r="",o=0;for(r in n)i.call(n,r)&&(t[o]=e(r,n[r]),o+=1);return t}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],5:[function(n,e,t){function r(n,e,t){e||(e=0),"undefined"==typeof t&&(t=n?n.length:0);for(var r=-1,i=t-e||0,o=Array(i<0?0:i);++r<i;)o[r]=n[e+r];return o}e.exports=r},{}],6:[function(n,e,t){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(n,e,t){function r(){}function i(n){function e(n){return n&&n instanceof r?n:n?c(n,f,o):o()}function t(t,r,i,o){if(!d.aborted||o){n&&n(t,r,i);for(var a=e(i),f=v(t),c=f.length,u=0;u<c;u++)f[u].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(n,e){h[n]=v(n).concat(e)}function m(n,e){var t=h[n];if(t)for(var r=0;r<t.length;r++)t[r]===e&&t.splice(r,1)}function v(n){return h[n]||[]}function g(n){return p[n]=p[n]||i(t)}function w(n,e){u(n,function(n,t){e=e||"feature",y[t]=e,e in s||(s[e]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:e,buffer:w,abort:a,aborted:!1};return b}function o(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var f="nr@context",c=n("gos"),u=n(4),s={},p={},d=e.exports=i();d.backlog=s},{}],gos:[function(n,e,t){function r(n,e,t){if(i.call(n,e))return n[e];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(n,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return n[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(n,e,t){function r(n,e,t,r){i.buffer([n],r),i.emit(n,e,t)}var i=n("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(n,e,t){function r(n){var e=typeof n;return!n||"object"!==e&&"function"!==e?-1:n===window?0:a(n,o,function(){return i++})}var i=1,o="nr@id",a=n("gos");e.exports=r},{}],loader:[function(n,e,t){function r(){if(!x++){var n=E.info=NREUM.info,e=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(n&&n.licenseKey&&n.applicationID&&e))return s.abort();u(y,function(e,t){n[e]||(n[e]=t)}),c("mark",["onload",a()+E.offset],null,"api");var t=l.createElement("script");t.src="https://"+n.agent,e.parentNode.insertBefore(t,e)}}function i(){"complete"===l.readyState&&o()}function o(){c("mark",["domContent",a()+E.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(f=Math.max((new Date).getTime(),f))-E.offset}var f=(new Date).getTime(),c=n("handle"),u=n(4),s=n("ee"),p=n(3),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1153.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),E=e.exports={offset:f,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};n(1),n(2),l[m]?(l[m]("DOMContentLoaded",o,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",i),d[v]("onload",r)),c("mark",["firstbyte",f],null,"api");var x=0,O=n(6)},{}],"wrap-function":[function(n,e,t){function r(n){return!(n&&n instanceof Function&&n.apply&&!n[a])}var i=n("ee"),o=n(5),a="nr@original",f=Object.prototype.hasOwnProperty,c=!1;e.exports=function(n,e){function t(n,e,t,i){function nrWrapper(){var r,a,f,c;try{a=this,r=o(arguments),f="function"==typeof t?t(r,a):t||{}}catch(u){d([u,"",[r,a,i],f])}s(e+"start",[r,a,i],f);try{return c=n.apply(a,r)}catch(p){throw s(e+"err",[r,a,p],f),p}finally{s(e+"end",[r,a,c],f)}}return r(n)?n:(e||(e=""),nrWrapper[a]=n,p(n,nrWrapper),nrWrapper)}function u(n,e,i,o){i||(i="");var a,f,c,u="-"===i.charAt(0);for(c=0;c<e.length;c++)f=e[c],a=n[f],r(a)||(n[f]=t(a,u?f+i:i,o,f))}function s(t,r,i){if(!c||e){var o=c;c=!0;try{n.emit(t,r,i,e)}catch(a){d([a,t,r,i])}c=o}}function p(n,e){if(Object.defineProperty&&Object.keys)try{var t=Object.keys(n);return t.forEach(function(t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){return n[t]=e,e}})}),e}catch(r){d([r])}for(var i in n)f.call(n,i)&&(e[i]=n[i]);return e}function d(e){try{n.emit("internal-error",e)}catch(t){}}return n||(n=i),t.inPlace=u,t.flag=a,t}},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="./14. Consensus - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./14. Consensus - Database Internals_files/css" rel="stylesheet" type="text/css"><title>14. Consensus - Database Internals</title><link rel="stylesheet" href="./14. Consensus - Database Internals_files/output.8054605313ed.css" type="text/css"><link rel="stylesheet" type="text/css" href="./14. Consensus - Database Internals_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./14. Consensus - Database Internals_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}#sbo-rt-content p[data-type="footnote"] sup{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important}#sbo-rt-content p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}#sbo-rt-content p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}#sbo-rt-content a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content table.border tbody>tr:last-child>td{border-bottom:transparent}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .width-10{width:10vw !important}#sbo-rt-content .width-20{width:20vw !important}#sbo-rt-content .width-30{width:30vw !important}#sbo-rt-content .width-40{width:40vw !important}#sbo-rt-content .width-50{width:50vw !important}#sbo-rt-content .width-60{width:60vw !important}#sbo-rt-content .width-70{width:70vw !important}#sbo-rt-content .width-80{width:80vw !important}#sbo-rt-content .width-90{width:90vw !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100vw !important}#sbo-rt-content .width-10{width:10% !important}#sbo-rt-content .width-20{width:20% !important}#sbo-rt-content .width-30{width:30% !important}#sbo-rt-content .width-40{width:40% !important}#sbo-rt-content .width-50{width:50% !important}#sbo-rt-content .width-60{width:60% !important}#sbo-rt-content .width-70{width:70% !important}#sbo-rt-content .width-75{width:75% !important}#sbo-rt-content .width-80{width:80% !important}#sbo-rt-content .width-90{width:90% !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100% !important}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781492040330/chapter/ch14.html",
          "book_id": "9781492040330",
          "chapter_uri": "ch14.html",
          "position": 0,
          "user_uuid": "78724200-da8c-4410-821c-6ec73f6340d0",
          "next_chapter_uri": "/library/view/database-internals/9781492040330/afterword02.html"
        
      },
      title: "Database Internals",
      author_list: "Alex Petrov",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./14. Consensus - Database Internals_files/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta name="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta property="og:title" content="14. Consensus"><meta itemprop="isPartOf" content="/library/view/database-internals/9781492040330/"><meta itemprop="name" content="14. Consensus"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781492040330/"><meta property="og:description" itemprop="description" content=" Chapter 14. Consensus We’ve discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O&#39;Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781492040347"><meta property="og:book:author" itemprop="author" content="Alex Petrov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '78724200-da8c-4410-821c-6ec73f6340d0';
      dataLayer.push({userIdentifier: '78724200-da8c-4410-821c-6ec73f6340d0'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '274b3493-4443-4dee-a486-ec0579099f2c';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./14. Consensus - Database Internals_files/vendor.b72079115638.js"></script><script defer="" src="./14. Consensus - Database Internals_files/reader.25f0dd727df4.js"></script><script src="./14. Consensus - Database Internals_files/f(1).txt"></script><script src="./14. Consensus - Database Internals_files/f(2).txt"></script><script src="./14. Consensus - Database Internals_files/f(3).txt"></script><script async="" src="./14. Consensus - Database Internals_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/78724200-da8c-4410-821c-6ec73f6340d0/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=collection&amp;sort=date_added&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Expert Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Practice</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/" class="l2 nav-icn"><span>Katacoda Scenarios</span></a></li><li><a href="https://learning.oreilly.com/interactive/#notebooks" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M10.0440191,12.1582649 C10.177209,12.3351976 10.2476998,12.552011 10.2434767,12.7742985 L10.2434767,13.9482829 L1.96869684,13.9482829 L1.96869684,12.7742985 C1.96418597,12.536863 2.04491894,12.3056731 2.19625329,12.1226596 L2.20142503,12.1226596 C3.18373453,10.9898864 4.60930376,10.339179 6.10867266,10.339179 C7.30793519,10.339179 8.45998426,10.7554703 9.37576632,11.5017585 L14.3434936,11.5017585 L14.3434936,3.65650645 L1.65650645,3.65650645 L1.65650645,11.5017585 L2.06682298,11.5017585 L1.82063306,12.1582649 L1.32825322,12.1582649 C1.14771395,12.1582649 1,12.010551 1,11.8300117 L1,3.32825322 C1,3.14771395 1.14771395,3 1.32825322,3 L14.6717468,3 C14.852286,3 15,3.14771395 15,3.32825322 L15,11.8300117 C15,12.010551 14.852286,12.1582649 14.6717468,12.1582649 L10.0440191,12.1582649 Z M12.5483683,7.16419284 C12.6159362,7.20929881 12.6563112,7.2853432 12.6558247,7.36658194 C12.6553382,7.44782068 12.6140555,7.5233761 12.5459522,7.56766966 L10.4270949,8.91581376 C10.3903366,8.94010203 10.3431312,8.9419685 10.3045699,8.9206583 C10.2660086,8.89934811 10.2424712,8.85838696 10.2434767,8.81434055 L10.2434767,5.91510593 C10.2420711,5.86982855 10.2666257,5.82771857 10.3067229,5.80664182 C10.3468202,5.78556507 10.3954292,5.7892172 10.431927,5.81604875 L12.5483683,7.16419284 Z M6.10608679,9.81089299 C4.9635781,9.81089299 4.03739181,8.8847067 4.03739181,7.74219802 C4.03739181,6.59968933 4.9635781,5.67350304 6.10608679,5.67350304 C7.24859547,5.67350304 8.17478176,6.59968933 8.17478176,7.74219802 C8.17478176,8.8847067 7.24859547,9.81089299 6.10608679,9.81089299 Z"></path></svg><span>Sandboxes</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/kubernetes-sandbox/9781492062820/" class="l2 nav-icn"><span>Kubernetes</span></a></li><li><a href="https://learning.oreilly.com/scenarios/python-sandbox/9781492062844/" class="l2 nav-icn"><span>Python</span></a></li><li><a href="https://learning.oreilly.com/scenarios/tensorflow-sandbox/9781492062851/" class="l2 nav-icn"><span>TensorFlow</span></a></li><li><a href="https://learning.oreilly.com/scenarios/ubuntu-sandbox/9781492062837/" class="l2 nav-icn"><span>Ubuntu</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/r/" class="l2 nav-icn"><span>Recommendations</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Release</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Playlists</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M13.4 9.8a.6.6 0 0 1 .6.6v1.2h-1.2l-.6 2.4H3.8l-.6-2.4H2v-1.2a.6.6 0 0 1 .6-.6h10.8zM8 5.6a1.8 1.8 0 1 1-.001-3.599A1.8 1.8 0 0 1 8 5.6zm3.6 2.35v.95H4.4v-.95c0-.167.066-.33.19-.443A5.08 5.08 0 0 1 8 6.2a5.08 5.08 0 0 1 3.41 1.307c.124.113.19.276.19.444z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Training</span></a></li><li><a href="https://www.oreilly.com/conferences/?discount=learn" class="l2 nav-icn" target="&quot;_blank&quot;"><span>Conferences</span></a></li></ul></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Database Internals
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781492040330/chapter/ch14.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./14. Consensus - Database Internals_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html&amp;text=Database%20Internals&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2014.%20Consensus&amp;body=https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html%0D%0Afrom%20Database%20Internals%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
        
        




  <script defer="" src="./14. Consensus - Database Internals_files/djangoMessagesPage.9f800358b9d4.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">13. Distributed Transactions</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/afterword02.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Part II Conclusion</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 14. Consensus"><div class="chapter" id="consensus">
<h1><span class="label">Chapter 14. </span>Consensus</h1>


<p>We’ve<a data-type="indexterm" data-primary="consensus" data-secondary="overview of" id="idm46104529374024"></a> discussed quite a few concepts in distributed systems, starting with basics, such as links and processes, problems with distributed computing; then going through failure models, failure detectors, and leader election; discussed consistency models; and we’re finally ready to put it all together for a pinnacle of distributed systems research: distributed consensus.</p>

<p>Consensus algorithms in distributed systems allow multiple processes to reach an agreement on a value. FLP impossibility (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch08.html#flp_impossibility">“FLP Impossibility”</a>) shows that it is impossible to guarantee consensus in a completely asynchronous system in a bounded time. Even if message delivery is guaranteed, it is impossible for one process to know whether the other one has crashed or is running slowly.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch09.html#failure_detection">Chapter&nbsp;9</a>, we discussed that there’s a trade-off between failure-detection accuracy and how quickly the failure can be detected. Consensus algorithms assume an asynchronous model and guarantee safety, while an external failure detector can provide information about other processes, guaranteeing liveness <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHANDRA96">[CHANDRA96]</a>. Since failure detection is not always fully accurate, there will be situations when a consensus algorithm waits for a process failure to be detected, or when the algorithm is restarted because some process is incorrectly suspected to be faulty.</p>

<p>Processes have to agree on some value proposed by one of the participants, even if some of them happen to crash. A process is said to be <em>correct</em> if hasn’t crashed and continues executing algorithm steps. Consensus is extremely useful for putting events in a particular order, and ensuring consistency among the participants. Using consensus, we can have a system where processes move from one value to the next one without losing certainty about which values the clients observe.</p>

<p class="pagebreak-before">From a theoretical perspective, consensus algorithms have three properties:</p>
<dl>
<dt>Agreement</dt>
<dd>
<p>The decision value is the same for all <em>correct</em> processes.</p>
</dd>
<dt>Validity</dt>
<dd>
<p>The decided value was proposed by one of the processes.</p>
</dd>
<dt>Termination</dt>
<dd>
<p>All <em>correct</em> processes eventually reach the decision.</p>
</dd>
</dl>

<p>Each one of these properties is extremely important. The agreement is embedded in the human understanding of consensus. The <a href="https://databass.dev/links/66">dictionary definition of consensus</a> has the word “unanimity” in it. This means that upon the agreement, no process is allowed to have a different opinion about the outcome. Think of it as an agreement to meet at a particular time and place with your friends: all of you would like to meet, and only the specifics of the event are being agreed upon.</p>

<p>Validity is essential, because without it consensus can be trivial. Consensus algorithms require all processes to agree on some value. If processes use some predetermined, arbitrary default value as a decision output regardless of the proposed values, they will reach unanimity, but the output of such an algorithm will not be valid and it wouldn’t be useful in reality.</p>

<p>Without termination, our algorithm will continue forever without reaching any conclusion or will wait indefinitely for a crashed process to come back, which is not very useful, either. Processes have to agree eventually and, for a consensus algorithm to be practical, this has to happen rather quickly.</p>






<section data-type="sect1" data-pdf-bookmark="Broadcast"><div class="sect1" id="idm46104529354104">
<h1>Broadcast</h1>

<p>A <em>broadcast</em> is<a data-type="indexterm" data-primary="broadcasting" id="idm46104529358568"></a> a communication abstraction often used in distributed systems. Broadcast algorithms are used to disseminate information among a set of processes. There exist many broadcast algorithms, making different assumptions and providing different guarantees. Broadcast is an important primitive and is used in many places, including consensus algorithms. We’ve discussed one of the forms of broadcast—gossip dissemination—already (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch12.html#gossip_dissipation">“Gossip Dissemination”</a>).</p>

<p>Broadcasts are often used for database replication when a single coordinator node has to distribute the data to all other participants. However, making this process reliable is not a trivial matter: if the coordinator crashes after distributing the message to some nodes but not the other ones, it leaves the system in an inconsistent state: some of the nodes observe a new message and some do not.</p>

<p>The<a data-type="indexterm" data-primary="best effort broadcast" id="idm46104529347224"></a> simplest and the most straightforward way to broadcast messages is through a <em>best effort broadcast</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CACHIN11">[CACHIN11]</a>. In this case, the sender is responsible for ensuring message delivery to all the targets. If it fails, the other participants do not try to rebroadcast the message, and in the case of coordinator crash, this type of broadcast will fail silently.</p>

<p>For<a data-type="indexterm" data-primary="reliable broadcasts" id="idm46104529355704"></a> a broadcast to be <em>reliable</em>, it needs to guarantee that all correct processes receive the same messages, even if the sender crashes during transmission.</p>

<p>To implement a naive version of a reliable broadcast, we can use a failure detector and a fallback mechanism. The most straightforward fallback mechanism is to allow every process that received the message to forward it to every other process it’s aware of. When the source process fails, other processes detect the failure and continue broadcasting the message, effectively <em>flooding</em> the network with <code>N<sup>2</sup></code> messages (as shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#broadcast_2">Figure&nbsp;14-1</a>). Even if the sender has crashed, messages still are picked up and delivered by the rest of the system, improving its reliability, and allowing all receivers to see the same messages <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CACHIN11">[CACHIN11]</a>.</p>

<figure><div id="broadcast_2" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1401.png" alt="dbin 1401" width="1200" height="312" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1401.png">
<h6><span class="label">Figure 14-1. </span>Broadcast</h6>
</div></figure>

<p>One of the downsides of this approach is the fact that it uses <code>N<sup>2</sup></code> messages, where <code>N</code> is the number of <em>remaining</em> recipients (since every broadcasting process excludes the original process and itself). Ideally, we’d want to reduce the number of messages required for a reliable broadcast.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Atomic Broadcast"><div class="sect1" id="atomic_broadcast">
<h1>Atomic Broadcast</h1>

<p>Even<a data-type="indexterm" data-primary="atomic broadcast" id="atbroad14"></a><a data-type="indexterm" data-primary="total order multicast" id="idm46104529336472"></a> though the flooding algorithm just described can ensure message delivery, it does not guarantee delivery in any particular order. Messages reach their destination eventually, at an unknown time. If we need to deliver messages in order, we have to use the <em>atomic broadcast</em> (also called the <em>total order multicast</em>), which guarantees both reliable delivery and total order.</p>

<p>While a reliable broadcast ensures that the processes agree on the set of messages delivered, an atomic broadcast also ensures they agree on the same sequence of messages (i.e., message delivery order is the same for every target).</p>

<p>In summary, an atomic broadcast has to ensure two essential properties:</p>
<dl>
<dt>Atomicity</dt>
<dd>
<p>Processes have to agree on the set of received messages. Either all nonfailed processes deliver the message, or none do.</p>
</dd>
<dt>Order</dt>
<dd>
<p>All nonfailed processes deliver the messages in the same order.</p>
</dd>
</dl>

<p>Messages here are delivered <em>atomically</em>: every message is either delivered to all processes or none of them and, if the message is delivered, every other message is ordered before or after this message.</p>








<section data-type="sect2" data-pdf-bookmark="Virtual Synchrony"><div class="sect2" id="idm46104529328696">
<h2>Virtual Synchrony</h2>

<p>One<a data-type="indexterm" data-primary="virtual synchrony" id="idm46104529327320"></a> of the frameworks for group communication using broadcast is called <em>virtual synchrony</em>. An atomic broadcast helps to deliver totally ordered messages to a <em>static</em> group of processes, and virtual synchrony delivers totally ordered messages to a <em>dynamic</em> group of peers.</p>

<p>Virtual synchrony organizes processes into groups. As long as the group exists, messages are delivered to all of its members in the same order. In this case, the order is not specified by the model, and some implementations can take this to their advantage for performance gains, as long as the order they provide is consistent across all members <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BIRMAN10">[BIRMAN10]</a>.</p>

<p>Processes have the same view of the group, and messages are associated with the group identity: processes can see the identical messages only as long as they belong to the same group.</p>

<p>As soon as one of the participants joins, leaves the group, or fails and is forced out of it, the group view changes. This happens by announcing the group change to all its members. Each message is uniquely associated with the group it has originated from.</p>

<p>Virtual synchrony distinguishes between the message <em>receipt</em> (when a group member receives the message) and its <em>delivery</em> (which happens when all the group members receive the message). If the message was <em>sent</em> in one view, it can be <em>delivered</em> only in the same view, which can be determined by comparing the current group with the group the message is associated with. Received messages remain pending in the queue until the process is notified about successful delivery.</p>

<p>Since every message belongs to a specific group, unless all processes in the group have <em>received</em> it before the view change, no group member can consider this message <em>delivered</em>. This implies that all messages are sent and delivered <em>between</em> the view changes, which gives us atomic delivery guarantees. In this case, group views serve as a barrier that message broadcasts cannot pass.</p>

<p>Some total broadcast algorithms order messages by using a single process (sequencer) that is responsible for determining it. Such algorithms can be easier to implement, but rely on detecting the leader failures for liveness. Using a sequencer can improve performance, since we do not need to establish consensus between processes for every message, and can use a sequencer-local view instead. This approach can still scale by partitioning the requests.</p>

<p>Despite its technical soundness, virtual synchrony has not received broad adoption and isn’t commonly used in end-user commercial systems <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BIRMAN06">[BIRMAN06]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Zookeeper Atomic Broadcast (ZAB)"><div class="sect2" id="zab">
<h2>Zookeeper Atomic Broadcast (ZAB)</h2>

<p>One<a data-type="indexterm" data-primary="Zookeeper Atomic Broadcast (ZAB)" id="idm46104529315704"></a><a data-type="indexterm" data-primary="Apache Zookeeper" id="idm46104529312616"></a> of the most popular and widely known implementations of the atomic broadcast is ZAB used by <a href="https://databass.dev/links/67">Apache Zookeeper</a> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HUNT10">[HUNT10]</a> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#JUNQUEIRA11">[JUNQUEIRA11]</a>, a hierarchical distributed key-value store, where it’s used to ensure the total order of events and atomic delivery necessary to maintain consistency between the replica states.</p>

<p>Processes<a data-type="indexterm" data-primary="leaders" id="idm46104529307800"></a><a data-type="indexterm" data-primary="followers" id="idm46104529310872"></a> in ZAB can take on one of two roles: <em>leader</em> and <em>follower</em>. Leader is a temporary role. It drives the process by executing algorithm steps, broadcasts messages to followers, and establishes the event order. To write new records and execute reads that observe the most recent values, clients connect to one of the nodes in the cluster. If the node happens to be a leader, it will handle the request. Otherwise, it forwards the request to the leader.</p>

<p>To guarantee leader uniqueness, the protocol timeline is split into<a data-type="indexterm" data-primary="epochs" id="idm46104529304632"></a> <em>epochs</em>, identified with a unique monotonically- and incrementally-sequenced number. During any epoch, there can be only one leader. The process starts from finding<a data-type="indexterm" data-primary="prospective leaders" id="idm46104529305832"></a> a <em>prospective leader</em> using any election algorithm, as long as it chooses a process that is up with a high probability. Since safety is guaranteed by the further algorithm steps, determining a prospective leader is more of a performance optimization. A prospective leader can also emerge as a consequence of the previous leader’s failure.</p>

<p>As soon as a prospective leader is established, it executes a protocol in three phases:</p>
<dl>
<dt>Discovery</dt>
<dd>
<p>The prospective leader learns about the latest epoch known by every other process, and proposes a new epoch that is <em>greater</em> than the current epoch of any follower. Followers respond to the epoch proposal with the identifier of the latest transaction seen in the previous epoch. After this step, no process will accept broadcast proposals for the earlier epochs.</p>
</dd>
<dt>Synchronization</dt>
<dd>
<p>This phase is used to recover from the previous leader’s failure and bring lagging followers up to speed. The prospective leader sends a message to the followers proposing itself as a leader for the new epoch and collects their acknowledgments. As soon as acknowledgments are received, the leader is established. After this step, followers will not accept attempts to become the epoch leader from any other processes. During synchronization, the new leader ensures that followers have the same history and delivers committed proposals from the established leaders of earlier epochs. These proposals are delivered <em>before</em> any proposal from the new epoch is delivered.</p>
</dd>
<dt>Broadcast</dt>
<dd>
<p>As soon as the followers are back in sync, active messaging starts. During this phase, the leader receives client messages, establishes their order, and broadcasts them to the followers: it sends a new proposal, waits for a quorum of followers to respond with acknowledgments and, finally, commits it. This process is similar to a two-phase commit without aborts: votes are just acknowledgments, and the client cannot vote against a valid leader’s proposal. However, proposals from the leaders from incorrect epochs should <em>not</em> be acknowledged. The broadcast phase continues until the leader crashes, is partitioned from the followers, or is suspected to be crashed due to the message delay.</p>
</dd>
</dl>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#zab_1">Figure&nbsp;14-2</a> shows the three phases of the ZAB algorithm, and messages exchanged during each step.</p>

<figure><div id="zab_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1402.png" alt="dbin 1402" width="1439" height="180" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1402.png">
<h6><span class="label">Figure 14-2. </span>ZAB protocol summary</h6>
</div></figure>

<p>The safety of this protocol is guaranteed if followers ensure they accept proposals only from the leader of the established epoch. Two processes may <em>attempt</em> to get elected, but only one of them can win and establish itself as an epoch leader. It is also assumed that processes perform the prescribed steps in good faith and follow the <span class="keep-together">protocol.</span></p>

<p>Both the leader and followers rely on heartbeats to determine the liveness of the remote processes. If the leader does not receive heartbeats from the quorum of followers, it steps down as a leader, and restarts the election process. Similarly, if one of the followers has determined the leader crashed, it starts a new election process.</p>

<p>Messages are totally ordered, and the leader will not attempt to send the next message until the message that preceded it was acknowledged. Even if some messages are received by a follower more than once, their repeated application do not produce additional side effects, as long as delivery order is followed. ZAB is able to handle multiple outstanding concurrent state changes from clients, since a unique leader will receive write requests, establish the event order, and broadcast the changes.</p>

<p>Total message order also allows ZAB to improve recovery efficiency. During the synchronization phase, followers respond with a highest committed proposal. The leader can simply choose the node with the highest proposal for recovery, and this can be the only node messages have to be copied from.</p>

<p>One of the advantages of ZAB is its efficiency: the broadcast process requires only two rounds of messages, and leader failures can be recovered from by streaming the missing messages from a single up-to-date process. Having a long-lived leader can have a positive impact on performance: we do not require additional consensus rounds to establish a history of events, since the leader can sequence them based on its local view.<a data-type="indexterm" data-primary="" data-startref="atbroad14" id="idm46104529278520"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Paxos"><div class="sect1" id="paxos">
<h1>Paxos</h1>

<p>An<a data-type="indexterm" data-primary="Paxos" data-secondary="overview of" id="idm46104529279992"></a><a data-type="indexterm" data-primary="consensus" data-secondary="Paxos" id="Cpaxos13"></a> atomic broadcast is a problem equivalent to consensus in an asynchronous system with crash failures <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHANDRA96">[CHANDRA96]</a>, since participants have to <em>agree</em> on the message order and must be able to learn about it. You will see many similarities in both motivation and implementation between atomic broadcast and consensus algorithms.</p>

<p>Probably the most widely known consensus algorithm is <em>Paxos</em>. It was first introduced by Leslie Lamport in “The Part-Time Parliament” paper <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT98">[LAMPORT98]</a>. In this paper, consensus is described in terms of terminology inspired by the legislative and voting process on the Aegian island of Paxos. In 2001, the author released a follow-up paper titled “Paxos Made Simple” <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT01">[LAMPORT01]</a> that introduced simpler terms, which are now commonly used to explain this algorithm.</p>

<p>Participants in Paxos can take one of three roles: <em>proposers</em>, <em>acceptors</em>, or <em>learners</em>:</p>
<dl>
<dt>Proposers</dt>
<dd>
<p>Receive values from clients, create proposals to accept these values, and attempt to collect votes from acceptors.</p>
</dd>
<dt>Acceptors</dt>
<dd>
<p>Vote to accept or reject the values proposed by the proposer. For fault tolerance, the algorithm requires the presence of multiple acceptors, but for liveness, only a quorum (majority) of acceptor votes is required to accept the proposal.</p>
</dd>
<dt>Learners</dt>
<dd>
<p>Take the role of replicas, storing the outcomes of the accepted proposals.</p>
</dd>
</dl>

<p>Any participant can take any role, and most implementations colocate them: a single process can simultaneously be a proposer, an acceptor, and a learner.</p>

<p>Every proposal consists of a <em>value</em>, proposed by the client, and a unique monotonically increasing proposal number. This number is then used to ensure a total order of executed operations and establish happened-before/after relationships among them. Proposal numbers are often implemented using an <code>(id, timestamp)</code> pair, where node IDs are also comparable and can be used to break ties for timestamps.</p>








<section data-type="sect2" data-pdf-bookmark="Paxos Algorithm"><div class="sect2" id="idm46104529265720">
<h2>Paxos Algorithm</h2>

<p>The<a data-type="indexterm" data-primary="Paxos" data-secondary="Paxos algorithm" id="idm46104529266872"></a> Paxos algorithm can be generally split into two phases: <em>voting</em> (or <em>propose</em> phase) and <em>replication</em>. During the voting phase, proposers compete to establish their leadership. During replication, the proposer distributes the value to the acceptors.</p>

<p>The proposer is an initial point of contact for the client. It receives a value that should be decided upon, and attempts to collect votes from the quorum of acceptors. When this is done, acceptors distribute the information about the agreed value to the learners, ratifying the result. Learners increase the replication factor of the value that’s been agreed on.</p>

<p>Only one proposer can collect the majority of votes. Under some circumstances, votes may get split evenly between the proposers, and neither one of them will be able to collect a majority during this round, forcing them to restart. We discuss this and other scenarios of competing proposers in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#paxos_failure_scenarios">“Failure Scenarios”</a>.</p>

<p>During<a data-type="indexterm" data-primary="proposers" id="idm46104529255208"></a> the propose phase, the <em>proposer</em> sends a <code>Prepare(n)</code> message (where <code>n</code> is a proposal number) to a majority of acceptors and attempts to collect their votes.</p>

<p>When<a data-type="indexterm" data-primary="acceptors" id="idm46104529259576"></a> the <em>acceptor</em> receives the prepare request, it has to respond, preserving the following invariants <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT01">[LAMPORT01]</a>:</p>

<ul>
<li>
<p>If this acceptor hasn’t responded to a prepare request with a higher sequence number yet, it<a data-type="indexterm" data-primary="promises" id="idm46104529252184"></a> <em>promises</em> that it will not accept any proposal with a lower sequence number.</p>
</li>
<li>
<p>If this acceptor has already accepted (received an <code>Accept!(m,v<sub>accepted</sub>)</code> message) any other proposal earlier, it responds with a <code>Promise(m, v<sub>accepted</sub>)</code> message, notifying the proposer that it has already accepted the proposal with a sequence number <code>m</code>.</p>
</li>
<li>
<p>If this acceptor has already responded to a prepare request with a higher sequence number, it notifies the proposer about the existence of a higher-numbered proposal.</p>
</li>
<li>
<p>Acceptor can respond to more than one prepare request, as long as the later one has a higher sequence number .</p>
</li>
</ul>

<p>During the replication phase, after collecting a majority of votes, the <em>proposer</em> can start the replication, where it commits the proposal by sending acceptors an <code>Accept!(n, v)</code> message with value <code>v</code> and proposal number <code>n</code>. <code>v</code> is the value associated with the highest-numbered proposal among the responses it received from acceptors, or any value of its own if their responses did not contain old accepted proposals.</p>

<p>The <em>acceptor</em> accepts the proposal with a number <code>n</code>, unless during the propose phase it has already responded to <code>Prepare(m)</code>, where <code>m</code> is greater than <code>n</code>. If the acceptor rejects the proposal, it notifies the proposer about it by sending the highest sequence number it has seen along with the request to help the proposer catch up <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT01">[LAMPORT01]</a>.</p>

<p>You can see a generalized depiction of a Paxos round in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#paxos_consensus_1">Figure&nbsp;14-3</a>.</p>

<figure><div id="paxos_consensus_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1403.png" alt="dbin 1403" width="1471" height="391" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1403.png">
<h6><span class="label">Figure 14-3. </span>Paxos algorithm: normal execution</h6>
</div></figure>

<p>Once a consensus was reached on the value (in other words, it was accepted by at least one acceptor), future proposers have to decide on the same value to guarantee the agreement. This is why acceptors respond with the latest value they’ve accepted. If no acceptor has seen a previous value, the proposer is free to choose its own value.</p>

<p>A<a data-type="indexterm" data-primary="learners" id="idm46104529230312"></a><a data-type="indexterm" data-primary="distinguished learners" id="idm46104529235992"></a> learner has to find out the value that has been decided, which it can know after receiving notification from the majority of acceptors. To let the learner know about the new value as soon as possible, acceptors can notify it about the value as soon as they accept it. If there’s more than one learner, each acceptor will have to notify each learner. One or more learners can be <em>distinguished</em>, in which case it will notify other learners about accepted values.</p>

<p>In summary, the goal of the first algorithm phase is to establish a leader for the round and understand which value is going to be accepted, allowing the leader to proceed with the second phase: broadcasting the value. For the purpose of the base algorithm, we assume that we have to perform both phases every time we’d like to decide on a value. In practice, we’d like to reduce the number of steps in the algorithm, so we allow the proposer to propose more than one value. We discuss this in more detail later in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#multi_paxos">“Multi-Paxos”</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Quorums in Paxos"><div class="sect2" id="idm46104529267880">
<h2>Quorums in Paxos</h2>

<p>Quorums<a data-type="indexterm" data-primary="Paxos" data-secondary="quorums in" id="idm46104529228136"></a><a data-type="indexterm" data-primary="quorums" id="idm46104529226872"></a> are used to make sure that <em>some</em> of the participants can fail, but we still can proceed as long as we can collect votes from the alive ones. A <em>quorum</em> is the <em>minimum</em> number of votes required for the operation to be performed. This number usually constitutes a <em>majority</em> of participants. The main idea behind quorums is that even if participants fail or happen to be separated by the network partition, there’s at least one participant that acts as an arbiter, ensuring protocol correctness.</p>

<p>Once a sufficient number of participants accept the proposal, the value is guaranteed to be accepted by the protocol, since any two majorities have at least one participant in common.</p>

<p>Paxos guarantees safety in the presence of any number of failures. There’s no configuration that can produce incorrect or inconsistent states since this would contradict the definition of consensus.</p>

<p>Liveness is guaranteed in the presence of <code>f</code> failed processes. For that, the protocol requires <code>2f + 1</code> processes in total so that, if <code>f</code> processes happen to fail, there are still <span class="keep-together"><code>f + 1</code></span> processes able to proceed. By using quorums, rather than requiring the presence of all processes, Paxos (and other consensus algorithms) guarantee results even when <code>f</code> process failures occur. In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#flexible_paxos">“Flexible Paxos”</a>, we talk about quorums in slightly different terms and describe how to build protocols requiring quorum intersection between algorithm <em>steps</em> only.</p>
<div data-type="tip"><h6>Tip</h6>
<p>It is important to remember that quorums only describe the blocking properties of the system. To guarantee safety, for each step we have to wait for responses from <em>at least</em> a quorum of nodes. We can send proposals and accept commands to more nodes; we just do not have to wait for their responses to proceed. We may send messages to more nodes (some<a data-type="indexterm" data-primary="speculative execution" id="idm46104529215128"></a> systems use <em>speculative execution</em>: issuing redundant queries that help to achieve the required response count in case of node failures), but to guarantee liveness, we can proceed as soon as we hear from the quorum.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Failure Scenarios"><div class="sect2" id="paxos_failure_scenarios">
<h2>Failure Scenarios</h2>

<p>Discussing<a data-type="indexterm" data-primary="Paxos" data-secondary="failure scenarios" id="idm46104529219256"></a><a data-type="indexterm" data-primary="failure scenarios" id="idm46104529212696"></a> distributed algorithms gets particularly interesting when failures are discussed. One of the failure scenarios, demonstrating fault tolerance, is when the proposer fails during the second phase, before it is able to broadcast the value to all the acceptors (a similar situation can happen if the proposer is alive but is slow or cannot communicate with some acceptors). In this case, the new proposer may pick up and commit the value, distributing it to the other participants.</p>

<p class="pagebreak-before"><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#paxos_failure_1">Figure&nbsp;14-4</a> shows this situation:</p>

<ul>
<li>
<p>Proposer <code>P<sub>1</sub></code> goes through the election phase with a proposal number <code>1</code>, but fails after sending the value <code>V1</code> to just one acceptor <code>A<sub>1</sub></code>.</p>
</li>
<li>
<p>Another proposer <code>P<sub>2</sub></code> starts a new round with a higher proposal number <code>2</code>, collects a quorum of acceptor responses (<code>A<sub>1</sub></code> and <code>A<sub>2</sub></code> in this case), and proceeds by committing the <em>old</em> value <code>V1</code>, proposed by <code>P<sub>1</sub></code>.</p>
</li>
</ul>

<figure><div id="paxos_failure_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1404.png" alt="dbin 1404" width="1220" height="291" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1404.png">
<h6><span class="label">Figure 14-4. </span>Paxos failure scenario: proposer failure, deciding on the old value</h6>
</div></figure>

<p>Since the algorithm state is replicated to multiple nodes, proposer failure does not result in failure to reach a consensus. If the current proposer fails after even a single acceptor <code>A<sub>1</sub></code> has accepted the value, its proposal <em>can</em> be picked by the next proposer. This also implies that all of it may happen without the original proposer knowing about it.</p>

<p>In a client/server application, where the client is connected only to the original proposer, this might lead to situations where the client doesn’t know about the result of the Paxos round execution.<sup><a data-type="noteref" id="idm46104529195288-marker" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#idm46104529195288" class="totri-footnote">1</a></sup></p>

<p>However, other scenarios are possible, too, as <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#paxos_failure_2">Figure&nbsp;14-5</a> shows. For example:</p>

<ul>
<li>
<p><code>P<sub>1</sub></code> has failed just like in the previous example, after sending the value <code>V1</code> only to <code>A<sub>1</sub></code>.</p>
</li>
<li>
<p>The next proposer, <code>P<sub>2</sub></code>, starts a new round with a higher proposal number <code>2</code>, and collects a quorum of acceptor responses, but this time <code>A<sub>2</sub></code> and <code>A<sub>3</sub></code> are first to respond. After collecting a quorum, <code>P<sub>2</sub></code> commits <em>its own value</em> despite the fact that theoretically there’s a different committed value on <code>A<sub>1</sub></code>.</p>
</li>
</ul>

<figure><div id="paxos_failure_2" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1405.png" alt="dbin 1405" width="1220" height="291" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1405.png">
<h6><span class="label">Figure 14-5. </span>Paxos failure scenario: proposer failure, deciding on the new value</h6>
</div></figure>

<p>There’s one more possibility here, shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#paxos_failure_3">Figure&nbsp;14-6</a>:</p>

<ul>
<li>
<p>Proposer <code>P<sub>1</sub></code> fails after only one acceptor <code>A<sub>1</sub></code> accepts the value <code>V1</code>. <code>A<sub>1</sub></code> fails shortly after accepting the proposal, before it can notify the next proposer about its value.</p>
</li>
<li>
<p>Proposer <code>P<sub>2</sub></code>, which started the round after <code>P<sub>1</sub></code> failed, does not overlap with <code>A<sub>1</sub></code> and proceeds to commit its value instead.</p>
</li>
<li>
<p>Any proposer that comes <em>after</em> this round that will overlap with <code>A<sub>1</sub></code>, will ignore <code>A<sub>1</sub></code>’s value and choose a more recent accepted proposal instead.</p>
</li>
</ul>

<figure><div id="paxos_failure_3" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1406.png" alt="dbin 1406" width="1348" height="291" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1406.png">
<h6><span class="label">Figure 14-6. </span>Paxos failure scenario: proposer failure, followed by the acceptor failure</h6>
</div></figure>

<p>Another failure scenario is when two or more proposers start competing, each trying to get through the propose phase, but keep failing to collect a majority because the other one beat them to it.</p>

<p>While acceptors promise not to accept any proposals with a lower number, they still may respond to multiple prepare requests, as long as the later one has a higher sequence number. When a proposer tries to commit the value, it might find that acceptors have already responded to a prepare request with a higher sequence number. This may lead to multiple proposers constantly retrying and preventing each other from further progress. This problem is usually solved by incorporating a random backoff, which eventually lets one of the proposers proceed while the other one sleeps.</p>

<p>The Paxos algorithm can tolerate acceptor failures, but only if there are still enough acceptors alive to form a majority.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Multi-Paxos"><div class="sect2" id="multi_paxos">
<h2>Multi-Paxos</h2>

<p>So<a data-type="indexterm" data-primary="Paxos" data-secondary="Multi-Paxos" id="idm46104529166168"></a><a data-type="indexterm" data-primary="Multi-Paxos" id="idm46104529164632"></a> far we discussed the classic Paxos algorithm, where we pick an arbitrary proposer and attempt to start a Paxos round. One of the problems with this approach is that a propose round is required for each replication round that occurs in the system. Only after the proposer is established for the round, which happens after a majority of acceptors respond with a <code>Promise</code> to the proposer’s <code>Prepare</code>, can it start the replication. To avoid repeating the propose phase and let the proposer reuse its recognized position, we can use Multi-Paxos, which introduces the concept<a data-type="indexterm" data-primary="leaders" id="idm46104529159064"></a><a data-type="indexterm" data-primary="distinguished proposers" id="idm46104529162072"></a> of a <em>leader</em>: a <span class="keep-together"><em>distinguished</em></span> <em>proposer</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT01">[LAMPORT01]</a>. This is a crucial addition, significantly improving algorithm efficiency.</p>

<p>Having an established leader, we can skip the propose phase and proceed straight to replication: distributing a value and collecting acceptor acknowledgments.</p>

<p>In the classic Paxos algorithm, reads can be implemented by running a Paxos round that would collect any values from incomplete rounds if they’re present. This has to be done because the last known proposer is not guaranteed to hold the most recent data, since there might have been a different proposer that has modified state without the proposer knowing about it.</p>

<p>A similar situation may occur in Multi-Paxos: we’re trying to perform a read from the known leader <em>after</em> the other leader is already elected, returning stale data, which contradicts the linearizability guarantees of consensus. To avoid that and guarantee that no other process can successfully submit values, some Multi-Paxos implementations<a data-type="indexterm" data-primary="leases" id="idm46104529159832"></a> use <em>leases</em>. The leader periodically contacts the participants, notifying them that it is still alive, effectively prolonging its lease. Participants have to respond and allow the leader to continue operation, promising that they will not accept proposals from other leaders for the period of the lease <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHANDRA07">[CHANDRA07]</a>.</p>

<p>Leases are not a correctness guarantee, but a performance optimization that allows reads from the active leader without collecting a quorum. To guarantee safety, leases rely on the bounded clock synchrony between the participants. If their clocks drift too much and the leader assumes its lease is still valid while other participants think its lease has expired, linearizability <em>cannot</em> be guaranteed.</p>

<p>Multi-Paxos<a data-type="indexterm" data-primary="replicated logs" id="idm46104529149176"></a> is sometimes described as a <em>replicated log</em> of operations applied to some structure. The algorithm is oblivious to the semantics of this structure and is only concerned with consistently replicating values that will be appended to this log. To preserve the state in case of process crashes, participants keep a durable log of received messages.</p>

<p>To prevent a log from growing indefinitely large, its contents should be applied to the aforementioned structure. After the log contents are synchronized with a primary structure, creating a snapshot, the log can be truncated. Log and state snapshots should be mutually consistent, and snapshot changes should be applied atomically with truncation of the log segment <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHANDRA07">[CHANDRA07]</a>.</p>

<p>We<a data-type="indexterm" data-primary="write-once registers" id="idm46104529143608"></a> can think of single-decree Paxos as a <em>write-once register</em>: we have a slot where we can put a value, and as soon as we’ve written the value there, no subsequent modifications are possible. During the first step, proposers compete for ownership of the register, and during the second phase, one of them writes the value. At the same time, Multi-Paxos can be thought of as an append-only log, consisting of a sequence of such values: we can write one value at a time, all values are strictly ordered, and we cannot modify already written values <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RYSTSOV16">[RYSTSOV16]</a>. There are examples of <span class="keep-together">consensus</span> algorithms that offer collections of read-modify-write registers and use state sharing rather than replicated state machines, such as Active Disk Paxos <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CHOCKLER15">[CHOCKLER15]</a> and CASPaxos <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#RYSTSOV18">[RYSTSOV18]</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Fast Paxos"><div class="sect2" id="idm46104529167832">
<h2>Fast Paxos</h2>

<p>We<a data-type="indexterm" data-primary="Paxos" data-secondary="Fast Paxos" id="idm46104529152568"></a><a data-type="indexterm" data-primary="Fast Paxos" id="idm46104529141448"></a> can reduce the number of round-trips by one, compared to the classic Paxos algorithm, by letting <em>any</em> proposer contact acceptors directly rather than going through the leader. For this, we need to increase the quorum size to <code>2f + 1</code> (where <code>f</code> is the number of processes allowed to fail), compared to <code>f + 1</code> in classic Paxos, and a total number of acceptors to <code>3f + 1</code> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#JUNQUEIRA07">[JUNQUEIRA07]</a>. This optimization is called <em>Fast Paxos</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT06">[LAMPORT06]</a>.</p>

<p>The classic Paxos algorithm has a condition, where during the replication phase, the proposer can pick any value it has collected during the propose phase. Fast Paxos has two types of rounds: <em>classic</em>, where the algorithm proceeds the same way as the classic version, and <em>fast</em>, where it allows acceptors to accept other values.</p>

<p>While describing this algorithm, we will refer to the proposer that has collected a sufficient number of responses during the propose phase as a <em>coordinator</em>, and reserve term <em>proposer</em> for all other proposers. Some Fast Paxos descriptions say that <em>clients</em> can contact acceptors directly <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#ZHAO15">[ZHAO15]</a>.</p>

<p>In a fast round, if the coordinator is permitted to pick its own value during the replication phase, it can instead issue a special <code>Any</code> message to acceptors. Acceptors, in this case, are allowed to treat <em>any</em> proposer’s value as if it is a classic round and they received a message with this value from the coordinator. In other words, acceptors independently decide on values they receive from different proposers.</p>

<p class="pagebreak-before"><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#fast_paxos_1">Figure&nbsp;14-7</a> shows an example of classic and fast rounds in Fast Paxos. From the image it might look like the fast round has more execution steps, but keep in mind that in a classic round, in order to submit its value, the proposer would need to go through the coordinator to get its value committed.</p>

<figure><div id="fast_paxos_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1407.png" alt="dbin 1407" width="1176" height="478" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1407.png">
<h6><span class="label">Figure 14-7. </span>Fast Paxos algorithm: fast and classic rounds</h6>
</div></figure>

<p>This<a data-type="indexterm" data-primary="collisions" id="idm46104529122376"></a> algorithm is prone to <em>collisions</em>, which occur if two or more proposers attempt to use the <em>fast</em> step and reduce the number of round-trips, and acceptors receive different values. The coordinator has to intervene and start recovery by initiating a new round.</p>

<p>This means that acceptors, after receiving values from different proposers, may decide on conflicting values. When the coordinator detects a conflict (value collision), it has to reinitiate a <code>Propose</code> phase to let acceptors converge to a single value.</p>

<p>One of the disadvantages of Fast Paxos is the increased number of round-trips and request latency on collisions if the request rate is high. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#JUNQUEIRA07">[JUNQUEIRA07]</a> shows that, due to the increased number of replicas and, subsequently, <em>messages</em> exchanged between the participants, despite a reduced number of steps, Fast Paxos can have higher latencies than its classic counterpart.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Egalitarian Paxos"><div class="sect2" id="idm46104529120408">
<h2>Egalitarian Paxos</h2>

<p>Using<a data-type="indexterm" data-primary="Egalitarian Paxos (EPaxos)" id="idm46104529118296"></a><a data-type="indexterm" data-primary="Paxos" data-secondary="Egalitarian Paxos (EPaxos)" id="idm46104529116360"></a> a distinguished proposer as a leader makes a system prone to failures: as soon as the leader fails, the system has to elect a new one before it can proceed with further steps. Another problem is that having a leader can put a disproportionate load on it, impairing system performance.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>One<a data-type="indexterm" data-primary="partitioning" id="idm46104529114280"></a> of the ways to avoid putting an entire system load on the leader is <em>partitioning</em>. Many systems split the range of possible values into smaller segments and allow a part of the system to be responsible for a specific range without having to worry about the other parts. This helps with availability (by isolating failures to a single partition and preventing propagation to other parts of the system), performance (since segments serving different values are nonoverlapping), and scalability (since we can scale the system by increasing the number of partitions). It is important to keep in mind that performing an operation<a data-type="indexterm" data-primary="multiple partitions" id="idm46104529112728"></a> against <em>multiple</em> partitions will require an atomic commitment.</p>
</div>

<p>Instead of using a leader and proposal numbers for sequencing commands, we can use a leader responsible for the commit of the <em>specific</em> command, and establish the order by looking up and setting dependencies. This approach is commonly called Egalitarian Paxos, or EPaxos <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU11">[MORARU11]</a>. The idea of allowing nonconflicting writes to be committed to the replicated state machine independently was first introduced in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT05">[LAMPORT05]</a> and called Generalized Paxos. EPaxos is a first implementation of Generalized Paxos.</p>

<p>EPaxos attempts to offer benefits of both the classic Paxos algorithm and Multi-Paxos. Classic Paxos offers high availability, since a leader is established during each round, but has a higher message complexity. Multi-Paxos offers high throughput and requires fewer messages, but a leader may become a bottleneck.</p>

<p>EPaxos<a data-type="indexterm" data-primary="Pre-Accept phase" id="idm46104529111400"></a> starts with a <em>Pre-Accept</em> phase, during which a process becomes a leader for the specific proposal. Every proposal has to include:</p>
<dl>
<dt>Dependencies</dt>
<dd>
<p>All commands that potentially interfere with a current proposal, but are not necessarily already committed.</p>
</dd>
<dt>A sequence number</dt>
<dd>
<p>This breaks cycles between the dependencies. Set it with a value larger than any sequence number of the known dependencies.</p>
</dd>
</dl>

<p>After collecting this information, it forwards a <code>Pre-Accept</code> message to a <em>fast quorum</em> of replicas. A fast quorum is <code>⌈3f/4⌉</code> replicas, where <code>f</code> is the number of tolerated <span class="keep-together">failures.</span></p>

<p>Replicas check their local command logs, update the proposal dependencies based on their view of potentially conflicting proposals, and send this information back to the leader. If the leader receives responses from a fast quorum of replicas, and their dependency lists are in agreement with each other and the leader itself, it can commit the command.</p>

<p>If the leader does not receive enough responses or if the command lists received from the replicas differ and contain interfering commands, it updates its proposal with a new dependency list and a sequence number. The new dependency list is based on previous replica responses and combines <em>all</em> collected dependencies. The new sequence number has to be larger than the highest sequence number seen by the replicas. After that, the leader sends the new, updated command to <code>⌊f/2⌋ + 1</code> replicas. After this is done, the leader can finally commit the proposal.</p>

<p>Effectively, we have two possible scenarios:</p>
<dl>
<dt>Fast path</dt>
<dd>
<p>When dependencies match and the leader can safely proceed with the commit phase with only a <em>fast quorum</em> of replicas.</p>
</dd>
<dt>Slow path</dt>
<dd>
<p>When there’s a disagreement between the replicas, and their command lists have to be updated before the leader can proceed with a commit.</p>
</dd>
</dl>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#epaxos_1">Figure&nbsp;14-8</a> shows these scenarios—<code>P<sub>1</sub></code> initiating a fast path run, and <code>P<sub>5</sub></code> initiating a slow path run:</p>

<ul>
<li>
<p><code>P<sub>1</sub></code> starts with proposal number <code>1</code> and no dependencies, and sends a <code>PreAccept(1, ∅)</code> message. Since the command logs of <code>P<sub>2</sub></code> and <code>P<sub>3</sub></code> are empty, <code>P<sub>1</sub></code> can proceed with a commit.</p>
</li>
<li>
<p><code>P<sub>5</sub></code> creates a proposal with sequence number <code>2</code>. Since its command log is empty by that point, it also declares no dependencies and sends a <code>PreAccept(2, ∅)</code> message. <code>P<sub>4</sub></code> is not aware of the committed proposal <code>1</code>, but <code>P<sub>3</sub></code> notifies <code>P<sub>5</sub></code> about the conflict and sends its command log: <code>{1}</code>.</p>
</li>
<li>
<p><code>P<sub>5</sub></code> updates its local dependency list and sends a message to make sure replicas have the same dependencies: <code>Accept(2,{1})</code>. As soon as the replicas respond, it can commit the value.</p>
</li>
</ul>

<figure><div id="epaxos_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1408.png" alt="dbin 1408" width="1328" height="432" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1408.png">
<h6><span class="label">Figure 14-8. </span>EPaxos algorithm run</h6>
</div></figure>

<p>Two commands, <code>A</code> and <code>B</code>, interfere only if their execution order matters; in other words, if executing <code>A</code> before <code>B</code> and executing <code>B</code> before <code>A</code> produce different results.</p>

<p>Commit is done by responding to the client and asynchronously notifying replicas with a <code>Commit</code> message. Commands are executed <em>after</em> they’re committed.</p>

<p>Since dependencies are collected during the Pre-Accept phase, by the time requests are executed, the command order is already established and no command can suddenly appear somewhere in-between: it can only get appended <em>after</em> the command with the largest sequence number.</p>

<p>To execute a command, replicas build a dependency graph and execute all commands in a reverse dependency order. In other words, before a command can be executed, all its dependencies (and, subsequently, all their dependencies) have to be executed. Since only interfering commands have to depend on each other, this situation should be relatively rare for most workloads <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU13">[MORARU13]</a>.</p>

<p>Similar to Paxos, EPaxos uses proposal numbers, which prevent stale messages from being propagated. Sequence numbers consist of an <em>epoch</em> (identifier of the current cluster configuration that changes when nodes leave and join the cluster), a monotonically incremented node-local counter, and a replica ID. If a replica receives a proposal with a sequence number lower than one it has already seen, it negatively acknowledges the proposal, and sends the highest sequence number and an updated command list known to it in response.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Flexible Paxos"><div class="sect2" id="flexible_paxos">
<h2>Flexible Paxos</h2>

<p>A<a data-type="indexterm" data-primary="Paxos" data-secondary="Flexible Paxos" id="idm46104529065016"></a><a data-type="indexterm" data-primary="Flexible Paxos" id="idm46104529059640"></a> quorum is usually defined as a majority of processes. By definition, we have an <em>intersection</em> between two quorums no matter how we pick nodes: there’s always at least one node that can break ties.</p>

<p>We have to answer two important questions:</p>

<ul>
<li>
<p>Is it necessary to contact the <em>majority</em> of servers during <em>every</em> execution step?</p>
</li>
<li>
<p>Do <em>all</em> quorums have to intersect? In other words, does a quorum we use to pick a distinguished proposer (first phase), a quorum we use to decide on a value (second phase), and every execution instance (for example, if multiple instances of the second step are executed concurrently), have to have nodes in common?</p>
</li>
</ul>

<p>Since we’re still talking about consensus, we cannot change any safety definitions: the algorithm has to guarantee the agreement.</p>

<p>In Multi-Paxos, the leader election phase is infrequent, and the distinguished proposer is allowed to commit several values without rerunning the election phase, potentially staying in the lead for a longer period. In <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch11.html#tunable_consistency">“Tunable Consistency”</a>, we discussed formulae that help us to find configurations where we have <span class="keep-together">intersections</span> between the node sets. One of the examples was to wait for just one node to acknowledge the write (and let the requests to the rest of nodes finish asynchronously), and read from <em>all</em> the nodes. In other words, as long as we keep <code>R + W &gt; N</code>, there’s at least one node in common between read and write sets.</p>

<p>Can we use a similar logic for consensus? It turns out that we can, and in Paxos we only require the group of nodes from the first phase (that elects a leader) to overlap with the group from the second phase (that participates in accepting proposals).</p>

<p>In other words, a quorum doesn’t have to be defined as a majority, but only as a non-empty group of nodes. If we define a total number of participants as <code>N</code>, the number of nodes required for a propose phase to succeed as <code>Q₁</code>, and the number of nodes required for the accept phase to succeed as <code>Q₂</code>, we only need to ensure that <code>Q₁ + Q₂ &gt; N</code>. Since the second phase is usually more common than the first one, <code>Q₂</code> can contain only <code>N/2</code> acceptors, as long as <code>Q₁</code> is adjusted to be correspondingly larger (<code>Q₁ = N - Q₂ + 1</code>). This finding is an important observation crucial for understanding consensus. The algorithm that uses this approach is called <em>Flexible Paxos</em> <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD16">[HOWARD16]</a>.</p>

<p>For example, if we have five acceptors, as long as we require collecting votes from four of them to win the election round, we can allow the leader to wait for responses from two nodes during the replication stage. Moreover, since there’s an overlap between <em>any</em> subset consisting of two acceptors with the leader election quorum, we can submit proposals to disjoint sets of acceptors. Intuitively, this works because whenever a new leader is elected without the current one being aware of it, there will always be at least one acceptor that knows about the existence of the new leader.</p>

<p>Flexible Paxos allows trading availability for latency: we reduce the number of nodes participating in the second phase but have to collect more votes, requiring more participants to be available during the leader election phase. The good news is that this configuration can continue the replication phase and tolerate failures of up to <code>N - Q₂</code> nodes, as long as the current leader is stable and a new election round is not required.</p>

<p>Another Paxos variant using the idea of intersecting quorums is Vertical Paxos. Vertical Paxos distinguishes between read and write quorums. These quorums must intersect. A leader has to collect a smaller read quorum for one or more lower-numbered proposals, and a larger write quorum for its own proposal <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT09">[LAMPORT09]</a>. <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPSON01">[LAMPSON01]</a> also distinguishes between the <em>out</em> and <em>decision</em> quorums, which translate to prepare and accept phases, and gives a quorum definition similar to Flexible Paxos.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Generalized Solution to Consensus"><div class="sect2" id="idm46104529066328">
<h2>Generalized Solution to Consensus</h2>

<p>Paxos<a data-type="indexterm" data-primary="Paxos" data-secondary="generalized solution to consensus" id="idm46104529043160"></a> might sometimes be a bit difficult to reason about: multiple roles, steps, and all the possible variations are hard to keep track of. But we can think of it in simpler terms. Instead of splitting roles between the participants and having decision rounds, we can use a simple set of concepts and rules to achieve guarantees of a single-decree Paxos. We discuss this approach only briefly as this is a relatively new development <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD19">[HOWARD19]</a>—it’s important to know, but we’ve yet to see its implementations and practical applications.</p>

<p>We have a client and a set of servers. Each server has multiple <em>registers</em>. A register has an index identifying it, can be written only once, and it can be in one of three states: unwritten, containing a <em>value</em>, and containing <em>nil</em> (a special empty value).</p>

<p>Registers with the same index located on different servers form a <em>register set</em>. Each register set can have one or more quorums. Depending on the state of the registers in it, a quorum can be in one of the <em>undecided</em> (<code>Any</code> and <code>Maybe v</code>), or <em>decided</em> (<code>None</code> and <code>Decided v</code>) states:</p>
<dl>
<dt><code>Any</code></dt>
<dd>
<p>Depending on future operations, this quorum set can decide on any value.</p>
</dd>
<dt><code>Maybe v</code></dt>
<dd>
<p>If this quorum reaches a decision, its decision can only be <code>v</code>.</p>
</dd>
<dt><code>None</code></dt>
<dd>
<p>This quorum cannot decide on the value.</p>
</dd>
<dt><code>Decided v</code></dt>
<dd>
<p>This quorum has decided on the value <code>v</code>.</p>
</dd>
</dl>

<p>The client exchanges messages with the servers and maintains a state table, where it keeps track of values and registers, and can infer decisions made by the quorums.</p>

<p>To maintain correctness, we have to limit how clients can interact with servers and which values they may write and which they may not. In terms of reading values, the client can output the decided value only if it has read it from the quorum of servers in the same register set.</p>

<p>The writing rules are slightly more involved because to guarantee algorithm safety, we have to preserve several invariants. First, we have to make sure that the client doesn’t just come up with new values: it is allowed to write a specific value to the register only if it has received it as input or has read it from a register. Clients cannot write values that allow different quorums in the same register to decide on different values. Lastly, clients cannot write values that override previous decisions made in the previous register sets (decisions made in register sets up to <code>r - 1</code> have to be <code>None</code>, <code>Maybe v</code>, or <code>Decided v</code>).</p>










<section data-type="sect3" data-pdf-bookmark="Generalized Paxos algorithm"><div class="sect3" id="idm46104529020392">
<h3>Generalized Paxos algorithm</h3>

<p>Putting all these rules together, we can implement a generalized Paxos algorithm that achieves consensus over a single value using write-once registers <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD19">[HOWARD19]</a>. Let’s say we have three servers <code>[S0, S1, S2]</code>, registers <code>[R0, R1, …]</code>, and clients <span class="keep-together"><code>[C0, C1, ...]</code>,</span> where the client can only write to the assigned subset of registers. We use simple majority quorums for all registers (<code>{S0, S1}</code>, <code>{S0, S2}</code>, <code>{S1, S2}</code>).</p>

<p>The decision process here consists of two phases. The first phase ensures that it is safe to write a value to the register, and the second phase writes the value to the register:</p>
<dl>
<dt>During phase 1</dt>
<dd>
<p>The client checks if the register it is about to write is unwritten by sending a <code>P1<sub>A</sub>(register)</code> command to the server. If the register is unwritten, all registers up to <code>register - 1</code> are set to <code>nil</code>, which prevents clients from writing to previous registers. The server responds with a set of registers written so far. If it receives responses from the majority of servers, the client chooses either the nonempty value from the register with the largest index or its own value in case no value is present. Otherwise, it restarts the first phase.</p>
</dd>
<dt>During phase 2</dt>
<dd>
<p>The client notifies all servers about the value it has picked during the first phase by sending them <code>P2<sub>A</sub>(register, value)</code>. If the majority of servers respond to this message, it can output the decision value. Otherwise, it starts again from phase 1.</p>
</dd>
</dl>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#generalized_consensus_1">Figure&nbsp;14-9</a> shows this generalization of Paxos (adapted from <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD19">[HOWARD19]</a>). Client <code>C0</code> tries to commit value <code>V</code>. During the first step, its state table is empty, and servers <code>S0</code> and <code>S1</code> respond with the empty register set, indicating that no registers were written so far. During the second step, it can submit its value <code>V</code>, since no other value was <span class="keep-together">written.</span></p>

<figure><div id="generalized_consensus_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1409.png" alt="dbin 1409" width="1104" height="560" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1409.png">
<h6><span class="label">Figure 14-9. </span>Generalization of Paxos</h6>
</div></figure>

<p>At that point, any other client can query servers to find out the current state. Quorum <code>{S0, S1}</code> has reached <code>Decided A</code> state, and quorums <code>{S0, S2}</code> and <code>{S1, S2}</code> have reached the <code>Maybe V</code> state for <code>R0</code>, so <code>C1</code> chooses the value <code>V</code>. At that point, no client can decide on a value other than <code>V</code>.</p>

<p>This approach helps to understand the semantics of Paxos. Instead of thinking about the state from the perspective of interactions of remote actors (e.g., a proposer finding out whether or not an acceptor has already accepted a different proposal), we can think in terms of the last known state, making our decision process simple and removing possible ambiguities. Immutable state and message passing can also be easier to implement correctly.</p>

<p>We can also draw parallels with original Paxos. For example, in a scenario in which the client finds that one of the previous register sets has the <code>Maybe V</code> decision, it picks up <code>V</code> and attempts to commit it again, which is similar to how a proposer in Paxos can propose the value after the failure of the previous proposer that was able to commit the value to at least one acceptor. Similarly, if in Paxos leader conflicts are resolved by restarting the vote with a higher proposal number, in the generalized algorithm any unwritten lower-ranked registers are set to <code>nil</code>.<a data-type="indexterm" data-primary="" data-startref="Cpaxos13" id="idm46104528985288"></a></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Raft"><div class="sect1" id="raft">
<h1>Raft</h1>

<p>Paxos<a data-type="indexterm" data-primary="consensus" data-secondary="Raft" id="Craft14"></a><a data-type="indexterm" data-primary="Raft" data-secondary="overview of" id="idm46104528989240"></a> was <em>the</em> consensus algorithm for over a decade, but in the distributed systems community it’s been known as difficult to reason about. In 2013, a new algorithm called Raft appeared. The researchers who developed it wanted to create an algorithm that’s easy to understand and implement. It was first presented in a paper titled “In Search of an Understandable Consensus Algorithm” <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#ONGARO14">[ONGARO14]</a>.</p>

<p>There’s enough inherent complexity in distributed systems, and having simpler algorithms is very desirable. Along with a paper, the authors have released a reference implementation called <a href="https://databass.dev/links/69">LogCabin</a> to resolve possible ambiguities and help future implementors to gain a better understanding.</p>

<p>Locally, participants store a log containing the sequence of commands executed by the state machine. Since inputs that processes receive are identical and logs contain the same commands in the same order, applying these commands to the state machine guarantees the same output. Raft simplifies consensus by making the concept of leader a first-class citizen. A leader is used to coordinate state machine manipulation and replication. There are many similarities between Raft and atomic broadcast algorithms, as well as Multi-Paxos: a single leader emerges from replicas, makes atomic decisions, and establishes the message order.</p>

<p class="pagebreak-before">Each participant in Raft can take one of three roles:</p>
<dl>
<dt>Candidate</dt>
<dd>
<p>Leadership is a temporary condition, and any participant can take this role. To become a leader, the node first has to transition into a candidate state, and attempt to collect a majority of votes. If a candidate neither wins nor loses the election (the vote is split between multiple candidates and none of them has a majority of votes), the new term is slated and election restarts.</p>
</dd>
<dt>Leader</dt>
<dd>
<p>A current, temporary cluster leader that handles client requests and interacts with a replicated state machine. The leader is elected for a period called a <em>term</em>. Each term is identified by a monotonically increasing number and may continue for an arbitrary time period. A new leader is elected if the current one crashes, becomes unresponsive, or is suspected by other processes to have failed, which can happen because of network partitions and message delays.</p>
</dd>
<dt>Follower</dt>
<dd>
<p>A passive participant that persists log entries and responds to requests from the leader and candidates. Follower in Raft is a role similar to acceptor <em>and</em> learner from Paxos. Every process begins as a follower.</p>
</dd>
</dl>

<p>To guarantee global partial ordering without relying on clock synchronization, time is divided into <em>terms</em> (also called epoch), during which the leader is unique and stable. Terms are monotonically numbered, and each command is uniquely identified by the term number and the message number within the term <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD14">[HOWARD14]</a>.</p>

<p>It may happen that different participants disagree on which term is <em>current</em>, since they can find out about the new term at different times, or could have missed the leader election for one or multiple terms. Since each message contains a term identifier, if one of the participants discovers that its term is out-of-date, it updates the term to the higher-numbered one <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#ONGARO14">[ONGARO14]</a>. This means that there <em>may be</em> several terms in flight at any given point in time, but the higher-numbered one wins in case of a conflict. A node updates the term only if it starts a new election process or finds out that its term is out-of-date.</p>

<p>On startup, or whenever a follower doesn’t receive messages from the leader and suspects that it has crashed, it starts the leader election process. A participant attempts to become a leader by transitioning into the candidate state and collecting votes from the majority of nodes.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#raft_consensus_2">Figure&nbsp;14-10</a> shows a sequence diagram representing the main components of the Raft algorithm:</p>
<dl>
<dt>Leader election</dt>
<dd>
<p>Candidate <code>P1</code> sends a <code>RequestVote</code> message to the other processes. This message includes the candidate’s term, the last term known by it, and the ID of the last log entry it has observed. After collecting a majority of votes, the candidate is <span class="keep-together">successfully</span> elected as a leader for the term. Each process can give its vote to at most one candidate.</p>
</dd>
<dt>Periodic heartbeats</dt>
<dd>
<p>The protocol uses a heartbeat mechanism to ensure the liveness of participants. The leader periodically sends heartbeats to all followers to maintain its term. If a follower doesn’t receive new heartbeats for a period<a data-type="indexterm" data-primary="election timeouts" id="idm46104528959240"></a> called an <em>election timeout</em>, it assumes that the leader has failed and starts a new election.</p>
</dd>
<dt>Log replication / broadcast</dt>
<dd>
<p>The leader can repeatedly append new values to the replicated log by sending <code>AppendEntries</code> messages. The message includes the leader’s term, index, and term of the log entry that immediately precedes the ones it’s currently sending, and <em>one or more</em> entries to store.</p>
</dd>
</dl>

<figure><div id="raft_consensus_2" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1410.png" alt="dbin 1410" width="1440" height="298" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1410.png">
<h6><span class="label">Figure 14-10. </span>Raft consensus algorithm summary</h6>
</div></figure>








<section data-type="sect2" data-pdf-bookmark="Leader Role in Raft"><div class="sect2" id="idm46104528956184">
<h2>Leader Role in Raft</h2>

<p>A<a data-type="indexterm" data-primary="Raft" data-secondary="leader role in" id="idm46104528954440"></a><a data-type="indexterm" data-primary="leader election" data-secondary="in Raft" id="idm46104528953592"></a> leader can be elected only from the nodes holding all committed entries: if during the election, the follower’s log information is more up-to-date (in other words, has a higher term ID, or a longer log entry sequence, if terms are equal) than the candidate’s, its vote is denied.</p>

<p>To win the vote, a candidate has to collect a majority of votes. Entries are always replicated in order, so it is always enough to compare IDs of the latest entries to understand whether or not one of the participants is up-to-date.</p>

<p>Once elected, the leader has to accept client requests (which can also be forwarded to it from other nodes) and replicate them to the followers. This is done by appending the entry to its log and sending it to all the followers in parallel.</p>

<p>When a follower receives an <code>AppendEntries</code> message, it appends the entries from the message to the local log, and acknowledges the message, letting the leader know that it was persisted. As soon as enough replicas send their acknowledgments, the entry is considered committed and is marked correspondingly in the leader log.</p>

<p>Since only the most up-to-date candidates can become a leader, followers never have to bring the leader up-to-date, and log entries are only flowing from leader to follower and not vice versa.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#raft_consensus_1">Figure&nbsp;14-11</a> shows this process:</p>

<ul>
<li>
<p>a) A new command <code>x = 8</code> is appended to the leader’s log.</p>
</li>
<li>
<p>b) Before the value can be committed, it has to be replicated to the majority of participants.</p>
</li>
<li>
<p>c) As soon as the leader is done with replication, it commits the value locally.</p>
</li>
<li>
<p>d) The commit decision is replicated to the followers.</p>
</li>
</ul>

<figure><div id="raft_consensus_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1411.png" alt="dbin 1411" width="1620" height="606" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1411.png">
<h6><span class="label">Figure 14-11. </span>Procedure of a commit in Raft with <code>P<sub>1</sub></code> as a leader</h6>
</div></figure>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#raft_consensus_3">Figure&nbsp;14-12</a> shows an example of a consensus round where <code>P₁</code> is a leader, which has the most recent view of the events. The leader proceeds by replicating the entries to the followers, and committing them after collecting acknowledgments. Committing an entry also commits all entries preceding it in the log. Only the leader can make a decision on whether or not the entry can be committed. Each log entry is marked with a term ID (a number in the top-right corner of each log entry box) and a log index, identifying its position in the log. Committed entries are guaranteed to be replicated to the quorum of participants and are safe to be applied to the state machine in the order they appear in the log.</p>

<figure class="width-50"><div id="raft_consensus_3" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1412.png" alt="dbin 1412" width="804" height="709" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1412.png">
<h6><span class="label">Figure 14-12. </span>Raft state machine</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Failure Scenarios"><div class="sect2" id="idm46104528955304">
<h2>Failure Scenarios</h2>

<p>When<a data-type="indexterm" data-primary="Raft" data-secondary="failure scenarios" id="idm46104528935128"></a><a data-type="indexterm" data-primary="failure scenarios" id="idm46104528934248"></a> multiple followers decide to become candidates, and no candidate can collect a majority of votes, the situation is<a data-type="indexterm" data-primary="split vote" id="idm46104528933544"></a> called a <em>split vote</em>. Raft uses randomized timers to reduce the probability of multiple subsequent elections ending up in a split vote. One of the candidates can start the next election round earlier and collect enough votes, while the others sleep and give way to it. This approach speeds up the election without requiring any additional coordination between candidates.</p>

<p>Followers may be down or slow to respond, and the leader has to make the best effort to ensure message delivery. It can try sending messages again if it doesn’t receive an acknowledgment within the expected time bounds. As a performance optimization, it can send multiple messages in parallel.</p>

<p>Since entries replicated by the leader are uniquely identified, repeated message delivery is guaranteed not to break the log order. Followers deduplicate messages using their sequence IDs, ensuring that double delivery has no undesired side effects.</p>

<p>Sequence IDs are also used to ensure the log ordering. A follower rejects a higher-numbered entry if the ID and term of the entry that immediately precedes it, sent by the leader, do not match the highest entry according to its own records. If entries in two logs on different replicas have the same term and the same index, they store the same command and all entries that precede them are the same.</p>

<p>Raft guarantees to never show an uncommitted message as a committed one, but, due to network or replica slowness, already committed messages can still be seen as <em>in progress</em>, which is a rather harmless property and can be worked around by retrying a client command until it is finally committed <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#HOWARD14">[HOWARD14]</a>.</p>

<p>For failure detection, the leader has to send heartbeats to the followers. This way, the leader maintains its term. When one of the nodes notices that the current leader is down, it attempts to initiate the election. The newly elected leader has to restore the state of the cluster to the last known up-to-date log entry. It<a data-type="indexterm" data-primary="common ground" id="idm46104528926008"></a> does so by finding a <em>common ground</em> (the highest log entry on which both the leader and follower agree), and ordering followers to <em>discard</em> all (uncommitted) entries appended after this point. It then sends the most recent entries from its log, overwriting the followers’ history. The leader’s own log records are never removed or overwritten: it can only append entries to its own log.</p>

<p>Summing up, the Raft algorithm provides the following guarantees:</p>

<ul>
<li>
<p>Only one leader can be elected at a time for a given term; no two leaders can be active during the same term.</p>
</li>
<li>
<p>The leader does not remove or reorder its log contents; it only appends new messages to it.</p>
</li>
<li>
<p>Committed log entries are guaranteed to be present in logs for subsequent leaders and cannot get reverted, since before the entry is committed it is known to be replicated by the leader.</p>
</li>
<li>
<p>All messages are identified uniquely by the message and term IDs; neither current nor subsequent leaders can reuse the same identifier for the different entry.</p>
</li>
</ul>

<p>Since its appearance, Raft has become very popular and is currently used in many databases and other distributed systems, including <a href="https://databass.dev/links/70">CockroachDB</a>, <a href="https://databass.dev/links/71">Etcd</a>, and <a href="https://databass.dev/links/72">Consul</a>. This can be attributed to its simplicity, but also may mean that Raft lives up to the promise of being a reliable consensus algorithm.<a data-type="indexterm" data-primary="" data-startref="Craft14" id="idm46104528917432"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Byzantine Consensus"><div class="sect1" id="idm46104528992840">
<h1>Byzantine Consensus</h1>

<p>All<a data-type="indexterm" data-primary="consensus" data-secondary="Byzantine consensus" id="Cbyz14"></a><a data-type="indexterm" data-primary="Byzantine consensus" id="Bcon14"></a> the consensus algorithms we have been discussing so far assume non-Byzantine failures (see <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch08.html#byzantine_faults">“Arbitrary Faults”</a>). In other words, nodes execute the algorithm in “good faith” and do not try to exploit it or forge the results.</p>

<p>As we will see, this assumption allows achieving consensus with a smaller number of available participants and with fewer round-trips required for a commit. However, distributed systems are sometimes deployed in potentially adversarial environments, where the nodes are not controlled by the same entity, and we need algorithms that can ensure a system can function correctly even if some nodes behave erratically or even maliciously. Besides ill intentions, Byzantine failures can also be caused by bugs, misconfiguration, hardware issues, or data corruption.</p>

<p>Most Byzantine consensus algorithms require <code>N<sup>2</sup></code> messages to complete an algorithm step, where <code>N</code> is the size of the quorum, since each node in the quorum has to communicate with each other. This is required to cross-validate each step against other nodes, since nodes cannot rely on each other or on the leader and have to verify other nodes’ behaviors by comparing returned results with the majority responses.</p>

<p>We’ll only discuss one Byzantine consensus algorithm here, <a data-type="indexterm" data-primary="Practical Byzantine Fault Tolerance (PBFT)" id="idm46104528902600"></a>Practical Byzantine Fault Tolerance (PBFT) <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#CASTRO99">[CASTRO99]</a>. PBFT assumes independent node failures (i.e., failures can be coordinated, but the entire system cannot be taken over at once, or at least with the same exploit method). The system makes weak synchrony assumptions, like how you would expect a network to behave normally: failures may occur, but they are not indefinite and are eventually recovered from.</p>

<p>All communication between the nodes is encrypted, which serves to prevent message forging and network attacks. Replicas know one another’s public keys to verify identities and encrypt messages. Faulty nodes may leak information from inside the system, since, even though encryption is used, every node needs to interpret message contents to react upon them. This doesn’t undermine the algorithm, since it serves a different purpose.</p>








<section data-type="sect2" data-pdf-bookmark="PBFT Algorithm"><div class="sect2" id="idm46104528903160">
<h2>PBFT Algorithm</h2>

<p>For PBFT to guarantee both safety and liveness, no more than <code>(n - 1)/3</code> replicas can be faulty (where <code>n</code> is the total number of participants). For a system to sustain <code>f</code> compromised nodes, it is required to have at least <code>n = 3f + 1</code> nodes. This is the case because a majority of nodes have to agree on the value: <code>f</code> replicas might be faulty, and there might be <code>f</code> replicas that are not responding but may not be faulty (for example, due to a network partition, power failure, or maintenance). The algorithm has to be able to collect enough responses from nonfaulty replicas to <em>still</em> outnumber those from the faulty ones.</p>

<p>Consensus properties for PBFT are similar to those of other consensus algorithms: all nonfaulty replicas have to agree both on the set of received values and their order, despite the possible failures.</p>

<p>To distinguish between cluster configurations, PBFT uses <em>views</em>. In each view, one of the replicas is a <em>primary</em> and the rest of them are considered <em>backups</em>. All nodes are numbered consecutively, and the index of the primary node is <code>v mod N</code>, where <code>v</code> is the view ID, and <code>N</code> is the number of nodes in the current configuration. The view can change in cases when the primary fails. Clients execute their operations against the primary. The primary broadcasts the requests to the backups, which execute the requests and send a response back to the client. The client waits for <code>f + 1</code> replicas to respond with <em>the same result</em> for any operation to succeed.</p>

<p>After the primary receives a client request, protocol execution proceeds in three <span class="keep-together">phases:</span></p>
<dl>
<dt>Pre-prepare</dt>
<dd>
<p>The primary broadcasts a message containing a view ID, a unique monotonically increasing identifier, a payload (client request), and a payload digest. Digests are computed using a strong collision-resistant hash function, and are signed by the sender. The backup accepts the message if its view matches with the primary view and the client request hasn’t been tampered with: the calculated payload digest matches the received one.</p>
</dd>
<dt>Prepare</dt>
<dd>
<p>If the backup accepts the pre-prepare message, it enters the prepare phase and starts broadcasting <code>Prepare</code> messages, containing a view ID, message ID, and a payload digest, but without the payload itself, to all other replicas (including the primary). Replicas can move past the prepare state only if they receive <code>2f</code> prepares from <em>different</em> backups that match the message received during pre-prepare: they have to have the same view, same ID, and a digest.</p>
</dd>
<dt>Commit</dt>
<dd>
<p>After that, the backup moves to the commit phase, where it broadcasts <code>Commit</code> messages to all other replicas and waits to collect <code>2f + 1</code> matching <code>Commit</code> messages (possibly including its own) from the other participants.</p>
</dd>
</dl>

<p>A <em>digest</em> in this case is used to reduce the message size during the prepare phase, since it’s not necessary to rebroadcast an entire payload for verification, as the digest serves as a payload summary. Cryptographic hash functions are resistant to collisions: it is difficult to produce two values that have the same digest, let alone two messages with matching digests that <em>make sense</em> in the context of the system. In addition, digests are <em>signed</em> to make sure that the digest itself is coming from a trusted source.</p>

<p>The number <code>2f</code> is important, since the algorithm has to make sure that at least <code>f + 1</code> nonfaulty replicas respond to the client.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#pbft_consensus_1">Figure&nbsp;14-13</a> shows a sequence diagram of a normal-case PBFT algorithm round: the client sends a request to <code>P<sub>1</sub></code>, and nodes move between phases by collecting a sufficient number of matching responses from <em>properly behaving</em> peers. <code>P<sub>4</sub></code> may have failed or could’ve responded with unmatching messages, so its responses wouldn’t have been counted.</p>

<figure><div id="pbft_consensus_1" class="figure">
<img src="./14. Consensus - Database Internals_files/dbin_1413.png" alt="dbin 1413" width="1248" height="390" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1413.png">
<h6><span class="label">Figure 14-13. </span>PBFT consensus, normal-case operation</h6>
</div></figure>

<p>During the prepare and commit phases, nodes communicate by sending messages to each other node and waiting for the messages from the corresponding number of other nodes, to check if they match and make sure that incorrect messages are not broadcasted. Peers cross-validate all messages so that only nonfaulty nodes can successfully commit messages. If a sufficient number of matching messages cannot be collected, the node doesn’t move to the next step.</p>

<p>When replicas collect enough commit messages, they notify the client, finishing the round. The client cannot be certain about whether or not execution was fulfilled correctly until it receives <code>f + 1</code> matching responses.</p>

<p>View changes occur when replicas notice that the primary is inactive, and suspect that it might have failed. Nodes that detect a primary failure stop responding to further messages (apart from checkpoint and view-change related ones), broadcast a view change notification, and wait for confirmations. When the primary of the new view receives <code>2f</code> view change events, it initiates a new view.</p>

<p>To reduce the number of messages in the protocol, clients can collect <code>2f + 1</code> matching responses from nodes that <em>tentatively</em> execute a request (e.g., after they’ve collected a sufficient number of matching <code>Prepared</code> messages). If the client cannot collect enough matching tentative responses, it retries and waits for <code>f + 1</code> nontentative responses as described previously.</p>

<p>Read-only operations in PBFT can be done in just one round-trip. The client sends a read request to all replicas. Replicas execute the request in their tentative states, after all ongoing state changes to the read value are committed, and respond to the client. After collecting <code>2f + 1</code> responses with the same value from different replicas, the operation completes.</p>
</div></section>













<section data-type="sect2" class="less_space pagebreak-before" data-pdf-bookmark="Recovery and Checkpointing"><div class="sect2" id="idm46104528870424">
<h2>Recovery and Checkpointing</h2>

<p>Replicas<a data-type="indexterm" data-primary="recovery" data-secondary="Byzantine consensus" id="idm46104528869656"></a><a data-type="indexterm" data-primary="checkpointing" id="idm46104528868920"></a> save accepted messages in a stable log. Every message has to be kept until it has been executed by at least <code>f + 1</code> nodes. This log can be used to get other replicas up to speed in case of a network partition, but recovering replicas need some means of verifying that the state they receive is correct, since otherwise recovery can be used as an attack vector.</p>

<p>To show that the state is correct, nodes compute a digest of the state for messages up to a given sequence number. Nodes can compare digests, verify state integrity, and make sure that messages they received during recovery add up to a correct final state. This process is too expensive to perform on every request.</p>

<p>After<a data-type="indexterm" data-primary="stable checkpoints" id="idm46104528864648"></a> every <code>N</code> requests, where <code>N</code> is a configurable constant, the primary makes a <em>stable checkpoint</em>, where it broadcasts the latest sequence number of the latest request whose execution is reflected in the state, and the digest of this state. It then waits for <code>2f + 1</code> replicas to respond. These responses constitute a proof for this checkpoint, and a guarantee that replicas can safely discard state for all pre-prepare, prepare, commit, and checkpoint messages up to the given sequence number.</p>

<p>Byzantine fault tolerance is essential to understand and is used in storage systems deployed in potentially adversarial networks. Most of the time, it is enough to authenticate and encrypt internode communication, but when there’s no trust between the parts of the system, algorithms similar to PBFT have to be employed.</p>

<p>Since algorithms resistant to Byzantine faults impose significant overhead in terms of the number of exchanged messages, it is important to understand their use cases. Other protocols, such as the ones described in <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BAUDET19">[BAUDET19]</a> and <a data-type="xref" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#BUCHMAN18">[BUCHMAN18]</a>, attempt to optimize the PBFT algorithm for systems with a large number of <span class="keep-together">participants.</span><a data-type="indexterm" data-primary="" data-startref="Cbyz14" id="idm46104528855336"></a><a data-type="indexterm" data-primary="" data-startref="Bcon14" id="idm46104528856536"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm46104528861384">
<h1>Summary</h1>

<p>Consensus algorithms are one of the most interesting yet most complex subjects in distributed systems. Over the last few years, new algorithms and many implementations of the existing algorithms have emerged, which proves the rising importance and popularity of the subject.</p>

<p>In this chapter, we discussed the classic Paxos algorithm, and several variants of Paxos, each one improving its different properties:</p>
<dl>
<dt>Multi-Paxos</dt>
<dd>
<p>Allows a proposer to retain its role and replicate multiple values instead of just one.</p>
</dd>
<dt>Fast Paxos</dt>
<dd>
<p>Allows us to reduce a number of messages by using <em>fast</em> rounds, when acceptors can proceed with messages from proposers other than the established leader.</p>
</dd>
<dt>EPaxos</dt>
<dd>
<p>Establishes event order by resolving dependencies between submitted messages.</p>
</dd>
<dt>Flexible Paxos</dt>
<dd>
<p>Relaxes quorum requirements and only requires a quorum for the first phase (voting) to intersect with a quorum for the second phase (replication).</p>
</dd>
</dl>

<p>Raft simplifies the terms in which consensus is described, and makes leadership a first-class citizen in the algorithm. Raft separates log replication, leader election, and safety.</p>

<p>To guarantee consensus safety in adversarial environments, Byzantine fault-tolerant algorithms should be used; for example, PBFT. In PBFT, participants cross-validate one another’s responses and only proceed with execution steps when there’s enough nodes that obey the prescribed algorithm rules.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46104528841944">
<h5>Further Reading</h5>
<p>If you’d like to learn more about the concepts mentioned in this chapter, you can refer to the following sources:</p>
<dl>
<dt>Atomic broadcast</dt>
<dd>
<p>Junqueira, Flavio P., Benjamin C. Reed, and Marco Serafini. “Zab: High-performance broadcast for primary-backup systems.” 2011. In <em>Proceedings of the 2011 IEEE/IFIP 41st International Conference on Dependable Systems &amp; Networks (DSN ’11)</em>: 245-256.</p>

<p>Hunt, Patrick, Mahadev Konar, Flavio P. Junqueira, and Benjamin Reed. 2010. “ZooKeeper: wait-free coordination for internet-scale systems.” In <em>Proceedings of the 2010 USENIX conference on USENIX annual technical conference (USENIXATC’10)</em>: 11.</p>

<p>Oki, Brian M., and Barbara H. Liskov. 1988. “Viewstamped Replication: A New Primary Copy Method to Support Highly-Available Distributed Systems.” In <em>Proceedings of the seventh annual ACM Symposium on Principles of distributed computing (PODC ’88)</em>: 8-17.</p>

<p>Van Renesse, Robbert,  Nicolas Schiper, and Fred B. Schneider. 2014. “Vive la Différence: Paxos vs. Viewstamped Replication vs. Zab.”</p>
</dd>
<dt>Classic Paxos</dt>
<dd>
<p>Lamport, Leslie. 1998. “The part-time parliament.” <em>ACM Transactions on Computer Systems</em> 16, no. 2 (May): 133-169.</p>

<p>Lamport, Leslie. 2001. “Paxos made simple.” ACM SIGACT News 32, no. 4: 51-58.</p>

<p>Lamport, Leslie. 2005. “Generalized Consensus and Paxos.” Technical Report MSR-TR-2005-33. Microsoft Research, Mountain View, CA.</p>

<p>Primi, Marco. 2009. “Paxos made code: Implementing a high throughput Atomic Broadcast.” (Libpaxos code: <a href="https://bitbucket.org/sciascid/libpaxos/src/master/"><em class="hyperlink">https://bitbucket.org/sciascid/libpaxos/src/master/</em></a>.</p>
</dd>
<dt>Fast Paxos</dt>
<dd>
<p>Lamport, Leslie. 2005. “Fast Paxos.” 14 July 2005. Microsoft Research.</p>
</dd>
<dt>Multi-Paxos</dt>
<dd>
<p>Chandra, Tushar D., Robert Griesemer, and Joshua Redstone. 2007. “Paxos made live: an engineering perspective.” In <em>Proceedings of the twenty-sixth annual ACM symposium on Principles of distributed computing (PODC ’07)</em>: 398-407.</p>

<p>Van Renesse, Robbert and Deniz Altinbuken. 2015. “Paxos Made Moderately Complex.” <em>ACM Computing Surveys</em> 47, no. 3 (February): Article 42. <em><a href="https://doi.org/10.1145/2673577"><em class="hyperlink">https://doi.org/10.1145/2673577</em></a></em>.</p>
</dd>
<dt>EPaxos</dt>
<dd>

<p>Moraru, Iulian, David G. Andersen, and Michael Kaminsky. 2013. “There is more consensus in Egalitarian parliaments.” In <em>Proceedings of the Twenty-Fourth ACM Symposium on Operating Systems Principles (SOSP ’13)</em>: 358-372.</p>

<p>Moraru, I., D. G. Andersen, and M. Kaminsky. 2013. “A proof of correctness for Egalitarian Paxos.” Technical report, Parallel Data Laboratory, Carnegie Mellon University, Aug. 2013.</p>
</dd>
<dt>Raft</dt>
<dd>
<p>Ongaro, Diego, and John Ousterhout. 2014. “In search of an understandable consensus algorithm.” In <em>Proceedings of the 2014 USENIX conference on USENIX Annual Technical Conference (USENIX ATC’14)</em>, Garth Gibson and Nickolai Zeldovich (Eds.): 305-320.</p>

<p>Howard, H. 2014. “ARC: Analysis of Raft Consensus.” Technical Report UCAM-CL-TR-857, University of Cambridge, Computer Laboratory, July 2014.</p>

<p>Howard, Heidi, Malte Schwarzkopf, Anil Madhavapeddy, and Jon Crowcroft. 2015. “Raft Refloated: Do We Have Consensus?” <em>SIGOPS Operating Systems Review</em> 49, no. 1 (January): 12-21. <em><a href="https://doi.org/10.1145/2723872.2723876"><em class="hyperlink">https://doi.org/10.1145/2723872.2723876</em></a></em>.</p>
</dd>
<dt>Recent developments</dt>
<dd>
<p>Howard, Heidi and Richard Mortier. 2019. “A Generalised Solution to Distributed Consensus.” 18 Feb 2019.</p>
</dd>
</dl>
</div></aside>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm46104529195288"><sup><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#idm46104529195288-marker" class="totri-footnote">1</a></sup> For example, such a situation was described in <a href="https://databass.dev/links/68"><em class="hyperlink">https://databass.dev/links/68</em></a>.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch13.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">13. Distributed Transactions</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/afterword02.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Part II Conclusion</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  function decodeHtml(html) {
    var txt = document.createElement("textarea");
    txt.innerHTML = html;
    return txt.value;
  }

  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Database Internals',
      type: 'book',
      identifier: '9781492040330',
      topic: 'Data Warehousing, '
    },
    content: {
      title: 'Database Internals',
      formatType: 'book',
      identifier: '9781492040330',
      author: 'Alex Petrov',
      publisher: decodeHtml('O&#39;Reilly Media, Inc.'),
      releaseDate: '2019-10-08',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          

          
            <p>You have 6 days left in your trial, Iswade. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          
        
        

      </div>

    
    



        
      </div>
      
        


<footer class="pagefoot t-pagefoot" style="padding-bottom: 75px;">
  <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2019 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"queueTime":3,"applicationTime":407,"errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","agent":"","licenseKey":"510f1a6865","applicationID":"172641827,79672898,93931619"}</script>

      
    
    <script src="./14. Consensus - Database Internals_files/saved_resource" charset="utf-8"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./14. Consensus - Database Internals_files/embed.js"></script>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("set","agent","tmgoogletagmanager","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>

<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>
<script type="text/javascript" id="">window._pp=window._pp||[];if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/register/")_pp.targetUrl="/confirm/trial";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/subscribe/")_pp.targetUrl="/confirm/paid";else if("\/library\/view\/database-internals\/9781492040330\/ch14.html"=="/confirmation/nnv/"&&"https:\/\/learning.oreilly.com\/library\/view\/database-internals\/9781492040330\/"=="https://learning.oreilly.com/signup/")_pp.targetUrl="/confirm/paid";_pp.siteId="2508";
_pp.siteUId="78724200-da8c-4410-821c-6ec73f6340d0";_pp.orderValue="undefined";_pp.orderId="undefined";(function(){var ppjs=document.createElement("script");ppjs.type="text/javascript";ppjs.async=true;ppjs.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.pbbl.co/r/"+_pp.siteId+".js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ppjs,s)})();</script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.8761141995538091"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.039377343765153894" width="0" height="0" alt="" src="./14. Consensus - Database Internals_files/0"></div>
    <script src="./14. Consensus - Database Internals_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 201.001px; left: 1557.4px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./14. Consensus - Database Internals_files/generic1576598380235.js" charset="UTF-8"></script><div style="display: none; visibility: hidden;"><script>(function(){if(null!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')&&void 0!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')){var a=!1;window.addEventListener("blur",function(){a&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"facebook",eventVal:0,nonInteraction:0})});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseover",function(){window.focus();
a=!0});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseout",function(){a=!1})}try{window.twttr=function(b,a,d){var c,e=b.getElementsByTagName(a)[0];if(!b.getElementById(d))return b=b.createElement(a),b.id=d,b.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(b,e),window.twttr||(c={_e:[],ready:function(a){c._e.push(a)}})}(document,"script","twitter-wjs"),twttr.ready(function(a){a.events.bind("tweet",trackTwitter)})}catch(b){}})();
null!==document.querySelector(".IN-widget")&&void 0!==document.querySelector(".IN-widget")&&document.querySelector(".IN-widget").addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"linkedin",eventVal:0,nonInteraction:0})});
function trackTwitter(a){a&&(a.target&&"IFRAME"==a.target.nodeName&&(opt_target=extractParamFromUri(a.target.src,"url")),dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0}))}function extractParamFromUri(a,b){if(a){var c=new RegExp("[\\?\x26#]"+b+"\x3d([^\x26#]*)");c=c.exec(a);if(null!=c)return unescape(c[1])}};</script></div><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./14. Consensus - Database Internals_files/widget_iframe.69e02060c7c44baddf1b5629549acc0c.html" title="Twitter settings iframe" style="display: none;"></iframe></body><div class="fika-reader-mode" id="fika-reader" style="display: none;"><div id="fika" class="fika-app theme-vanilla"><!--drawer--><div class="fika-tool"><!--open--><button class="fika-btn fika-btn-icon mr-1" id="fika-tool-btn" data-whats-new="menu"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg></button><!--toc--><button class="fika-btn fika-btn-icon" id="fika-toc-btn"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M4 13c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1zm-3 5c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 4c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-8c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm4 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zm0 4h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1s.45 1 1 1zM7 8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1z"></path></svg><div class="fika-tooltip">TOC</div></button><button class="fika-btn fika-btn-icon" id="fika-settings" data-whats-new="settings"><svg class="fika-icon" width="20px" height="20px" viewBox="0 0 20 20"><path d="M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z"></path></svg><div class="fika-tooltip">Settings</div></button><!--appearance settings--><div class="fika-menu"><div class="fika-menu-nav d-flex flex-column"><div class="fika-menu-nav-item active">Text</div><div class="fika-menu-nav-item">Theme</div><div class="fika-menu-nav-item fika-pro">Autopilot</div><div class="flex-fill"></div><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="fb" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://www.facebook.com/dialog/feed?app_id=393950891439557&amp;display=popup&amp;link=https://chrome.google.com/webstore/detail/fika-reader-mode/fbcdnjeoghampomjjaahjgjghdjdbbcj" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Share to Facebook</a><a class="fika-menu-nav-item small flex-y-center fika-share-fika" data-type="tw" style="display:none;margin-bottom: -6px;margin-left: -4px" href="https://twitter.com/intent/retweet?tweet_id=1117715831540965376" target="_blank"><svg class="fika-icon" height="20px" width="20px" viewBox="0 0 32 32"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Share to Twitter</a><a class="fika-menu-nav-item small mb-1" href="http://fika.io/updatelog" target="_blank">What's new</a><div class="fika-menu-nav-item static small" style="font-size: 12px;line-height: 16px;" id="fika-beta-info"><div class="fika-pro" style=" margin-left: -4px;"></div>Login and share Fika to gain BETA access.</div><!--<a class="fika-menu-nav-item small" href="http://fika.io/pro" target="_blank">Upgrade to Pro</a>--><div class="fika-menu-login"><div id="fika-login" class="px-2"><div class="mb-1">Log in</div><div>with Google account</div></div><div class="fika-loading" id="fika-loading-login" style="display: none;position: absolute;right: 16px;bottom: 24px;"></div></div></div><div class="fika-menu-view-cont"><!--text--><div class="fika-menu-view" style="display: block"><div class="fika-menu-label">Text</div><div class="fika-tab"><div class="fika-tab-item active" style="font-size:12px" data-sel="size-small">small</div><div class="fika-tab-item" style="font-size:14px" data-sel="size-medium">medium</div><div class="fika-tab-item" style="font-size:16px" data-sel="size-large">large</div></div><div class="fika-menu-label mt-3">Alignment</div><div class="fika-tab"><div class="fika-tab-item active" data-sel="align-normal">normal</div><div class="fika-tab-item" data-sel="align-justify">justify</div></div><div class="fika-menu-label mt-3">Font</div><div class="fika-select fika-select-fonts"><div class="fika-select-item font-arial" data-sel="font-arial">Arial</div><div class="fika-select-item font-courier" data-sel="font-courier">Courier</div><div class="fika-select-item font-georgia" data-sel="font-georgia">Georgia</div><div class="fika-select-item font-merriweather active" data-sel="font-merriweather">Merriweather</div><div class="fika-select-item font-openSans" data-sel="font-openSans">Open Sans</div><div class="fika-select-item font-palatino" data-sel="font-palatino">Palatino</div></div></div><!--theme--><div class="fika-menu-view" data-tab="theme"><div class="fika-menu-label">Theme Color</div><div class="fika-select-themes"><div class="fika-select-theme theme-vanilla active" data-sel="theme-vanilla"></div><div class="fika-select-theme theme-latte" data-sel="theme-latte"></div><div class="fika-select-theme theme-blabar" data-sel="theme-blabar"></div><div class="fika-select-theme theme-licorice" data-sel="theme-licorice"></div></div><div class="fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="mt-3 fika-menu-label fika-pro">Background</div><div class="my-2 d-flex fika-justify-space-between"><div class="fika-menu-label"><span class="fika-menu-label-sec">Photo Rotation</span><div class="fika-menu-label-desc">Rotate photo backgrounds everyday</div></div><input type="checkbox" id="fika-photo-bg" disabled=""><label class="fika-toggle" for="fika-photo-bg"></label></div><div class="d-flex fika-align-center mb-1 mt-2"><div class="fika-photo-grid-tab active" data-tab="photo">PHOTO</div><div class="ml-2 fika-photo-grid-tab" data-tab="color">COLOR</div></div><div class="fika-photo-grid" data-tab="photo"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div></div><div class="fika-photo-grid" data-tab="color" style="display: none;"><div class="fika-photo-grid-item fika-photo-grid-default" data-type="default"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill">Default</div></div><div class="fika-photo-grid-item" data-type="color" data-index="0" data-id="1"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#C3ACEA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="1" data-id="2"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FFC5CC"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="2" data-id="3"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F6D863"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="3" data-id="4"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#FCF3CA"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="4" data-id="5"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#B9E4C9"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="5" data-id="6"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#90F3E8"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="6" data-id="7"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#8FCAF2"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="7" data-id="8"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#293990"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="8" data-id="9"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#191D2D"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="9" data-id="10"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#111111"></div></div><div class="fika-photo-grid-item" data-type="color" data-index="10" data-id="11"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><div class="fill" style="background-color:#F5F5F5"></div></div></div></div></div><!--autopilot--><div class="fika-menu-view fika-pro-item has-unlock-btn fika-disabled"><div class="fika-share-to-unlock"><div style="font-weight: bold">Login &amp; Share to Unlock</div><div class="mt-2"><button class="fika-btn fika-share-to-unlock-btn" data-type="fb" style="background: #3A5CA9"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg>Facebook</button><button class="ml-2 fika-btn fika-share-to-unlock-btn" data-type="tw" style="background: #1A97F0"><svg height="20px" width="20px" viewBox="0 0 32 32" fill="#fff"><path class="st0" d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg>Twitter</button></div></div><div class="fika-menu-label mt-1"><div class="fika-pro">Autopilot</div><div class="fika-menu-label-desc">Automatically open Fika reader mode on whitelisted websites</div></div><div class="fika-menu-label d-flex fika-align-center"><svg width="24" height="24" class="fika-icon" style="opacity: 0.7;min-width:24px;" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><div class="ml-1 fika-menu-label-desc" style="margin-top: 0px;">Tip: whitelist current website</div></div><div class="fika-menu-label mt-3">Whitelist</div><div class="fika-select"><input class="fika-input" disabled="" id="fika-autopilot-input" type="url" placeholder="Add new website URL"><div class="fika-autopilot-whitelist"></div></div></div></div></div><!--print--><!--<button class="fika-btn fika-btn-icon" id="fika-print">--><!--<svg class="fika-icon" viewBox="0 0 24 24">--><!--<path d="M19,8H5c-1.7,0-3,1.3-3,3v6h4v4h12v-4h4v-6C22,9.3,20.7,8,19,8z M16,19H8v-5h8V19z M19,12c-0.5,0-1-0.4-1-1s0.5-1,1-1--><!--s1,0.4,1,1S19.5,12,19,12z M18,3H6v4h12V3z"/>--><!--</svg>--><!--</button>--><!--fullscreen--><button class="fika-btn fika-btn-icon" id="fika-fullscreen"><!--exit--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg><!--fs--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg><div class="fika-tooltip">Fullscreen</div></button><!--autopilot--><button class="fika-btn fika-btn-icon fika-pro-item fika-disabled" id="fika-autopilot-local" data-whats-new="autopilot-local"><!--on  .on--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></svg><!--off--><svg class="fika-icon" viewBox="0 0 24 24"><path d="M18 6l-2.91 6.26 5.25 5.25C21.39 15.93 22 14.04 22 12c0-5.52-4.48-10-10-10-2.04 0-3.93.61-5.51 1.66l5.25 5.25L18 6zM2.81 5.64l.85.85c-1.37 2.07-2 4.68-1.48 7.45.75 3.95 3.92 7.13 7.88 7.88 2.77.52 5.38-.1 7.45-1.48l.85.85c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.22 4.22c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.03 0 1.42zm6.1 6.1l3.35 3.35L6 18l2.91-6.26z"></path></svg><div class="fika-tooltip">Autopilot</div></button></div><div class="fika-drawer"><div class="my-2 d-flex fika-align-center fika-justify-space-between"><div class="fika-select-label" style="margin: 8px">Table of content</div><button class="fika-btn fika-btn-icon ml-1 fika-drawer-close"><svg class="fika-icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></div><div class="fika-drawer-content"><div class="fika-drawer-content-wrap"><!-- ** toc--><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div></div></div><!--overlay--><div class="fika-overlay"></div><!--paper--><div class="fika-main-body"><div class="fika-toc-static fika-toc-static-active"><div class="fika-toc"><a data-id="#237.8510044098481" class="fika-toc-h1">14. Consensus - Database Internals</a><a data-id="#6615.593398842472" class="fika-toc-h2">Egalitarian Paxos</a><a data-id="#508.40453387557494" class="fika-toc-h6">Note</a><a data-id="#247.8583250215993" class="fika-toc-h6">Figure 14-8. EPaxos algorithm run</a></div></div><div class="fika-paper"><div class="fika-article size-small font-merriweather align-normal"><div class="fika-article-domain"><img src="./14. Consensus - Database Internals_files/apple-touch-icon.0c29511d2d72.png"><span>learning.oreilly.com</span></div><div class="fika-article-title" id="237.8510044098481">14. Consensus - Database Internals</div><div class="fika-article-divider"></div><div class="fika-content"><div><h2 id="6615.593398842472">Egalitarian Paxos</h2><p>Using a distinguished proposer as a leader makes a system prone to failures: as soon as the leader fails, the system has to elect a new one before it can proceed with further steps. Another problem is that having a leader can put a disproportionate load on it, impairing system performance.</p><div><h6 id="508.40453387557494">Note</h6><p>One of the ways to avoid putting an entire system load on the leader is <em>partitioning</em>. Many systems split the range of possible values into smaller segments and allow a part of the system to be responsible for a specific range without having to worry about the other parts. This helps with availability (by isolating failures to a single partition and preventing propagation to other parts of the system), performance (since segments serving different values are nonoverlapping), and scalability (since we can scale the system by increasing the number of partitions). It is important to keep in mind that performing an operation against <em>multiple</em> partitions will require an atomic commitment.</p></div><p>Instead of using a leader and proposal numbers for sequencing commands, we can use a leader responsible for the commit of the <em>specific</em> command, and establish the order by looking up and setting dependencies. This approach is commonly called Egalitarian Paxos, or EPaxos <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU11" target="_blank">[MORARU11]</a>. The idea of allowing nonconflicting writes to be committed to the replicated state machine independently was first introduced in <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#LAMPORT05" target="_blank">[LAMPORT05]</a> and called Generalized Paxos. EPaxos is a first implementation of Generalized Paxos.</p><p>EPaxos attempts to offer benefits of both the classic Paxos algorithm and Multi-Paxos. Classic Paxos offers high availability, since a leader is established during each round, but has a higher message complexity. Multi-Paxos offers high throughput and requires fewer messages, but a leader may become a bottleneck.</p><p>EPaxos starts with a <em>Pre-Accept</em> phase, during which a process becomes a leader for the specific proposal. Every proposal has to include:</p><dl><dt>Dependencies</dt><dd><p>All commands that potentially interfere with a current proposal, but are not necessarily already committed.</p></dd><dt>A sequence number</dt><dd><p>This breaks cycles between the dependencies. Set it with a value larger than any sequence number of the known dependencies.</p></dd></dl><p>After collecting this information, it forwards a <code>Pre-Accept</code> message to a <em>fast quorum</em> of replicas. A fast quorum is <code>⌈3f/4⌉</code> replicas, where <code>f</code> is the number of tolerated <span>failures.</span></p><p>Replicas check their local command logs, update the proposal dependencies based on their view of potentially conflicting proposals, and send this information back to the leader. If the leader receives responses from a fast quorum of replicas, and their dependency lists are in agreement with each other and the leader itself, it can commit the command.</p><p>If the leader does not receive enough responses or if the command lists received from the replicas differ and contain interfering commands, it updates its proposal with a new dependency list and a sequence number. The new dependency list is based on previous replica responses and combines <em>all</em> collected dependencies. The new sequence number has to be larger than the highest sequence number seen by the replicas. After that, the leader sends the new, updated command to <code>⌊f/2⌋ + 1</code> replicas. After this is done, the leader can finally commit the proposal.</p><p>Effectively, we have two possible scenarios:</p><dl><dt>Fast path</dt><dd><p>When dependencies match and the leader can safely proceed with the commit phase with only a <em>fast quorum</em> of replicas.</p></dd><dt>Slow path</dt><dd><p>When there’s a disagreement between the replicas, and their command lists have to be updated before the leader can proceed with a commit.</p></dd></dl><p><a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/ch14.html#epaxos_1" target="_blank">Figure&nbsp;14-8</a> shows these scenarios—<code>P<sub>1</sub></code> initiating a fast path run, and <code>P<sub>5</sub></code> initiating a slow path run:</p><ul><li><p><code>P<sub>1</sub></code> starts with proposal number <code>1</code> and no dependencies, and sends a <code>PreAccept(1, ∅)</code> message. Since the command logs of <code>P<sub>2</sub></code> and <code>P<sub>3</sub></code> are empty, <code>P<sub>1</sub></code> can proceed with a commit.</p></li><li><p><code>P<sub>5</sub></code> creates a proposal with sequence number <code>2</code>. Since its command log is empty by that point, it also declares no dependencies and sends a <code>PreAccept(2, ∅)</code> message. <code>P<sub>4</sub></code> is not aware of the committed proposal <code>1</code>, but <code>P<sub>3</sub></code> notifies <code>P<sub>5</sub></code> about the conflict and sends its command log: <code>{1}</code>.</p></li><li><p><code>P<sub>5</sub></code> updates its local dependency list and sends a message to make sure replicas have the same dependencies: <code>Accept(2,{1})</code>. As soon as the replicas respond, it can commit the value.</p></li></ul><figure><div><img src="./14. Consensus - Database Internals_files/dbin_1408.png" alt="dbin 1408" data-mfp-src="/library/view/database-internals/9781492040330/assets/dbin_1408.png" style="display: block; margin: 32px auto;"><h6 id="247.8583250215993"><span>Figure 14-8. </span>EPaxos algorithm run</h6></div></figure><p>Two commands, <code>A</code> and <code>B</code>, interfere only if their execution order matters; in other words, if executing <code>A</code> before <code>B</code> and executing <code>B</code> before <code>A</code> produce different results.</p><p>Commit is done by responding to the client and asynchronously notifying replicas with a <code>Commit</code> message. Commands are executed <em>after</em> they’re committed.</p><p>Since dependencies are collected during the Pre-Accept phase, by the time requests are executed, the command order is already established and no command can suddenly appear somewhere in-between: it can only get appended <em>after</em> the command with the largest sequence number.</p><p>To execute a command, replicas build a dependency graph and execute all commands in a reverse dependency order. In other words, before a command can be executed, all its dependencies (and, subsequently, all their dependencies) have to be executed. Since only interfering commands have to depend on each other, this situation should be relatively rare for most workloads <a href="https://learning.oreilly.com/library/view/database-internals/9781492040330/app01.html#MORARU13" target="_blank">[MORARU13]</a>.</p><p>Similar to Paxos, EPaxos uses proposal numbers, which prevent stale messages from being propagated. Sequence numbers consist of an <em>epoch</em> (identifier of the current cluster configuration that changes when nodes leave and join the cluster), a monotonically incremented node-local counter, and a replica ID. If a replica receives a proposal with a sequence number lower than one it has already seen, it negatively acknowledges the proposal, and sends the highest sequence number and an updated command list known to it in response.</p></div></div></div><div class="fika-share"><div class="fika-share-divider"></div><div class="fika-share-buttons"><button id="fika-twitter-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M23.9,11.9c0,0.2,0,0.3,0,0.5c0,5.3-4.1,11.4-11.4,11.4c-2.2,0-4.4-0.7-6.2-1.8c0.3,0.1,0.7,0.1,1,0.1c1.9,0,3.7-0.7,5-1.7c-1.7,0-3.3-1.2-3.8-2.8c0.2,0.1,0.5,0.1,0.7,0.1c0.4,0,0.7,0,1.1-0.1c-1.9-0.4-3.3-2-3.3-3.9v-0.1c0.5,0.3,1.1,0.5,1.8,0.5c-1.1-0.7-1.8-2-1.8-3.3c0-0.7,0.2-1.4,0.6-2c2,2.4,4.9,4,8.4,4.1c0-0.3-0.1-0.6-0.1-0.9c0-2.2,1.8-4,4-4C21,8,22,8.5,22.8,9.3c0.9-0.2,1.7-0.5,2.5-1c-0.3,0.9-1,1.7-1.8,2.2c0.8,0,1.5-0.2,2.3-0.6C25.2,10.8,24.6,11.4,23.9,11.9z"></path></svg></button><button id="fika-facebook-share" class="fika-btn fika-btn-icon"><svg class="fika-icon fika-icon-large" viewBox="0 0 32 32"><path d="M21.2,9.2h-2c-1.5,0-1.9,0.8-1.9,1.8v2.5h3.8l-0.8,3.7h-3l0.1,8.9h-3.7v-8.8h-3v-3.8h3v-3c0-3.1,2-4.6,4.7-4.6C19.9,5.9,21,6,21.2,6V9.2z"></path></svg></button></div></div><div class="fika-feedback my-6"><p id="fika-feedback-msg">Is Fika working properly on this site?</p><div class="my-3"><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress fika-feedback-button" data-match="1"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4.41-6.11c-.35-.22-.82-.11-1.03.24-.74 1.17-2 1.87-3.38 1.87s-2.64-.7-3.38-1.88c-.22-.35-.68-.46-1.03-.24-.35.22-.46.68-.24 1.03C8.37 16.54 10.1 17.5 12 17.5s3.63-.97 4.65-2.58c.22-.35.11-.81-.24-1.03z"></path></svg></button><button class="fika-btn fika-btn-icon fika-btn-large fika-btn-depress ml-2 fika-feedback-button" data-match="0"><svg class="fika-icon fika-icon-large" viewBox="0 0 24 24"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-1.9 0-3.63.97-4.65 2.58-.22.35-.11.81.24 1.03.35.22.81.11 1.03-.24.74-1.18 2-1.88 3.38-1.88s2.64.7 3.38 1.88c.14.23.39.35.64.35.14 0 .27-.04.4-.11.35-.22.46-.68.24-1.03C15.63 14.96 13.9 14 12 14z"></path></svg></button></div></div></div><div class="fika-footer"><a class="fika-footer-logo" href="http://fika.io/" target="_blank"><img style="" src="chrome-extension://fbcdnjeoghampomjjaahjgjghdjdbbcj/images/logo64.png">Made with love by Fika</a><div class="d-flex fika-align-center"><b>Alt+R (Option+R)</b>: to open Fika  <b class="ml-2">Esc</b>: to close reader mode</div></div></div><!--message toast--><div class="fika-toast"><span id="fika-toast-msg"></span><a class="ml-5" id="fika-toast-close">close</a></div><!--background photo--><div class="fika-bg"></div><div class="fika-loading" id="fika-loading-bg" style="display: none;position: fixed;right: 24px;bottom: 24px;"></div><a class="fika-bg-credit" target="_blank"></a></div></div></html>