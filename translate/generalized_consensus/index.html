<!doctype html><html lang="zh" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><link rel="canonical" href="https://iswade.github.io/translate/generalized_consensus/"><meta name="lang:clipboard.copy" content="复制"><meta name="lang:clipboard.copied" content="已复制"><meta name="lang:search.language" content="ja"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="没有找到符合条件的结果"><meta name="lang:search.result.one" content="找到 1 个符合条件的结果"><meta name="lang:search.result.other" content="# 个符合条件的结果"><meta name="lang:search.tokenizer" content="[\uff0c\u3002]+"><link rel="shortcut icon" href="../../themes/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>广义分布式共识 - Blog</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content=""><script src="../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../themes/extra.css"></head><body dir="ltr" data-md-color-primary="white" data-md-color-accent="blue"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#_1" tabindex="1" class="md-skip">跳转至 </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://iswade.github.io/" title="Blog" class="md-header-nav__button md-logo"><img src="../../themes/me.jpg" width="24" height="24"></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Blog</span><span class="md-header-nav__topic">广义分布式共识</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">键入以开始搜索</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://iswade.github.io/" title="Blog" class="md-nav__button md-logo"><img src="../../themes/me.jpg" width="48" height="48"></a>Blog</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../.." title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Databases</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Databases</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../articles/pebble/" title="Pebble KV存储引擎" class="md-nav__link">Pebble KV存储引擎</a></li><li class="md-nav__item"><a href="../faunadb_transaction/" title="FaunaDB的分布式事务协议" class="md-nav__link">FaunaDB的分布式事务协议</a></li><li class="md-nav__item"><a href="../Aurora_design_cloud_native_database/" title="Aurora云原生关系数据库" class="md-nav__link">Aurora云原生关系数据库</a></li><li class="md-nav__item"><a href="../btree_vs_lsmtree/" title="现代存储系统背后的算法" class="md-nav__link">现代存储系统背后的算法</a></li><li class="md-nav__item"><a href="../../notes/db_nodes/00_database_systems_2018/" title="数据库笔记" class="md-nav__link">数据库笔记</a></li><li class="md-nav__item"><a href="../F1_query/" title="F1 Query" class="md-nav__link">F1 Query</a></li><li class="md-nav__item"><a href="../../articles/boltdb/" title="Bolt 数据库" class="md-nav__link">Bolt 数据库</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Distributed</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Distributed</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../distsys/" title="分布式系统大纲" class="md-nav__link">分布式系统大纲</a></li><li class="md-nav__item"><a href="../../database/replication/" title="分布式系统之复制" class="md-nav__link">分布式系统之复制</a></li><li class="md-nav__item"><a href="../../articles/partition/" title="分布式系统之数据分区" class="md-nav__link">分布式系统之数据分区</a></li><li class="md-nav__item"><a href="../../database/db_internals_ch09_failure_detection/" title="分布式系统之故障检测" class="md-nav__link">分布式系统之故障检测</a></li><li class="md-nav__item"><a href="../../database/db_internals_ch14_consensus/" title="分布式系统之共识" class="md-nav__link">分布式系统之共识</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6"><label class="md-nav__link" for="nav-3-6">分布式系统算法方法</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-6">分布式系统算法方法</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../distributed_systems/00_preface/" title="前 言" class="md-nav__link">前 言</a></li><li class="md-nav__item"><a href="../../distributed_systems/01_introduction/" title="第一章 概述" class="md-nav__link">第一章 概述</a></li><li class="md-nav__item"><a href="../../distributed_systems/02_interprocess/" title="第二章 进程间通信" class="md-nav__link">第二章 进程间通信</a></li><li class="md-nav__item"><a href="../../distributed_systems/03_models/" title="第三章 通信模型" class="md-nav__link">第三章 通信模型</a></li></ul></nav></li><li class="md-nav__item"><a href="../strong_consistency_models/" title="强一致性模型" class="md-nav__link">强一致性模型</a></li><li class="md-nav__item"><a href="../zookeeper/" title="Zookeeper论文翻译" class="md-nav__link">Zookeeper论文翻译</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Language</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Language</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../articles/go_concurrency/" title="Go 并发编程" class="md-nav__link">Go 并发编程</a></li><li class="md-nav__item"><a href="../go_interface/" title="如何使用 Go 接口" class="md-nav__link">如何使用 Go 接口</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5"><label class="md-nav__link" for="nav-5">Engineering</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Engineering</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../advanced_markdown/" title="高级markdown" class="md-nav__link">高级markdown</a></li><li class="md-nav__item"><a href="../linux_sysadmin/" title="linux 系统管理" class="md-nav__link">linux 系统管理</a></li><li class="md-nav__item"><a href="../../notes/git/" title="git 入门教程" class="md-nav__link">git 入门教程</a></li><li class="md-nav__item"><a href="../to_be_manager/" title="How to be a manager" class="md-nav__link">How to be a manager</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">目录</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#1" title="1. 简介" class="md-nav__link">1. 简介</a></li><li class="md-nav__item"><a href="#2" title="2. 问题定义" class="md-nav__link">2. 问题定义</a></li><li class="md-nav__item"><a href="#3" title="3. 通用方法" class="md-nav__link">3. 通用方法</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#31" title="3.1 正确性" class="md-nav__link">3.1 正确性</a></li><li class="md-nav__item"><a href="#32" title="3.2 实现正确性规则" class="md-nav__link">3.2 实现正确性规则</a></li><li class="md-nav__item"><a href="#33" title="3.3 示例" class="md-nav__link">3.3 示例</a></li></ul></nav></li><li class="md-nav__item"><a href="#4-paxos" title="4. Paxos 的一般化" class="md-nav__link">4. Paxos 的一般化</a></li><li class="md-nav__item"><a href="#5-fast-paxos" title="5. Fast Paxos 的一般化" class="md-nav__link">5. Fast Paxos 的一般化</a></li><li class="md-nav__item"><a href="#6" title="6. 示例一致性算法" class="md-nav__link">6. 示例一致性算法</a></li><li class="md-nav__item"><a href="#7" title="7. 结论" class="md-nav__link">7. 结论</a></li><li class="md-nav__item"><a href="#8" title="8. 致谢" class="md-nav__link">8. 致谢</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="_1">广义分布式共识</h1>
<p><center>摘要</center></p>
<p>分布式共识是在面对故障和异步性时达成共识的能力，它是用不可靠组件来构建可靠分布式系统的原语。Paxos 算法是分布式共识的同义词，尽管在实践中表现不佳，并且很难理解。在本文中，我们重新审视分布式共识的基础。我们得出了一个共识的抽象解决方案，它利用不可变状态来直观推理安全性。我们证明了我们的抽象解决方案优于 Paxos 以及 Fast Paxos 和 Flexible Paxos 算法。该分析的令人惊讶的结果是对这些广泛研究的算法的法定人数要求的显著削弱。</p>
<p><strong>注释</strong>：重点内容，法定人数的要求的削弱。</p>
<h2 id="1">1. 简介</h2>
<p>我们依赖于分布式系统，但构成这些系统的计算机和网络是异步且不可靠的。 长期存在的分布式共识问题正式化了如何在这种系统中可靠地达成一致。 解决后，我们能够从不可靠的组件构建强大一致的分布式系统[13,21,4,17]。 Lamport的Paxos算法[14]被广泛部署在生产中以解决分布式共识[5,6]，并且对 Paxos 的经历已经有了广泛的研究以改进其性能和我们的理解，但是，尽管很受欢迎，但两个问题仍然存在。</p>
<p><strong>注释</strong>：Paxos 性能差，不易理解导致了大量的研究，但问题仍然存在。</p>
<p>Paxos在实践中表现不佳，因为它使用了多数派，意味着每个决策都需要在许多参与者之间往返，从而给每个参与者和连接他们的网络带来巨大负担。因此，系统通常在实践中仅限于三个或五个参与者。此外，Paxos通常以Multi-Paxos的形式实现，它将一个参与者设置为主服务器，这样会引入性能瓶颈并增加延迟，因为所有决策都是通过主服务器转发的。鉴于这些限制，许多生产系统通常选择牺牲强大的一致性来支持性能和高可用性[7,3,18]。虽然在实际的分布式系统中，妥协是不可避免的[10]，但Paxos在可能的权衡取舍中只提供了一点。作为回应，本文旨在通过提供通用解决方案来提高性能，使工程师能够根据其特定应用程序和部署环境的需求灵活地选择自己的权衡。</p>
<p><strong>注释</strong>：通用解决方案，灵活选择权衡一致性和可用性。</p>
<p>Paxos是众所周知难以理解，导致了大量的后续工作，用更简单的术语解释算法[20,15,19,23]并填补原始描述中的空白，是构建实际系统所必需的[6,2]。近年来，不变性在分布式系统中得到越来越广泛的应用，以克服复杂性[11]。诸如仅附加日志的存储[1,8]和CRDT[22]等示例激励我们将不变性应用于共识问题。</p>
<p><strong>注释</strong>：不变性，仅附加日志存储，CRDT，共识问题。</p>
<p>本文重新审视了分布式共识问题，旨在提高性能和让人更容易理解。我们按如下方式进行。一旦我们定义了共识问题（§2），就提出了一种共识的通用解决方案，它只使用不可变状态来实现关于正确性的更直观的推理（§3）。我们随后证明了Paxos和Fast Paxos [16]都是我们广义一致性算法的实例，因此表明两种算法在其方法中都是保守的，特别是在他们的仲裁交叉和仲裁协议规则中（§4＆§5）。最后，我们通过概括我们的广义一致性算法的三个不同实例来说明抽象的力量，这些实例提供了与Paxos（§6）相比的可选择的性能权衡。</p>
<p><strong>注释</strong>：通用共识，Paxos 是其实例。</p>
<h2 id="2">2. 问题定义</h2>
<p>经典的共识考虑了如何决定分布式系统中的单个值。这个看似简单的问题由于对底层系统做出的弱假设而变得很不平凡：我们只假设算法被正确执行（即非拜占庭模型）。我们不假设参与者是可靠的或是同步的。参与者可以以任意速度运行，并且可以任意延迟消息。</p>
<p><strong>注释</strong>：参与者不可靠，网络是异步的，非拜占庭将军问题。</p>
<p>我们考虑由两种类型的参与者组成的系统：存储值的服务器和读/写值的客户端。客户端将要写入的值作为输入，并将由系统决定的值作为输出产生。消息只能在客户端和服务器之间交换，我们假设参与者，服务器和客户端集是固定的并且被客户端知道。</p>
<p>如果算法满足以下三个要求，则算法会达成共识：</p>
<ul>
<li><strong>非平凡</strong>。所有输出值必须是客户端的输入值。</li>
<li><strong>达成一致</strong>。输出值的所有客户端必须输出相同的值。</li>
<li><strong>进度</strong>。在足够长的周期内，如果系统可靠且同步，则所有客户端最终必须输出值。</li>
</ul>
<p>进度要求排除了可能达到死锁的算法。由于终止在可能发生故障的异步系统中无法保证[9]，算法只需要假设活跃的情况下保证终止。
如果我们只有一台服务器，那么解决方案很简单。服务器有一个持久的一次写入寄存器R0，用于存储决定的值。客户端使用其输入值向服务器发送请求。如果R0未写入，则接收的值将写入R0并返回给客户端。如果已写入R0，则读取R0中的值并将其返回给客户端。然后客户端输出返回的值。此算法可以达成共识，但是要求服务器是可用的，使得客户端可以终止。要克服此限制，需要部署多个服务器，因此我们现在考虑如何一般化为多个服务器。</p>
<h2 id="3">3. 通用方法</h2>
<p>考虑一个服务器的集合，<span><span class="MathJax_Preview">\{S0, S1,..., Sn\}</span><script type="math/tex">\{S0, S1,..., Sn\}</script></span>，其中每个服务器都有一系列无限次可以写入的持久寄存器<span><span class="MathJax_Preview">\{R0,R1,...\}</span><script type="math/tex">\{R0,R1,...\}</script></span>。客户端在服务器上读写寄存器，并且在任何时候，每个寄存器都处于以下三种状态之一：</p>
<ul>
<li><strong>未写入</strong>：所有寄存器的初始状态；或者</li>
<li><strong>包含一个值</strong>：例如 A、B、C；或者</li>
<li><strong>包含 nil</strong>：一个表示为⊥的特殊值。</li>
</ul>
<p><img alt="image-20190512010145236" src="../image/consensus/gsdc_01.png" /></p>
<p>一个多数派 <span><span class="MathJax_Preview">Q​</span><script type="math/tex">Q​</script></span> 是服务器的（非空）子集，因此如果所有服务器在同一寄存器中具有相同（非nil）值 <span><span class="MathJax_Preview">v​</span><script type="math/tex">v​</script></span>，则认为 <span><span class="MathJax_Preview">v​</span><script type="math/tex">v​</script></span> 是可以确定的。寄存器组 <span><span class="MathJax_Preview">i​</span><script type="math/tex">i​</script></span> 是由来自每个服务器的寄存器 <span><span class="MathJax_Preview">Ri​</span><script type="math/tex">Ri​</script></span> 组成的集合。每个寄存器组 <span><span class="MathJax_Preview">i​</span><script type="math/tex">i​</script></span> 配置有一组仲裁，<span><span class="MathJax_Preview">\mathcal{Q}i​</span><script type="math/tex">\mathcal{Q}i​</script></span>，图1给出了四个示例配置。所有寄存器的状态可以表示在一个表中，称为状态表，其中每列代表一个服务器的状态，每行代表一个寄存器集。 通过将配置与状态表组合，我们可以确定是否已达到某种决定，如图2所示。</p>
<h3 id="31">3.1 正确性</h3>
<p>图 3 描述了一个一般化解决方案，通过给出四条规则来管理客户端如何与寄存器交互，以确保满足共识非平凡和一致性的要求。</p>
<p>规则 1（多数派一致）保证客户端仅仅输出被确定的值。规则 2（新值）保证仅客户端输入的值可以被写入到寄存器，因此客户端输出值只能由客户端决定和输出。规则 3 和 4 保证不会有两个多数派可以决定不同的值。规则3（当前决定）确保寄存器集所做的所有决策都是相同的值，而规则4（先前决定）确保不同寄存器集所做的所有决策都是相同的值。</p>
<hr />
<ul>
<li><strong>规则 1：多数派一致</strong>。一个客户端仅输出一个(非nil)值 <span><span class="MathJax_Preview">v</span><script type="math/tex">v</script></span>，如果已经从多数服务器的相同寄存器组上读取到 <span><span class="MathJax_Preview">v</span><script type="math/tex">v</script></span>。</li>
<li><strong>规则 2：新值</strong>。</li>
<li><strong>规则 3：当前决定</strong>。</li>
<li><strong>规则 4：先前决定</strong>。</li>
</ul>
<hr />
<p><center>图 3：正确性的 4 条规则 </center></p>
<p><img alt="image-20190512005930786" src="../image/consensus/gsdc_02.png" /></p>
<p><center>图 4：简单地循环分配寄存器组到客户端</center></p>
<h3 id="32">3.2 实现正确性规则</h3>
<h3 id="33">3.3 示例</h3>
<h2 id="4-paxos">4. Paxos 的一般化</h2>
<h2 id="5-fast-paxos">5. Fast Paxos 的一般化</h2>
<h2 id="6">6. 示例一致性算法</h2>
<h2 id="7">7. 结论</h2>
<h2 id="8">8. 致谢</h2></article></div></div></main><footer class="md-footer"><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Copyright &copy; 2016 - 2019 iswade</div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../assets/javascripts/application.d5a09f94.js"></script><script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script><script src="../../assets/javascripts/lunr/tinyseg.js"></script><script src="../../assets/javascripts/lunr/lunr.ja.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>